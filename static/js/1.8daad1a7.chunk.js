(this.webpackJsonprpgsp=this.webpackJsonprpgsp||[]).push([[1],{120:function(e,t,n){"use strict";t.a="data:image/png;base64,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"},149:function(e,t,n){"use strict";var r=n(42),a=n(43),o=function(){function e(){Object(r.a)(this,e)}return Object(a.a)(e,null,[{key:"getLocationMapDimension",value:function(){return{x:20,y:20}}},{key:"convertJsonMapToEditableObject",value:function(e){if("string"===typeof e){var t,n={},r=JSON.parse(e);return Object.keys(r).forEach((function(e){t=parseInt(e),r[e].forEach((function(e){n[e]=t}))})),n}return{}}},{key:"convertEditableObjectToJsonMap",value:function(e){if(Object.keys(e).length>0){var t,n={};return Object.keys(e).forEach((function(r){(t=e[r].toString())in n?n[t].push(r):n[t]=[r]})),JSON.stringify(n)}return null}},{key:"setMapTile",value:function(e,t,n){return null===n?delete e[t]:e[t]=n,e}},{key:"removeAreaFromMap",value:function(e,t){if("string"===typeof e){var n=JSON.parse(e);return delete n[t],JSON.stringify(n)}return null}}]),e}();t.a=o},22:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(19),a=n(0),o=n(81),c=function(e,t){switch(t.type){case"SET_APP_INITIAL_CHECK_DONE":return Object(o.a)(Object(o.a)({},e),{},{initialCheckDone:!0});case"SET_APP_DATABASE_LOAD_ERROR":return Object(o.a)(Object(o.a)({},e),{},{databaseLoadError:!0,initialCheckDone:!0});case"SET_APP_STORY_LOAD_ERROR":return Object(o.a)(Object(o.a)({},e),{},{globalLoading:!1,storyLoadError:!0,storyErrorMessage:t.payload||null});case"SET_APP_PAGE":return Object(o.a)(Object(o.a)({},e),{},{page:t.payload});case"SET_APP_GLOBAL_LOADING":return Object(o.a)(Object(o.a)({},e),{},{globalLoading:t.payload||!1});case"SET_STORY_LOADED":return Object(o.a)(Object(o.a)({},e),{},{globalLoading:!1,storyLoaded:t.payload,storyRunnable:!1,page:t.payload?"CONFIG":"EMPTY"});case"SET_STORY_VERIFYING_RUNNABLE":return Object(o.a)(Object(o.a)({},e),{},{storyVerifyingRunnable:!0,storyRunnable:!1});case"SET_STORY_NOT_RUNNABLE":return Object(o.a)(Object(o.a)({},e),{},{storyVerifyingRunnable:!1,storyRunnable:!1});case"SET_STORY_RUNNABLE":return Object(o.a)(Object(o.a)({},e),{},{storyVerifyingRunnable:!1,storyRunnable:!0});case"UNSET_ACTIVE_CONDITION":return Object(o.a)(Object(o.a)({},e),{},{activeConditionDone:!1,activeCondition:null});case"SET_ACTIVE_CONDITION":return Object(o.a)(Object(o.a)({},e),{},{activeConditionDone:!1,activeCondition:t.payload});case"SET_ACTIVE_CONDITION_COMPLETED":return Object(o.a)(Object(o.a)({},e),{},{activeConditionDone:!0,activeCondition:t.payload});default:return e}},u=n(1),i={initialCheckDone:!1,globalLoading:!1,databaseLoadError:!1,storyLoadError:!1,storyErrorMessage:null,storyLoaded:!1,storyVerifyingRunnable:!1,storyRunnable:!1,page:"EMPTY",activeConditionDone:!1,activeCondition:null},s=Object(a.createContext)(i);t.b=function(e){var t=e.children,n=Object(a.useReducer)(c,i),o=Object(r.a)(n,2),l=o[0],d=o[1];return Object(u.jsx)(s.Provider,{value:[l,d],children:t})}},27:function(e,t,n){"use strict";var r=n(57),a=n.n(r),o=n(58),c=n(42),u=n(43),i=n(33),s=function(){function e(){Object(c.a)(this,e)}return Object(u.a)(e,null,[{key:"getNewStoryDefaultGameStateProps",value:function(){return[{name:"currentChapter",type:"int",default:1,default_table:null,default_tids:null,edit_mode:"none",removable:!1},{name:"currentAct",type:"int",default:1,default_table:null,default_tids:null,edit_mode:"none",removable:!1},{name:"currentActSequence",type:"int",default:0,default_table:null,default_tids:null,edit_mode:"none",removable:!1},{name:"currentLocation",type:"location",default:null,default_table:"locations",default_tids:null,edit_mode:"default",removable:!1},{name:"currentArea",type:"area",default:null,default_table:"areas",default_tids:null,edit_mode:"default",removable:!1}]}},{key:"getNewStoryDefaultCharacters",value:function(){return[{name:"[Playable character]",description:"[Add description]",is_pc:!0,color:"#0000ff"}]}},{key:"getNewStoryDefaultEntityColors",value:function(){return[{name:"locations",color:e.getEntitiesDefaultColors("locations")},{name:"areas",color:e.getEntitiesDefaultColors("areas")},{name:"characters",color:e.getEntitiesDefaultColors("characters")}]}},{key:"getEntitiesDefaultColors",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"locations";switch(e){case"characters":return"#1890ff";case"areas":return"#a0d911";case"locations":default:return"#3f6600"}}},{key:"getCustomEntityRandomColor",value:function(){return["#ffa940","#73d13d","#10239e","#36cfc9","#9e1068","#9254de","#85a5ff","#fadb14","#ffa940","#391085"][Math.floor(10*Math.random())]}},{key:"rebuildConversationCharacterIds",value:function(e){var t={};return e.forEach((function(e){t[e.character_id]=!0})),Object.keys(t).length>0?","+Object.keys(t).join(",")+",":""}},{key:"getPropRelatedColor",value:function(e,t,n,r){if(["currentChapter","currentAct","currentActSequence"].includes(e))return"#00b6ff";switch(t){case"int":case"intarr":case"boolean":case"booleanarr":case"string":case"stringarr":return"#fa541c";case"location":case"locationarr":return n.find((function(e){return"locations"===e.name})).color;case"area":case"areaarr":return n.find((function(e){return"areas"===e.name})).color;case"character":case"characterarr":return n.find((function(e){return"characters"===e.name})).color;default:var a;return a=t.endsWith("arr")?t.slice(0,-3):t,console.log("||--singular",a),r.find((function(e){return e.singular_name===a})).color}return"#fa541c"}}]),e}(),l=n(149),d=function(){function e(){Object(c.a)(this,e)}return Object(u.a)(e,null,[{key:"checkDatabaseOk",value:function(e){Object(i.b)().catch((function(t){console.error("Failed to open db: "+(t.stack||t)),e({type:"SET_APP_DATABASE_LOAD_ERROR"})}))}},{key:"checkStoryLoaded",value:function(){var e=Object(o.a)(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.stories.where("id").equals(1).first();case 2:void 0!==e.sent&&t({type:"SET_STORY_LOADED",payload:!0}),t({type:"SET_APP_INITIAL_CHECK_DONE"});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"createNewStory",value:function(e,t){return i.a.transaction("rw",i.a.stories,i.a.game_state_props,i.a.characters,i.a.default_entity_colors,Object(o.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.stories.add({title:t.title,version:t.version});case 2:return e.next=4,i.a.game_state_props.bulkAdd(s.getNewStoryDefaultGameStateProps());case 4:return e.next=6,i.a.characters.bulkAdd(s.getNewStoryDefaultCharacters());case 6:return e.next=8,i.a.default_entity_colors.bulkAdd(s.getNewStoryDefaultEntityColors());case 8:case"end":return e.stop()}}),e)})))).then((function(t){e({type:"SET_STORY_LOADED",payload:!0})})).catch((function(e){return console.log("||--FAIL",e),Promise.reject(e)}))}},{key:"createNewGameStateProp",value:function(e,t){return i.a.game_state_props.add({name:t.name,type:t.type,default:t.defaultValue,default_table:t.defaultTable||null,default_tids:t.defaultTids||null,edit_mode:t.editMode,removable:t.removable}).then((function(){})).catch((function(e){return console.log("||--FAIL",e),Promise.reject(e)}))}},{key:"updateGameStateProp",value:function(e,t,n){return i.a.game_state_props.update(t,{name:n.name,type:n.type,default:n.defaultValue,edit_mode:n.editMode,removable:n.removable}).then((function(){})).catch((function(e){return console.log("||--FAIL",e),Promise.reject(e)}))}},{key:"deleteGameStateProp",value:function(e,t){return i.a.game_state_props.delete(t).then((function(){})).catch((function(e){return console.log("||--FAIL",e),Promise.reject(e)}))}},{key:"createNewLocation",value:function(e,t){return i.a.locations.add({name:t.name,description:t.description}).then((function(){})).catch((function(e){return console.log("||--FAIL",e),Promise.reject(e)}))}},{key:"updateLocation",value:function(e,t,n){return i.a.locations.update(t,{name:n.name,description:n.description}).then((function(){})).catch((function(e){return console.log("||--FAIL",e),Promise.reject(e)}))}},{key:"updateLocationMap",value:function(e,t,n){return i.a.locations.update(t,{map:n.map}).then((function(){})).catch((function(e){return console.log("||--FAIL",e),Promise.reject(e)}))}},{key:"deleteLocation",value:function(e,t){return i.a.transaction("rw",i.a.locations,i.a.areas,Object(o.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.areas.where("location_id").equals(t).delete();case 2:return e.next=4,i.a.locations.delete(t);case 4:case"end":return e.stop()}}),e)})))).then((function(e){})).catch((function(e){return console.log("||--FAIL",e),Promise.reject(e)}))}},{key:"createNewArea",value:function(e,t){return i.a.areas.add({location_id:t.location_id,name:t.name,description:t.description,color:t.color}).then((function(){})).catch((function(e){return console.log("||--FAIL",e),Promise.reject(e)}))}},{key:"updateArea",value:function(e,t,n){return i.a.areas.update(t,{name:n.name,description:n.description,color:n.color}).then((function(){})).catch((function(e){return console.log("||--FAIL",e),Promise.reject(e)}))}},{key:"deleteArea",value:function(t,n){return i.a.transaction("rw",i.a.locations,i.a.areas,Object(o.a)(a.a.mark((function r(){var o,c,u,s;return a.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,i.a.areas.where({id:n}).first();case 2:return o=r.sent,r.next=5,i.a.locations.where({id:o.location_id}).first();case 5:return c=r.sent,u=l.a.removeAreaFromMap(c.map,n),s={map:u},r.next=10,e.updateLocationMap(t,c.id,s);case 10:return r.next=12,i.a.areas.delete(n);case 12:case"end":return r.stop()}}),r)})))).then((function(e){})).catch((function(e){return console.log("||--FAIL",e),Promise.reject(e)}))}},{key:"createNewCharacter",value:function(e,t){return i.a.characters.add({name:t.name,description:t.description,is_pc:t.isPC,color:t.color}).then((function(){})).catch((function(e){return console.log("||--FAIL",e),Promise.reject(e)}))}},{key:"updateCharacter",value:function(e,t,n){return i.a.characters.update(t,{name:n.name,description:n.description,is_pc:n.isPC,color:n.color}).then((function(){})).catch((function(e){return console.log("||--FAIL",e),Promise.reject(e)}))}},{key:"deleteCharacter",value:function(e,t){return i.a.characters.delete(t).then((function(){})).catch((function(e){return console.log("||--FAIL",e),Promise.reject(e)}))}},{key:"createNewCustomEntityDef",value:function(e,t){return i.a.custom_entity_defs.add({name:t.name,key:t.key,singular_name:t.singular,color:s.getCustomEntityRandomColor()}).then((function(){})).catch((function(e){return console.log("||--FAIL",e),Promise.reject(e)}))}},{key:"deleteCustomEntityDef",value:function(e,t){return i.a.transaction("rw",i.a.custom_entity_defs,i.a.custom_entities,Object(o.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.custom_entities.where("custom_entity_def_id").equals(t).delete();case 2:return e.next=4,i.a.custom_entity_defs.delete(t);case 4:case"end":return e.stop()}}),e)})))).then((function(e){})).catch((function(e){return console.log("||--FAIL",e),Promise.reject(e)}))}},{key:"createNewCustomEntity",value:function(e,t){return i.a.custom_entities.add({custom_entity_def_id:t.custom_entity_def_id,name:t.name,description:t.description}).then((function(){})).catch((function(e){return console.log("||--FAIL",e),Promise.reject(e)}))}},{key:"updateCustomEntity",value:function(e,t,n){return i.a.custom_entities.update(t,{name:n.name,description:n.description}).then((function(){})).catch((function(e){return console.log("||--FAIL",e),Promise.reject(e)}))}},{key:"deleteCustomEntity",value:function(e,t){return i.a.custom_entities.delete(t).then((function(){})).catch((function(e){return console.log("||--FAIL",e),Promise.reject(e)}))}},{key:"updateDefaultEntityColor",value:function(e,t,n){return i.a.default_entity_colors.update(t,{color:n.color}).then((function(){})).catch((function(e){return console.log("||--FAIL",e),Promise.reject(e)}))}},{key:"updateCustomEntityDefColor",value:function(e,t,n){return i.a.custom_entity_defs.update(t,{color:n.color}).then((function(){})).catch((function(e){return console.log("||--FAIL",e),Promise.reject(e)}))}},{key:"createNewChapter",value:function(e,t){return i.a.chapters.add({name:t.name,description:t.description,order:t.order}).then((function(){})).catch((function(e){return console.log("||--FAIL",e),Promise.reject(e)}))}},{key:"updateChapter",value:function(e,t,n){return i.a.chapters.update(t,{name:n.name,description:n.description}).then((function(){})).catch((function(e){return console.log("||--FAIL",e),Promise.reject(e)}))}},{key:"updateChapterOrder",value:function(e,t,n){return i.a.transaction("rw",i.a.chapters,Object(o.a)(a.a.mark((function e(){var r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.chapters.where("order").equals(n.order).first();case 2:return r=e.sent,e.next=5,i.a.chapters.update(t,{order:n.order});case 5:return e.next=7,i.a.chapters.update(r.id,{order:n.oldOrder});case 7:case"end":return e.stop()}}),e)})))).then((function(e){})).catch((function(e){return console.log("||--FAIL",e),Promise.reject(e)}))}},{key:"deleteChapter",value:function(e,t){return i.a.transaction("rw",i.a.chapters,Object(o.a)(a.a.mark((function e(){var n,r,c;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=null,r=[],c=i.a.chapters.orderBy("order"),e.next=5,c.each((function(e){null!==n&&r.push({key:e.id,order:n+r.length}),e.id===t&&(n=e.order)}));case 5:return e.next=7,i.a.chapters.delete(t);case 7:r.forEach(function(){var e=Object(o.a)(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.chapters.update(t.key,{order:t.order});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 8:case"end":return e.stop()}}),e)})))).then((function(e){})).catch((function(e){return console.log("||--FAIL",e),Promise.reject(e)}))}},{key:"createNewAct",value:function(e,t){return i.a.acts.add({chapter_id:t.chapter_id,name:t.name,description:t.description,order:t.order,type:t.type}).then((function(){})).catch((function(e){return console.log("||--FAIL",e),Promise.reject(e)}))}},{key:"updateAct",value:function(e,t,n){return i.a.acts.update(t,{name:n.name,description:n.description}).then((function(){})).catch((function(e){return console.log("||--FAIL",e),Promise.reject(e)}))}},{key:"updateActOrder",value:function(e,t,n){return i.a.transaction("rw",i.a.acts,Object(o.a)(a.a.mark((function e(){var r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.acts.where({chapter_id:n.chapter_id,order:n.order}).first();case 2:return r=e.sent,e.next=5,i.a.acts.update(t,{order:n.order});case 5:return e.next=7,i.a.acts.update(r.id,{order:n.oldOrder});case 7:case"end":return e.stop()}}),e)})))).then((function(e){})).catch((function(e){return console.log("||--FAIL",e),Promise.reject(e)}))}},{key:"deleteAct",value:function(e,t,n){return i.a.transaction("rw",i.a.acts,Object(o.a)(a.a.mark((function e(){var r,c,u,s;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=null,c=[],e.next=4,i.a.acts.where("chapter_id").equals(n).toArray();case 4:return u=e.sent,s=u.sort((function(e,t){return e.order-t.order})),e.next=8,s.forEach((function(e){null!==r&&c.push({key:e.id,order:r+c.length}),e.id===t&&(r=e.order)}));case 8:return e.next=10,i.a.acts.delete(t);case 10:c.forEach(function(){var e=Object(o.a)(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.acts.update(t.key,{order:t.order});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 11:case"end":return e.stop()}}),e)})))).then((function(e){})).catch((function(e){return console.log("||--FAIL",e),Promise.reject(e)}))}},{key:"createNewSequencedAction",value:function(e,t){return i.a.sequenced_actions.add({act_id:t.actId,order:t.order,text_value:t.textValue,type:t.type,character_id:t.characterId}).then((function(){})).catch((function(e){return console.log("||--FAIL",e),Promise.reject(e)}))}},{key:"updateSequencedAction",value:function(e,t,n){return i.a.sequenced_actions.update(t,{text_value:n.textValue,type:n.type,character_id:n.characterId}).then((function(){})).catch((function(e){return console.log("||--FAIL",e),Promise.reject(e)}))}},{key:"updateSequencedActionOrder",value:function(e,t,n){return i.a.transaction("rw",i.a.sequenced_actions,Object(o.a)(a.a.mark((function e(){var r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.sequenced_actions.where({act_id:n.actId,order:n.order}).first();case 2:return r=e.sent,e.next=5,i.a.sequenced_actions.update(t,{order:n.order});case 5:return e.next=7,i.a.sequenced_actions.update(r.id,{order:n.oldOrder});case 7:case"end":return e.stop()}}),e)})))).then((function(e){})).catch((function(e){return console.log("||--FAIL",e),Promise.reject(e)}))}},{key:"deleteSequencedAction",value:function(e,t,n){return i.a.transaction("rw",i.a.sequenced_actions,Object(o.a)(a.a.mark((function e(){var r,c,u,s;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=null,c=[],e.next=4,i.a.sequenced_actions.where("act_id").equals(n).toArray();case 4:return u=e.sent,s=u.sort((function(e,t){return e.order-t.order})),e.next=8,s.forEach((function(e){null!==r&&c.push({key:e.id,order:r+c.length}),e.id===t&&(r=e.order)}));case 8:return e.next=10,i.a.sequenced_actions.delete(t);case 10:c.forEach(function(){var e=Object(o.a)(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.sequenced_actions.update(t.key,{order:t.order});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 11:case"end":return e.stop()}}),e)})))).then((function(e){})).catch((function(e){return console.log("||--FAIL",e),Promise.reject(e)}))}},{key:"createNewNoEffectAction",value:function(e,t){return i.a.game_actions.add({type:"noeff",description:t.description,required_condition:t.requiredCondition,allow_repeat:t.allowRepeat}).then((function(){})).catch((function(e){return console.log("||--FAIL",e),Promise.reject(e)}))}},{key:"deleteNoEffectAction",value:function(e,t){return i.a.game_actions.delete(t).then((function(){})).catch((function(e){return console.log("||--FAIL",e),Promise.reject(e)}))}},{key:"createNewConversation",value:function(e,t){return i.a.conversations.add({name:t.name,characters:""}).then((function(){})).catch((function(e){return console.log("||--FAIL",e),Promise.reject(e)}))}},{key:"updateConversation",value:function(e,t,n){return i.a.conversations.update(t,{name:n.name}).then((function(){})).catch((function(e){return console.log("||--FAIL",e),Promise.reject(e)}))}},{key:"updateConversationCharacters",value:function(e,t,n){return i.a.conversations.update(t,{characters:n.characters}).then((function(){})).catch((function(e){return console.log("||--FAIL",e),Promise.reject(e)}))}},{key:"deleteConversation",value:function(e,t){return i.a.transaction("rw",i.a.conversations,i.a.conversation_dialogs,Object(o.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.conversation_dialogs.where("conversation_id").equals(t).delete();case 2:return e.next=4,i.a.conversations.delete(t);case 4:case"end":return e.stop()}}),e)})))).then((function(e){})).catch((function(e){return console.log("||--FAIL",e),Promise.reject(e)}))}},{key:"createNewConversationDialog",value:function(e,t){return i.a.transaction("rw",i.a.conversations,i.a.conversation_dialogs,Object(o.a)(a.a.mark((function e(){var n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.conversation_dialogs.add({conversation_id:t.conversationId,order:t.order,dialog:t.dialog,character_id:t.characterId});case 2:return e.next=4,i.a.conversation_dialogs.where("conversation_id").equals(t.conversationId).toArray();case 4:return n=e.sent,e.next=7,i.a.conversations.update(t.conversationId,{characters:s.rebuildConversationCharacterIds(n)});case 7:case"end":return e.stop()}}),e)})))).then((function(e){})).catch((function(e){return console.log("||--FAIL",e),Promise.reject(e)}))}},{key:"updateConversationDialog",value:function(e,t,n){return i.a.transaction("rw",i.a.conversations,i.a.conversation_dialogs,Object(o.a)(a.a.mark((function e(){var r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.conversation_dialogs.update(t,{dialog:n.dialog,character_id:n.characterId});case 2:return e.next=4,i.a.conversation_dialogs.where("conversation_id").equals(n.conversationId).toArray();case 4:return r=e.sent,e.next=7,i.a.conversations.update(n.conversationId,{characters:s.rebuildConversationCharacterIds(r)});case 7:case"end":return e.stop()}}),e)})))).then((function(e){})).catch((function(e){return console.log("||--FAIL",e),Promise.reject(e)}))}},{key:"updateConversationDialogOrder",value:function(e,t,n){return i.a.transaction("rw",i.a.conversation_dialogs,Object(o.a)(a.a.mark((function e(){var r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.conversation_dialogs.where({conversation_id:n.conversationId,order:n.order}).first();case 2:return r=e.sent,e.next=5,i.a.conversation_dialogs.update(t,{order:n.order});case 5:return e.next=7,i.a.conversation_dialogs.update(r.id,{order:n.oldOrder});case 7:case"end":return e.stop()}}),e)})))).then((function(e){})).catch((function(e){return console.log("||--FAIL",e),Promise.reject(e)}))}},{key:"deleteConversationDialog",value:function(e,t,n){return i.a.transaction("rw",i.a.conversations,i.a.conversation_dialogs,Object(o.a)(a.a.mark((function e(){var r,c,u,l,d;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=null,c=[],e.next=4,i.a.conversation_dialogs.where("conversation_id").equals(n).toArray();case 4:return u=e.sent,l=u.sort((function(e,t){return e.order-t.order})),e.next=8,l.forEach((function(e){null!==r&&c.push({key:e.id,order:r+c.length}),e.id===t&&(r=e.order)}));case 8:return e.next=10,i.a.conversation_dialogs.delete(t);case 10:return c.forEach(function(){var e=Object(o.a)(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.conversation_dialogs.update(t.key,{order:t.order});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=13,i.a.conversation_dialogs.where("conversation_id").equals(n).toArray();case 13:return d=e.sent,e.next=16,i.a.conversations.update(n,{characters:s.rebuildConversationCharacterIds(d)});case 16:case"end":return e.stop()}}),e)})))).then((function(e){})).catch((function(e){return console.log("||--FAIL",e),Promise.reject(e)}))}},{key:"startNewPlayTestRun",value:function(e){return i.a.transaction("rw",i.a.play_game_state_props,i.a.game_state_props,i.a.default_entity_colors,i.a.custom_entity_defs,Object(o.a)(a.a.mark((function e(){var t,n,r,o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.default_entity_colors.toArray();case 2:return t=e.sent,e.next=5,i.a.custom_entity_defs.toArray();case 5:return n=e.sent,e.next=8,i.a.play_game_state_props.clear();case 8:return e.next=10,i.a.game_state_props.toArray();case 10:return r=e.sent,o=r.map((function(e){return{game_state_prop_id:e.id,name:e.name,type:e.type,value:e.default,prev_value:null,color:s.getPropRelatedColor(e.name,e.type,t,n)}})),e.next=14,i.a.play_game_state_props.bulkAdd(o);case 14:case"end":return e.stop()}}),e)})))).then((function(e){})).catch((function(e){return console.log("||--FAIL",e),Promise.reject(e)}))}},{key:"devStartOver",value:function(e){return i.a.delete().then((function(){return window.location.reload()}))}}]),e}();t.a=d},33:function(e,t,n){"use strict";n.d(t,"b",(function(){return a}));var r=new(n(148).default)("RpgspDatabase");r.version(1).stores({stories:"++id",game_state_props:"++id, name",locations:"++id, name",areas:"++id, location_id, name",characters:"++id, name",custom_entity_defs:"++id, singular_name",custom_entities:"++id, custom_entity_def_id, name",default_entity_colors:"++id",chapters:"++id, order",acts:"++id, order, chapter_id, type",sequenced_actions:"++id, act_id, order",game_actions:"++id, type",conversations:"++id",conversation_dialogs:"++id, conversation_id, order",play_game_state_props:"game_state_prop_id, name"});var a=function(){return r.open()};t.a=r},47:function(e,t,n){"use strict";var r=n(57),a=n.n(r),o=n(58),c=n(42),u=n(43),i=n(33),s=function(){function e(){Object(c.a)(this,e)}return Object(u.a)(e,null,[{key:"fetchGameStateProps",value:function(){var e=Object(o.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",i.a.game_state_props.toArray());case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"fetchPlayGameStateProps",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(null!==e){var n=1===e.length;return t?n?function(){return i.a.play_game_state_props.where("name").anyOf(e).first()}:function(){return i.a.play_game_state_props.where("name").anyOf(e).toArray()}:n?i.a.play_game_state_props.where("name").anyOf(e).first():i.a.play_game_state_props.where("name").anyOf(e).toArray()}return t?function(){return i.a.play_game_state_props.toArray()}:i.a.play_game_state_props.toArray()}},{key:"fetchStoryEntities",value:function(){var e=Object(o.a)(a.a.mark((function e(t){var n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("location"!==t&&"area"!==t&&"character"!==t){e.next=9;break}if(n=t+"s","location"!==t&&"character"!==t){e.next=6;break}return e.abrupt("return",i.a[n].toArray());case 6:return e.abrupt("return",i.a.transaction("r",n,"locations",Object(o.a)(a.a.mark((function e(){var t,r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.locations.toArray();case 2:return t=e.sent,e.next=5,i.a[n].toArray();case 5:return r=e.sent,e.abrupt("return",r.map((function(e){return e.displayName=e.name+" ("+t.find((function(t){return t.id===e.location_id})).name+")",e})));case 7:case"end":return e.stop()}}),e)})))));case 7:e.next=10;break;case 9:return e.abrupt("return",i.a.transaction("r","custom_entity_defs","custom_entities",Object(o.a)(a.a.mark((function e(){var n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.custom_entity_defs.where({singular_name:t}).first();case 2:return n=e.sent,e.abrupt("return",i.a.custom_entities.where({custom_entity_def_id:n.id}).toArray());case 4:case"end":return e.stop()}}),e)})))));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"fetchSequencedActs",value:function(){var e=Object(o.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",i.a.acts.where({type:"sequence"}).toArray());case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"fetchAreasByLocation",value:function(){var e=Object(o.a)(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",i.a.areas.where({location_id:t}).toArray());case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"chaptersCount",value:function(){var e=Object(o.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",i.a.chapters.count());case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"chapterByOrder",value:function(){var e=Object(o.a)(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",i.a.chapters.where("order").equals(t).first());case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"actsByChapterCount",value:function(){var e=Object(o.a)(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",i.a.acts.where("chapter_id").equals(t).count());case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"fetchLiveAct",value:function(e){return function(){return i.a.acts.where("id").equals(e||-1).first()}}},{key:"fetchLiveChapter",value:function(e){return function(){return i.a.chapters.where("id").equals(e||-1).first()}}},{key:"fetchLiveSequencedActionsByAct",value:function(e){return function(){return i.a.sequenced_actions.where("act_id").equals(e||-1).toArray()}}},{key:"fetchLiveConversations",value:function(e){if(e.character&&-1!==e.character){var t=new RegExp(","+e.character+",");return function(){return i.a.conversations.filter((function(e){return t.test(e.characters)})).toArray()}}return function(){return i.a.conversations.toArray()}}},{key:"fetchLiveConversationDialogs",value:function(e){return function(){return i.a.conversation_dialogs.where("conversation_id").equals(e||-1).toArray()}}},{key:"fetchLiveNoEffectActions",value:function(e){if(!e.character||-1===e.character)return function(){return i.a.game_actions.where("type").equals("noeff").toArray()}}}]),e}();t.a=s}}]);
//# sourceMappingURL=1.8daad1a7.chunk.js.map