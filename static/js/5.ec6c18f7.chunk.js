(this.webpackJsonprpgsp=this.webpackJsonprpgsp||[]).push([[5],{294:function(e,t,n){},295:function(e,t,n){},298:function(e,t,n){},299:function(e,t,n){},367:function(e,t,n){},368:function(e,t,n){},369:function(e,t,n){},370:function(e,t,n){},371:function(e,t,n){},372:function(e,t,n){},373:function(e,t,n){},374:function(e,t,n){},375:function(module,__webpack_exports__,__webpack_require__){"use strict";var _Users_sebastiangamboa_PersonalProjects_rpgsp_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(42),_Users_sebastiangamboa_PersonalProjects_rpgsp_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_createClass__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(43),ConditionEngine=function(){function ConditionEngine(){Object(_Users_sebastiangamboa_PersonalProjects_rpgsp_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_0__.a)(this,ConditionEngine)}return Object(_Users_sebastiangamboa_PersonalProjects_rpgsp_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_createClass__WEBPACK_IMPORTED_MODULE_1__.a)(ConditionEngine,[{key:"validateComplexCondition",value:function validateComplexCondition(conditionParts,expressions){var testingCondition=this.buildExpressionFromParts(conditionParts,!0);try{return eval(testingCondition),!0}catch(error){return!1}}},{key:"buildExpressionFromParts",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=[];return e.forEach((function(e){switch(e.type){case"exp":t?n.push("true"):n.push(e.name);break;case"logic":"AND"===e.name?n.push("&&"):"OR"===e.name?n.push("||"):n.push("!");break;case"grouping":"OPEN"===e.name?n.push("("):n.push(")")}})),n.join(" ")}}]),ConditionEngine}();__webpack_exports__.a=ConditionEngine},376:function(e,t,n){},377:function(e,t,n){},378:function(e,t,n){},379:function(e,t,n){},380:function(e,t,n){},402:function(e,t,n){"use strict";n.r(t);var a,c=n(19),r=n(0),i=n.n(r),o=n(404),s=n(360),l=n(397),d=n(57),u=n.n(d),j=n(58),b=n(388),h=n(413),p=n(398),O=n(184),f=n(399),m=n(287),x=n(288),y=n(421),v=n(422),g=n(423),C=n(424),w=n(425),S=n(426),E=n(395),A=n(427),k=n(428),_=n(403),T=n(412),N=n(409),D=n(22),I=n(27),P=n(1),R=function(e){var t=e.isDrawerVisible,n=e.onDrawerClose,a=Object(r.useContext)(D.a),i=Object(c.a)(a,2)[1],o=_.a.useForm(),s=Object(c.a)(o,1)[0],l=Object(r.useState)(!1),d=Object(c.a)(l,2),u=d[0],j=d[1],h=Object(r.useState)(""),p=Object(c.a)(h,2),f=p[0],y=p[1],v=Object(r.useState)(""),g=Object(c.a)(v,2),C=g[0],w=g[1];Object(r.useEffect)((function(){t&&(s.resetFields(),S())}),[t,s]);var S=function(){j(!0)},E=function(){j(!1),n&&n()};return Object(P.jsx)(T.a,{title:"New story",width:360,onClose:E,visible:u,bodyStyle:{paddingBottom:20},footer:Object(P.jsxs)("div",{style:{textAlign:"right"},children:[Object(P.jsx)(O.a,{onClick:E,style:{marginRight:8},children:"Cancel"}),Object(P.jsx)(O.a,{type:"primary",htmlType:"submit",form:"create-story-id",children:"Create"})]}),children:Object(P.jsxs)(_.a,{layout:"vertical",name:"create-story",id:"create-story-id",form:s,onFinish:function(e){var t=e.title.trim(),n=e.version.trim();if(""===t||""===n)return E(),void b.b.error("Something went wrong, sorry :(");var a={title:t,version:n};I.a.createNewStory(i,a).then((function(e){E(),b.b.success("Story created!")})).catch((function(e){E(),b.b.error("Something went wrong, sorry :(")}))},requiredMark:!1,children:[Object(P.jsx)(m.a,{gutter:16,children:Object(P.jsx)(x.a,{span:24,children:Object(P.jsx)(_.a.Item,{name:"title",label:"Title",rules:[{required:!0,message:"Please enter a title"}],children:Object(P.jsx)(N.a,{placeholder:"Please enter a title",value:f,onChange:function(e){y(e.target.value)}})})})}),Object(P.jsx)(m.a,{gutter:16,children:Object(P.jsx)(x.a,{span:24,children:Object(P.jsx)(_.a.Item,{name:"version",label:"Version",rules:[{required:!0,message:"Please enter a version"}],children:Object(P.jsx)(N.a,{placeholder:"Please enter a version",value:C,onChange:function(e){w(e.target.value)}})})})})]})})},L=n(189),F=n(42),V=n(43),q=n(33),B=function(){function e(){Object(F.a)(this,e)}return Object(V.a)(e,null,[{key:"verifyStoryRunnable",value:function(){var e=Object(j.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t({type:"SET_STORY_VERIFYING_RUNNABLE"}),setTimeout((function(){t({type:"SET_STORY_RUNNABLE"})}),1e3);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"validateEntityNames",value:function(){var e=Object(j.a)(u.a.mark((function e(t,n){var a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=[],e.abrupt("return",q.a.transaction("r",n,Object(j.a)(u.a.mark((function e(){var c,r,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:c=Object(L.a)(t),e.prev=1,c.s();case 3:if((r=c.n()).done){e.next=11;break}return i=r.value,e.next=7,n.where({name:i}).first();case 7:void 0===e.sent&&a.push(i);case 9:e.next=3;break;case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(1),c.e(e.t0);case 16:return e.prev=16,c.f(),e.finish(16);case 19:if(0!==a.length){e.next=23;break}return e.abrupt("return",Promise.resolve());case 23:return e.abrupt("return",Promise.reject(a));case 24:case"end":return e.stop()}}),e,null,[[1,13,16,19]])})))));case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"validateCustomEntityNames",value:function(){var e=Object(j.a)(u.a.mark((function e(t,n){var a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=[],e.abrupt("return",q.a.transaction("r",q.a.custom_entities,Object(j.a)(u.a.mark((function e(){var c,r,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:c=Object(L.a)(t),e.prev=1,c.s();case 3:if((r=c.n()).done){e.next=11;break}return i=r.value,e.next=7,q.a.custom_entities.where({name:i,custom_entity_def_id:n}).first();case 7:void 0===e.sent&&a.push(i);case 9:e.next=3;break;case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(1),c.e(e.t0);case 16:return e.prev=16,c.f(),e.finish(16);case 19:if(0!==a.length){e.next=23;break}return e.abrupt("return",Promise.resolve());case 23:return e.abrupt("return",Promise.reject(a));case 24:case"end":return e.stop()}}),e,null,[[1,13,16,19]])})))));case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),z=B,M=n(289),G=n(293),U=n.n(G),Y=function(){function e(){Object(F.a)(this,e)}return Object(V.a)(e,null,[{key:"downloadStory",value:function(){var e=Object(j.a)(u.a.mark((function e(t){var n,a,c,r,i,o,s,l=arguments;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=l.length>1&&void 0!==l[1]?l[1]:function(){},a=l.length>2&&void 0!==l[2]?l[2]:function(){},e.prev=2,e.next=5,q.a.stories.where("id").equals(1).first();case 5:return c=e.sent,r=new Date,i=r.getFullYear().toString()+r.getMonth().toString()+r.getDate().toString()+"-"+r.getHours().toString()+r.getMinutes().toString()+r.getSeconds().toString(),o=c.title.replaceAll(" ","_")+"-"+i+".json",e.next=11,Object(M.a)(q.a,{prettyJson:!0,progressCallback:n});case 11:s=e.sent,U()(s,o,"application/json"),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(2),a(e.t0);case 18:case"end":return e.stop()}}),e,null,[[2,15]])})));return function(t){return e.apply(this,arguments)}}()},{key:"loadStoryFromFile",value:function(){var e=Object(j.a)(u.a.mark((function e(t,n){var a,c,r=arguments;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=r.length>2&&void 0!==r[2]?r[2]:function(){},c=r.length>3&&void 0!==r[3]?r[3]:function(){},e.prev=2,!q.a.isOpen()){e.next=6;break}return e.next=6,q.a.delete().then((function(){return q.a.open()}));case 6:return e.next=8,Object(M.b)(q.a,n,{acceptMissingTables:!1,acceptVersionDiff:!1,acceptNameDiff:!1,acceptChangedPrimaryKey:!1,progressCallback:a});case 8:return e.next=10,q.a.stories.where("id").equals(1).first();case 10:void 0!==e.sent&&t({type:"SET_STORY_LOADED",payload:!0}),c(),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(2),t({type:"SET_APP_STORY_LOAD_ERROR",payload:e.t0}),console.log(e.t0);case 19:case"end":return e.stop()}}),e,null,[[2,15]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"loadStoryFromUrl",value:function(){var e=Object(j.a)(u.a.mark((function e(t,n){var a,c,r=arguments;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.length>2&&void 0!==r[2]?r[2]:function(){},c=r.length>3&&void 0!==r[3]?r[3]:function(){},t({type:"SET_APP_GLOBAL_LOADING",payload:!0}),e.next=5,new Promise((function(e){return setTimeout(e,800)}));case 5:try{fetch(n).then(function(){var e=Object(j.a)(u.a.mark((function e(n){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(200===n.status){e.next=3;break}return t({type:"SET_APP_STORY_LOAD_ERROR",payload:n.status}),e.abrupt("return");case 3:if(!q.a.isOpen()){e.next=6;break}return e.next=6,q.a.delete().then((function(){return q.a.open()}));case 6:n.blob().then(function(){var e=Object(j.a)(u.a.mark((function e(n){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(M.b)(q.a,n,{acceptMissingTables:!1,acceptVersionDiff:!1,acceptNameDiff:!1,acceptChangedPrimaryKey:!1,progressCallback:a});case 2:return e.next=4,q.a.stories.where("id").equals(1).first();case 4:void 0!==e.sent&&(t({type:"SET_STORY_LOADED",payload:!0}),c());case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){t({type:"SET_APP_STORY_LOAD_ERROR",payload:e}),console.log(e)}))}catch(i){t({type:"SET_APP_STORY_LOAD_ERROR",payload:i}),console.log(i)}case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),Q=n(120),W=(n(294),l.a.Sider),X=function(){var e=Object(r.useContext)(D.a),t=Object(c.a)(e,2),n=t[0],a=t[1],i=Object(r.useState)(!1),o=Object(c.a)(i,2),s=o[0],l=o[1],d=Object(r.useState)(!0),_=Object(c.a)(d,2),T=_[0],N=_[1],L=Object(r.useState)(!1),F=Object(c.a)(L,2),V=F[0],q=F[1];Object(r.useEffect)((function(){document.getElementById("load-story-selector").addEventListener("change",G,!1)}),[]),Object(r.useEffect)((function(){N(!1),setTimeout((function(){N(!0)}),5)}),[n.storyLoaded]);var B=function(){document.getElementById("load-story-selector").click()},M=function(){I.a.devStartOver(a)},G=function(){var e=Object(j.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.target.files[0]){e.next=3;break}return e.abrupt("return");case 3:Y.loadStoryFromFile(a,n,U,X);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),U=function(e){e.totalRows,e.completedRows},X=function(){b.b.success("Story imported successfully!")},K=function(){l(!s)},Z=function(e){switch(e.key){case"1":a({type:"SET_APP_PAGE",payload:"CONFIG"});break;case"2":a({type:"SET_APP_PAGE",payload:"STORY"});break;case"3":z.verifyStoryRunnable(a),setTimeout((function(){a({type:"SET_APP_PAGE",payload:"PLAYMODE"})}),50)}},J=function(e){Y.loadStoryFromUrl(a,e,H,$)},H=function(){},$=function(){b.b.success("Sample story imported successfully!")};return Object(P.jsxs)(P.Fragment,{children:[Object(P.jsxs)(W,{className:"app-nav",collapsible:!0,collapsed:s,onCollapse:K,children:[Object(P.jsx)("div",{className:"logo ".concat(s?"collapsed":""),children:Object(P.jsx)("img",{src:Q.a,alt:"RPG Story Playtesting",onClick:K})}),Object(P.jsx)("div",{className:"menu-wrapper",children:T&&Object(P.jsxs)(h.a,{theme:"dark",mode:"inline",defaultSelectedKeys:n.storyLoaded?["1"]:[],onClick:Z,children:[Object(P.jsx)(h.a.Item,{disabled:!n.storyLoaded,icon:Object(P.jsx)(y.a,{}),children:"Configuration"},"1"),Object(P.jsx)(h.a.Item,{disabled:!n.storyLoaded,icon:Object(P.jsx)(v.a,{}),children:"Story"},"2"),Object(P.jsx)(h.a.Item,{disabled:!n.storyLoaded,icon:Object(P.jsx)(g.a,{}),children:"Play"},"3")]})}),!s&&Object(P.jsx)(m.a,{gutter:16,style:{marginLeft:8,marginRight:8,marginTop:32},children:Object(P.jsxs)(x.a,{span:24,children:[!n.storyLoaded&&Object(P.jsx)(O.a,{type:"default",onClick:function(){q(!0)},block:!0,icon:Object(P.jsx)(E.a,{}),style:{marginBottom:12},children:"New story"}),Object(P.jsxs)(P.Fragment,{children:[n.storyLoaded?Object(P.jsx)(p.a,{title:function(){return Object(P.jsxs)("p",{children:["Download current story to avoid losing your changes.",Object(P.jsx)("br",{}),"Continue loading a new story?"]})},onConfirm:B,onCancel:function(){},okText:"Yes",cancelText:"No",placement:"right",children:Object(P.jsx)(O.a,{type:"default",block:!0,icon:Object(P.jsx)(C.a,{}),style:{marginBottom:12},children:"Load story"})}):Object(P.jsx)(O.a,{type:"default",block:!0,icon:Object(P.jsx)(C.a,{}),style:{marginBottom:12},onClick:B,children:"Load story"}),Object(P.jsx)("input",{type:"file",id:"load-story-selector",accept:".json",style:{display:"none"}})]}),n.storyLoaded&&Object(P.jsxs)(P.Fragment,{children:[Object(P.jsx)(O.a,{type:"default",block:!0,icon:Object(P.jsx)(A.a,{}),style:{marginBottom:12},onClick:function(){Y.downloadStory(a)},children:"Download story"}),Object(P.jsx)(p.a,{title:"All data will be lost. Are you sure to delete this story?",onConfirm:M,onCancel:function(){},okText:"Yes",cancelText:"No",placement:"right",children:Object(P.jsx)(O.a,{type:"default",block:!0,icon:Object(P.jsx)(w.a,{}),style:{marginBottom:12},children:"Clear story"})})]}),function(){var e=Object(P.jsxs)("div",{children:[Object(P.jsx)(O.a,{type:"default",block:!0,style:{marginBottom:12},onClick:function(){J("https://gcsebas99.github.io/rpgsp/samples/Sample1_en.json")},children:"Sample #1 (english)"}),Object(P.jsx)(O.a,{type:"default",block:!0,style:{marginBottom:12},onClick:function(){J("https://gcsebas99.github.io/rpgsp/samples/Sample1_es.json")},children:"Sample #1 (spanish)"})]});return Object(P.jsx)(f.a,{placement:"right",title:"Select a story",content:e,trigger:"click",children:Object(P.jsx)(O.a,{type:"default",block:!0,icon:Object(P.jsx)(S.a,{}),style:{marginBottom:12},children:"Load samples"})})}(),Object(P.jsx)(O.a,{type:"default",block:!0,icon:Object(P.jsx)(k.a,{}),style:{marginBottom:12},onClick:function(){I.a.devStartOver(a)},children:"dev:startover"})]})})]}),Object(P.jsx)(R,{isDrawerVisible:V,onDrawerClose:function(){q(!1)}})]})},K=n(32),Z=(n(295),l.a.Header),J=o.a.Title,H=o.a.Text,$=function(){var e=Object(K.useLiveQuery)((function(){return q.a.stories.where("id").equals(1).first()}));return void 0===e?null:Object(P.jsxs)(Z,{className:"story-title",children:[Object(P.jsxs)(J,{level:4,children:["RPG-SP: ",e.title]}),Object(P.jsxs)(H,{type:"secondary",children:["Version: ",e.version]})]})},ee=n.p+"static/media/jake-reading.fddcdec6.png",te=(n(298),l.a.Content),ne=o.a.Text,ae=function(){return Object(P.jsxs)(te,{className:"empty-project-page",children:[Object(P.jsx)("img",{src:ee,alt:"Start a new story"}),Object(P.jsx)(ne,{children:"Create a new story or load an existing one"})]})},ce=n(384),re=(n(299),n(430)),ie=n(431),oe=function(e){var t=e.isDrawerVisible,n=e.onDrawerClose,a=Object(r.useContext)(D.a),i=Object(c.a)(a,2)[1],o=_.a.useForm(),s=Object(c.a)(o,1)[0],l=Object(r.useState)(!1),d=Object(c.a)(l,2),u=d[0],j=d[1];Object(r.useEffect)((function(){t&&(s.resetFields(),h())}),[t,s]);var h=function(){j(!0)},p=function(){j(!1),n&&n()};return Object(P.jsx)(T.a,{title:"Add Custom Entity",width:360,onClose:p,visible:u,bodyStyle:{paddingBottom:20},footer:Object(P.jsxs)("div",{style:{textAlign:"right"},children:[Object(P.jsx)(O.a,{onClick:p,style:{marginRight:8},children:"Cancel"}),Object(P.jsx)(O.a,{type:"primary",htmlType:"submit",form:"create-custom-entity-id",children:"Add"})]}),children:Object(P.jsxs)(_.a,{layout:"vertical",name:"create-custom-entity",id:"create-custom-entity-id",form:s,onFinish:function(e){var t=e.name.trim(),n=e.key.trim(),a=e.singular.trim();if(""===t||""===a)return p(),void b.b.error("Do not leave empty fields, sorry :(");var c={name:t,key:n,singular:a};I.a.createNewCustomEntityDef(i,c).then((function(e){p(),b.b.success("New entity created!")})).catch((function(e){p(),b.b.error("Something went wrong, sorry :(")}))},requiredMark:!1,children:[Object(P.jsx)(m.a,{gutter:16,children:Object(P.jsx)(x.a,{span:24,children:Object(P.jsx)(_.a.Item,{name:"name",label:"Name (use plural)",rules:[{required:!0,message:"Please enter a name"}],children:Object(P.jsx)(N.a,{placeholder:"Please enter a name",onChange:function(e){var t=e.target.value.toLowerCase().replace(/\s/g,"");s.setFieldsValue({key:t})}})})})}),Object(P.jsx)(m.a,{gutter:16,children:Object(P.jsx)(x.a,{span:24,children:Object(P.jsx)(_.a.Item,{name:"key",label:"Key",children:Object(P.jsx)(N.a,{readOnly:!0,placeholder:""})})})}),Object(P.jsx)(m.a,{gutter:16,children:Object(P.jsx)(x.a,{span:24,children:Object(P.jsx)(_.a.Item,{name:"singular",label:"Singular",rules:[{required:!0,message:"Please enter singular entity name"}],children:Object(P.jsx)(N.a,{placeholder:"Please enter singular entity name"})})})})]})})},se=n(405),le=n(400),de=n(121),ue=n.n(de),je=(n(136),function(e){var t=e.isDrawerVisible,n=e.onDrawerClose,a=Object(r.useContext)(D.a),i=Object(c.a)(a,2)[1],o=Object(r.useState)(!1),s=Object(c.a)(o,2),l=s[0],d=s[1],u=Object(r.useState)({}),j=Object(c.a)(u,2),h=j[0],p=j[1],f=Object(r.useState)({}),y=Object(c.a)(f,2),v=y[0],g=y[1],C=Object(r.useState)(!0),w=Object(c.a)(C,2),S=w[0],E=w[1],A=Object(K.useLiveQuery)((function(){return q.a.custom_entity_defs.toArray()})),k=Object(K.useLiveQuery)((function(){return q.a.default_entity_colors.toArray()}));Object(r.useEffect)((function(){t&&_()}),[t]);var _=function(){p({}),g({}),d(!0)},N=function(){d(!1),n&&n()};return Object(P.jsxs)(T.a,{title:"Edit Colors",width:360,onClose:N,visible:l,bodyStyle:{paddingBottom:20},footer:Object(P.jsxs)("div",{style:{textAlign:"right"},children:[Object(P.jsx)(O.a,{onClick:N,style:{marginRight:8},children:"Cancel"}),Object(P.jsx)(O.a,{type:"primary",onClick:function(){if(E(!0),0!==Object.keys(h).length||0!==Object.keys(v).length){for(var e in h)I.a.updateDefaultEntityColor(i,parseInt(e),{color:h[e]}).then((function(e){})).catch((function(e){E(!1)}));for(var t in v)I.a.updateCustomEntityDefColor(i,parseInt(t),{color:v[t]}).then((function(e){})).catch((function(e){E(!1)}));S?(N(),b.b.success("Colors updated!")):(N(),b.b.error("Something went wrong, sorry :("))}else N()},children:"Update"})]}),children:[void 0!==k&&k.length>0&&Object(P.jsx)(se.b,{dataSource:k,renderItem:function(e){return Object(P.jsx)(se.b.Item,{className:"default-ent-color-list-item",children:Object(P.jsxs)(m.a,{style:{width:"100%"},children:[Object(P.jsx)(x.a,{span:18,style:{textTransform:"capitalize"},children:e.name}),Object(P.jsx)(x.a,{span:6,style:{textAlign:"right"},children:Object(P.jsx)(ue.a,{animation:"slide-up",placement:"bottomRight",enableAlpha:!1,color:e.color,onChange:function(t){!function(e,t){var n=h;n[e]=t,p(n)}(e.id,t.color)}})})]})})}}),void 0!==A&&A.length>0&&Object(P.jsxs)(P.Fragment,{children:[Object(P.jsx)(le.a,{style:{margin:"0"}}),Object(P.jsx)(se.b,{dataSource:A,renderItem:function(e){return Object(P.jsx)(se.b.Item,{className:"custom-ent-color-list-item",children:Object(P.jsxs)(m.a,{style:{width:"100%"},children:[Object(P.jsx)(x.a,{span:18,children:e.name}),Object(P.jsx)(x.a,{span:6,style:{textAlign:"right"},children:Object(P.jsx)(ue.a,{animation:"slide-up",placement:"bottomRight",enableAlpha:!1,color:e.color,onChange:function(t){!function(e,t){var n=v;n[e]=t,g(n)}(e.id,t.color)}})})]})})}})]})]})}),be=(n(367),function(e){var t,n=e.gameState,a=e.onEditGameStateProp,c=void 0===a?function(){}:a,r=e.onRemoveGameStateProp,i=void 0===r?function(){}:r;return t=n.type.endsWith("arr")?"[ "+n.default+" ]":"boolean"===n.type?n.default?"true":"false":n.default,Object(P.jsx)(se.b.Item,{className:"game-state-list-item",children:Object(P.jsxs)(m.a,{children:[Object(P.jsx)(x.a,{span:6,children:n.name}),Object(P.jsx)(x.a,{span:6,children:n.type}),Object(P.jsx)(x.a,{span:8,children:t}),Object(P.jsxs)(x.a,{span:4,style:{textAlign:"right"},children:["none"!==n.edit_mode&&Object(P.jsx)(O.a,{type:"link",size:"small",onClick:function(){c()},children:"Edit"}),n.removable&&Object(P.jsx)(p.a,{title:"Are you sure you want to remove this game state prop?",onConfirm:function(){i()},onCancel:function(){},okText:"Yes",cancelText:"No",placement:"bottomRight",children:Object(P.jsx)(O.a,{type:"link",size:"small",children:"Remove"})})]})]})})}),he=n(81),pe=n(207),Oe=n(406),fe=n(417),me=n(47),xe=pe.a.Option,ye=function(e){var t=e.entityType,n=void 0===t?"location":t,a=e.value,i=e.onChangeCallback,o=e.disabled,s=void 0!==o&&o,l=e.placeholder,d=void 0===l?"":l,u=e.emptyOption,j=void 0!==u&&u,b=e.emptyOptionLabel,h=void 0===b?"(empty)":b,p=e.customFetch,O=void 0===p?null:p,f=e.customFetchParams,m=void 0===f?null:f,x=Object(r.useState)([]),y=Object(c.a)(x,2),v=y[0],g=y[1],C=Object(r.useState)("name"),w=Object(c.a)(C,2),S=w[0],E=w[1];Object(r.useEffect)((function(){O?A():me.a.fetchStoryEntities(n).then((function(e){E("area"===n?"displayName":"name"),g(e)})).catch((function(e){console.log("||--FAIL",e)}))}),[]),Object(r.useEffect)((function(){O?A():me.a.fetchStoryEntities(n).then((function(e){E("area"===n?"displayName":"name"),g(e)})).catch((function(e){console.log("||--FAIL",e)}))}),[O,n]);var A=function(){switch(O){case"areasByLocation":me.a.fetchAreasByLocation(m.locationId).then((function(e){E("name"),g(e)})).catch((function(e){console.log("||--FAIL",e)}));break;case"allSequencedActs":me.a.fetchSequencedActs().then((function(e){E("name"),g(e)})).catch((function(e){console.log("||--FAIL",e)}))}};return Object(P.jsxs)(pe.a,{value:a,onChange:function(e){var t;i(e,-1!==(t=e)?v.find((function(e){return e.id===t})).name:"")},style:{width:"100%"},disabled:s,placeholder:d,children:[j&&Object(P.jsx)(xe,{value:-1,children:h},"empty-opt"),v&&v.length>0&&v.map((function(e){return Object(P.jsx)(xe,{value:e.id,children:e[S]},e.id)}))]})},ve=N.a.TextArea,ge=pe.a.Option,Ce=function(e){var t=e.gameStateProp,n=void 0===t?null:t,a=e.isDrawerVisible,i=e.onDrawerClose,o=Object(r.useContext)(D.a),s=Object(c.a)(o,2)[1],l=_.a.useForm(),d=Object(c.a)(l,1)[0],u=Object(r.useState)(!1),j=Object(c.a)(u,2),h=j[0],p=j[1],f=Object(r.useState)(""),y=Object(c.a)(f,2),v=y[0],g=y[1],C=Object(r.useState)(""),w=Object(c.a)(C,2),S=w[0],E=w[1],A=Object(r.useState)(0),k=Object(c.a)(A,2),R=k[0],F=k[1],V=Object(r.useState)(!0),B=Object(c.a)(V,2),M=B[0],G=B[1],U=Object(r.useState)(""),Y=Object(c.a)(U,2),Q=Y[0],W=Y[1],X=Object(r.useState)(-1),Z=Object(c.a)(X,2),J=Z[0],H=Z[1],$=Object(r.useState)(null),ee=Object(c.a)($,2),te=ee[0],ne=ee[1],ae=Object(r.useState)(!0),ce=Object(c.a)(ae,2),re=ce[0],ie=ce[1],oe=Object(K.useLiveQuery)((function(){return q.a.custom_entity_defs.toArray()}));Object(r.useEffect)((function(){a&&(d.resetFields(),E(""),n&&(d.setFieldsValue({name:n.name,type:n.type}),E(n.type),function(e){var t=e.default;if(S.endsWith("arr")){if(0===t.length)return;var n=t.split(",");switch(S){case"intarr":case"booleanarr":d.setFieldsValue({defaultValueArray:n.join("\n")});break;case"stringarr":case"locationarr":case"areaarr":case"characterarr":default:var a,c=[],r=Object(L.a)(n);try{for(r.s();!(a=r.n()).done;){var i=a.value;c.push(i.slice(1,-1))}}catch(o){r.e(o)}finally{r.f()}d.setFieldsValue({defaultValueArray:c.join("\n")})}}else switch(S){case"int":d.setFieldsValue({defaultValueInt:t});break;case"boolean":d.setFieldsValue({defaultValueBool:t}),G(t);break;case"string":d.setFieldsValue({defaultValueString:t});break;case"location":case"area":case"character":default:H(null!==e.default_tids?e.default_tids:-1),ne(t)}}(n)),se())}),[a,d,n]);var se=function(){p(!0)},le=function(){p(!1),i&&i()},de=function(){return"string"===S},ue=function(){return""!==S&&"int"!==S&&"boolean"!==S&&"string"!==S&&!S.endsWith("arr")},je=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];switch(S){case"intarr":return e?"int[]":"Place one integer per line";case"booleanarr":return e?"boolean[]":"Place one boolean per line";case"stringarr":return e?"string[]":"Place one string per line";case"locationarr":return e?"location[]":"Place one location per line";case"areaarr":return e?"area[]":"Place one area per line";case"characterarr":return e?"character[]":"Place one character per line";default:if(S.endsWith("arr")){var t=S.slice(0,-3);return e?t+"[]":"Place one "+t+" per line"}return e?"[]":"Place one item per line"}},be=function(e){var t=e.defaultValueArray;if(0===t.length)me(e);else{var n=t.split("\n");switch(S){case"intarr":var a,c=Object(L.a)(n);try{for(c.s();!(a=c.n()).done;){var r=a.value;if(!Number.isInteger(parseInt(r)))return void b.b.error("All values in array must be integers")}}catch(h){c.e(h)}finally{c.f()}me(e);break;case"booleanarr":var i,o=Object(L.a)(n);try{for(o.s();!(i=o.n()).done;){var s=i.value;if("true"!==s&&"false"!==s)return void b.b.error('All values in array must be "true" or "false"')}}catch(h){o.e(h)}finally{o.f()}me(e);break;case"stringarr":var l,d=Object(L.a)(n);try{for(d.s();!(l=d.n()).done;){if(""===l.value.trim())return void b.b.error("Do not leave empty strings (just spaces are considered empty)")}}catch(h){d.e(h)}finally{d.f()}me(e);break;case"locationarr":z.validateEntityNames(n,q.a.locations).then((function(){me(e)})).catch((function(e){b.b.error("Invalid values: "+e.join(", "))}));break;case"areaarr":z.validateEntityNames(n,q.a.areas).then((function(){me(e)})).catch((function(e){b.b.error("Invalid values: "+e.join(", "))}));break;case"characterarr":z.validateEntityNames(n,q.a.characters).then((function(){me(e)})).catch((function(e){b.b.error("Invalid values: "+e.join(", "))}));break;default:var u=S.slice(0,-3),j=oe.find((function(e){return e.singular_name===u}));j&&z.validateCustomEntityNames(n,j.id).then((function(){me(e)})).catch((function(e){b.b.error("Invalid values: "+e.join(", "))}))}}},me=function(e){if(null===n){var t=e.name.trim(),a=xe(e),c=Object(he.a)(Object(he.a)({name:t,type:S},a),{},{editMode:"name|default",removable:!0});I.a.createNewGameStateProp(s,c).then((function(e){le(),b.b.success("New game state prop created!")})).catch((function(e){le(),b.b.error("Something went wrong, sorry :(")}))}else{var r=e.name.trim(),i=xe(e),o=n.edit_mode,l=n.removable,d=Object(he.a)(Object(he.a)({name:r,type:S},i),{},{editMode:o,removable:l});I.a.updateGameStateProp(s,n.id,d).then((function(e){le(),b.b.success("Game state prop edited!")})).catch((function(e){le(),b.b.error("Something went wrong, sorry :(")}))}},xe=function(e){if(S.endsWith("arr")){var t=e.defaultValueArray;if(0===t.length)return{defaultValue:""};var n=t.split("\n");switch(S){case"intarr":case"booleanarr":return{defaultValue:n.join(",")};case"stringarr":case"locationarr":case"areaarr":case"characterarr":default:var a,c=[],r=Object(L.a)(n);try{for(r.s();!(a=r.n()).done;){var i=a.value;c.push('"'+i+'"')}}catch(s){r.e(s)}finally{r.f()}return{defaultValue:c.join(",")}}}else switch(S){case"int":return{defaultValue:parseInt(e.defaultValueInt)};case"boolean":return{defaultValue:e.defaultValueBool};case"string":return{defaultValue:e.defaultValueString};case"location":case"area":case"character":default:var o;return o="location"===S||"area"===S||"character"===S?S+"s":"custom_entities",-1!==J?{defaultValue:te,defaultTable:o,defaultTids:J}:{defaultValue:null,defaultTable:o,defaultTids:null}}},Ce=function(){if(null===n)return!1;var e=n.edit_mode.split("|");return e.indexOf("all")<0&&e.indexOf("default")<0};return Object(P.jsx)(T.a,{title:null===n?"New prop":"Edit prop",width:360,onClose:le,visible:h,bodyStyle:{paddingBottom:20},footer:Object(P.jsxs)("div",{style:{textAlign:"right"},children:[Object(P.jsx)(O.a,{onClick:le,style:{marginRight:8},children:"Cancel"}),Object(P.jsx)(O.a,{type:"primary",htmlType:"submit",form:"add-edit-game-state-prop-id",children:null===n?"Create":"Update"})]}),children:Object(P.jsxs)(_.a,{layout:"vertical",name:"add-edit-game-state-prop",id:"add-edit-game-state-prop-id",form:d,onFinish:function(e){if(""!==e.name.trim())switch(S){case"int":Number.isInteger(parseInt(e.defaultValueInt))?me(e):b.b.error("Default is not an integer");break;case"boolean":case"string":case"location":case"area":case"character":me(e);break;default:S.endsWith("arr")?be(e):me(e)}else b.b.error("Do not leave name empty")},requiredMark:!1,children:[Object(P.jsx)(m.a,{gutter:16,children:Object(P.jsx)(x.a,{span:24,children:Object(P.jsx)(_.a.Item,{name:"name",label:"Name",rules:[{required:!0,message:"Please enter a name"}],children:Object(P.jsx)(N.a,{placeholder:"Please enter a name",value:v,onChange:function(e){g(e.target.value)},disabled:function(){if(null===n)return!1;var e=n.edit_mode.split("|");return e.indexOf("all")<0&&e.indexOf("name")<0}()})})})}),Object(P.jsx)(m.a,{gutter:16,children:Object(P.jsx)(x.a,{span:24,children:Object(P.jsx)(_.a.Item,{name:"type",label:"Type",rules:[{required:!0,message:"Please select a type"}],children:Object(P.jsxs)(pe.a,{value:S,onChange:function(e){var t;"int"===(t=e)&&d.setFieldsValue({defaultValueInt:""}),"boolean"===t&&d.setFieldsValue({defaultValueBool:M}),"string"===t&&d.setFieldsValue({defaultValueString:""}),t.endsWith("arr")&&d.setFieldsValue({defaultValueArray:""}),""===t||"int"===t||"boolean"===t||"string"===t||t.endsWith("arr")||H(-1),E(t)},disabled:function(){if(null===n)return!1;var e=n.edit_mode.split("|");return e.indexOf("all")<0&&e.indexOf("type")<0}(),children:[Object(P.jsx)(ge,{value:"int",children:"int"}),Object(P.jsx)(ge,{value:"intarr",children:"int[]"}),Object(P.jsx)(ge,{value:"boolean",children:"boolean"}),Object(P.jsx)(ge,{value:"booleanarr",children:"boolean[]"}),Object(P.jsx)(ge,{value:"string",children:"string"}),Object(P.jsx)(ge,{value:"stringarr",children:"string[]"}),Object(P.jsx)(ge,{value:"location",children:"location"}),Object(P.jsx)(ge,{value:"locationarr",children:"location[]"}),Object(P.jsx)(ge,{value:"area",children:"area"}),Object(P.jsx)(ge,{value:"areaarr",children:"area[]"}),Object(P.jsx)(ge,{value:"character",children:"character"}),Object(P.jsx)(ge,{value:"characterarr",children:"character[]"}),void 0!==oe&&oe.map((function(e){return Object(P.jsxs)(r.Fragment,{children:[Object(P.jsx)(ge,{value:e.singular_name,children:e.singular_name}),Object(P.jsxs)(ge,{value:e.singular_name+"arr",children:[e.singular_name,"[]"]})]},e.singular_name)}))]})})})}),Object(P.jsx)(m.a,{gutter:16,style:{display:"int"===S?"block":"none"},children:Object(P.jsx)(x.a,{span:24,children:Object(P.jsx)(_.a.Item,{name:"defaultValueInt",label:"Default value (int)",rules:[{required:"int"===S,message:"Please enter an integer"}],children:Object(P.jsx)(Oe.a,{disabled:Ce(),placeholder:"Please enter an integer",value:R,onChange:function(e){F(e)},style:{width:"100%"}})})})}),Object(P.jsx)(m.a,{gutter:16,style:{display:"boolean"===S?"block":"none"},children:Object(P.jsx)(x.a,{span:24,children:Object(P.jsx)(_.a.Item,{name:"defaultValueBool",label:"Default value (boolean)",children:Object(P.jsx)(fe.a,{disabled:Ce(),checkedChildren:"true",unCheckedChildren:"false",checked:M,defaultChecked:!0,onChange:function(e){G(e)}})})})}),Object(P.jsx)(m.a,{gutter:16,style:{display:de()?"block":"none"},children:Object(P.jsx)(x.a,{span:24,children:Object(P.jsx)(_.a.Item,{name:"defaultValueString",label:"Default value (string)",rules:[{required:de()&&"string"!==S,message:"Please enter a default value"}],children:Object(P.jsx)(N.a,{disabled:Ce(),placeholder:"Please enter a default value",value:Q,onChange:function(e){W(e.target.value)}})})})}),Object(P.jsx)(m.a,{gutter:16,style:{display:ue()?"block":"none"},children:Object(P.jsx)(x.a,{span:24,children:Object(P.jsx)(_.a.Item,{label:"Default value",children:ue()&&Object(P.jsx)(ye,{entityType:S,value:J,onChangeCallback:function(e,t){H(e),ne(t)},disabled:Ce(),placeholder:"Please select a default value",emptyOption:!0})})})}),Object(P.jsx)(m.a,{gutter:16,style:{display:S.endsWith("arr")?"block":"none"},children:Object(P.jsx)(x.a,{span:24,children:Object(P.jsx)(_.a.Item,{name:"defaultValueArray",label:"Default value ("+je()+")",children:Object(P.jsx)(ve,{disabled:Ce(),rows:10,placeholder:je(!1)+" Leave empty for empty array.",value:re,onChange:function(e){ie(e.target.value)}})})})})]})})},we=o.a.Text,Se=function(){var e=Object(r.useContext)(D.a),t=Object(c.a)(e,2)[1],n=Object(r.useState)(!1),a=Object(c.a)(n,2),i=a[0],o=a[1],s=Object(r.useState)(null),l=Object(c.a)(s,2),d=l[0],u=l[1],j=Object(K.useLiveQuery)((function(){return q.a.game_state_props.toArray()})),h=Object(P.jsxs)(m.a,{children:[Object(P.jsx)(x.a,{span:6,children:Object(P.jsx)(we,{strong:!0,children:"Name"})}),Object(P.jsx)(x.a,{span:6,children:Object(P.jsx)(we,{strong:!0,children:"Type"})}),Object(P.jsx)(x.a,{span:8,children:Object(P.jsx)(we,{strong:!0,children:"Default"})}),Object(P.jsx)(x.a,{span:4})]});return Object(P.jsxs)("div",{children:[void 0!==j&&j.length>0&&Object(P.jsx)(se.b,{style:{marginBottom:"20px",maxWidth:"94%"},header:h,dataSource:j,renderItem:function(e){return Object(P.jsx)(be,{gameState:e,onEditGameStateProp:function(){u(e),o(!0)},onRemoveGameStateProp:function(){var n;n=e,I.a.deleteGameStateProp(t,n.id).then((function(e){b.b.success("Game state prop removed!")})).catch((function(e){b.b.error("Something went wrong, sorry :(")}))}})}}),Object(P.jsx)(O.a,{type:"primary",onClick:function(){u(null),o(!0)},children:"Add Game State Prop"}),Object(P.jsx)(Ce,{gameStateProp:d,isDrawerVisible:i,onDrawerClose:function(){o(!1)}})]})},Ee=n(415),Ae=n(429),ke=(n(368),o.a.Text),_e=function(e){var t=e.location,n=e.canEdit,a=void 0===n||n,c=e.canRemove,r=void 0===c||c,i=e.onRemove,o=void 0===i?function(){}:i,s=e.onEdit,l=void 0===s?function(){}:s,d=e.onEditMap,u=void 0===d?function(){}:d,j=e.onAddArea,b=void 0===j?function(){}:j,h=e.onEditArea,f=void 0===h?function(){}:h,y=e.onRemoveArea,v=void 0===y?function(){}:y,g=Object(K.useLiveQuery)((function(){return q.a.areas.where("location_id").equals(t.id).toArray()})),C=[];C.push(Object(P.jsx)(O.a,{type:"link",size:"small",onClick:u,children:"Map"},"edit-map")),a&&C.push(Object(P.jsx)(O.a,{type:"link",size:"small",onClick:l,children:"Edit"},"edit-location")),r&&C.push(Object(P.jsx)(p.a,{title:"Are you sure you want to remove this location and all its areas?",onConfirm:o,onCancel:function(){},okText:"Yes",cancelText:"No",placement:"bottomRight",children:Object(P.jsx)(O.a,{type:"link",size:"small",children:"Remove"})},"remove-location"));var w=Object(P.jsxs)(m.a,{children:[Object(P.jsx)(x.a,{span:6,children:Object(P.jsx)(ke,{strong:!0,children:"Area Name"})}),Object(P.jsx)(x.a,{span:12,children:Object(P.jsx)(ke,{strong:!0,children:"Description"})}),Object(P.jsx)(x.a,{span:6})]});return Object(P.jsxs)(Ee.a,{className:"location-view",size:"small",title:t.name,extra:C,headStyle:{background:"#f5f5f5"},children:[Object(P.jsx)(ke,{children:t.description}),Object(P.jsx)(le.a,{}),void 0!==g&&g.length>0&&Object(P.jsx)(se.b,{header:w,dataSource:g,renderItem:function(e){return Object(P.jsx)(se.b.Item,{className:"area-list-item",children:Object(P.jsxs)(m.a,{children:[Object(P.jsxs)(x.a,{span:6,children:[Object(P.jsx)(Ae.a,{style:{color:e.color}})," ",e.name]}),Object(P.jsx)(x.a,{span:12,children:e.description}),Object(P.jsxs)(x.a,{span:6,style:{textAlign:"right"},children:[Object(P.jsx)(O.a,{type:"link",size:"small",onClick:function(){f(e)},children:"Edit"}),Object(P.jsx)(p.a,{title:"Are you sure you want to remove this area?",onConfirm:function(){v(e)},onCancel:function(){},okText:"Yes",cancelText:"No",placement:"bottomRight",children:Object(P.jsx)(O.a,{type:"link",size:"small",children:"Remove"})})]})]})})}}),Object(P.jsx)(O.a,{type:"default",size:"small",onClick:b,children:"Add Area"})]})},Te=N.a.TextArea,Ne=function(e){var t=e.location,n=void 0===t?null:t,a=e.isDrawerVisible,i=e.onDrawerClose,o=Object(r.useContext)(D.a),s=Object(c.a)(o,2)[1],l=_.a.useForm(),d=Object(c.a)(l,1)[0],u=Object(r.useState)(!1),j=Object(c.a)(u,2),h=j[0],p=j[1],f=Object(r.useState)(""),y=Object(c.a)(f,2),v=y[0],g=y[1],C=Object(r.useState)(""),w=Object(c.a)(C,2),S=w[0],E=w[1];Object(r.useEffect)((function(){a&&(d.resetFields(),n&&d.setFieldsValue({name:n.name,description:n.description}),A())}),[a,d,n]);var A=function(){p(!0)},k=function(){p(!1),i&&i()};return Object(P.jsx)(T.a,{title:null===n?"New location":"Edit location",width:360,onClose:k,visible:h,bodyStyle:{paddingBottom:20},footer:Object(P.jsxs)("div",{style:{textAlign:"right"},children:[Object(P.jsx)(O.a,{onClick:k,style:{marginRight:8},children:"Cancel"}),Object(P.jsx)(O.a,{type:"primary",htmlType:"submit",form:"add-edit-location-id",children:null===n?"Create":"Update"})]}),children:Object(P.jsxs)(_.a,{layout:"vertical",name:"add-edit-location",id:"add-edit-location-id",form:d,onFinish:function(e){var t=e.name.trim(),a=e.description.trim();if(""===t||""===a)return k(),void b.b.error("Do not leave empty fields, sorry :(");var c={name:t,description:a};null===n?I.a.createNewLocation(s,c).then((function(e){k(),b.b.success("New location created!")})).catch((function(e){k(),b.b.error("Something went wrong, sorry :(")})):I.a.updateLocation(s,n.id,c).then((function(e){k(),b.b.success("Location edited!")})).catch((function(e){k(),b.b.error("Something went wrong, sorry :(")}))},requiredMark:!1,children:[Object(P.jsx)(m.a,{gutter:16,children:Object(P.jsx)(x.a,{span:24,children:Object(P.jsx)(_.a.Item,{name:"name",label:"Name",rules:[{required:!0,message:"Please enter a name"}],children:Object(P.jsx)(N.a,{placeholder:"Please enter a name",value:v,onChange:function(e){g(e.target.value)}})})})}),Object(P.jsx)(m.a,{gutter:16,children:Object(P.jsx)(x.a,{span:24,children:Object(P.jsx)(_.a.Item,{name:"description",label:"Description",rules:[{required:!0,message:"Please enter a description"}],children:Object(P.jsx)(Te,{rows:10,placeholder:"Please enter a description",value:S,onChange:function(e){E(e.target.value)}})})})})]})})},De=N.a.TextArea,Ie="#00ff00",Pe=function(e){var t=e.area,n=void 0===t?null:t,a=e.location,i=e.isDrawerVisible,o=e.onDrawerClose,s=Object(r.useContext)(D.a),l=Object(c.a)(s,2)[1],d=_.a.useForm(),u=Object(c.a)(d,1)[0],j=Object(r.useState)(!1),h=Object(c.a)(j,2),p=h[0],f=h[1],y=Object(r.useState)(""),v=Object(c.a)(y,2),g=v[0],C=v[1],w=Object(r.useState)(""),S=Object(c.a)(w,2),E=S[0],A=S[1],k=Object(r.useState)(Ie),R=Object(c.a)(k,2),L=R[0],F=R[1];Object(r.useEffect)((function(){i&&(u.resetFields(),n?(u.setFieldsValue({name:n.name,description:n.description}),F(n.color)):F(Ie),V())}),[i,u,n]);var V=function(){f(!0)},q=function(){f(!1),o&&o()};return Object(P.jsx)(T.a,{title:(null===n?"New area":"Edit area")+" in "+(a&&a.name),width:360,onClose:q,visible:p,bodyStyle:{paddingBottom:20},footer:Object(P.jsxs)("div",{style:{textAlign:"right"},children:[Object(P.jsx)(O.a,{onClick:q,style:{marginRight:8},children:"Cancel"}),Object(P.jsx)(O.a,{type:"primary",htmlType:"submit",form:"add-edit-area-id",children:null===n?"Create":"Update"})]}),children:Object(P.jsxs)(_.a,{layout:"vertical",name:"add-edit-area",id:"add-edit-area-id",form:u,onFinish:function(e){var t=e.name.trim(),c=e.description.trim();if(""===t||""===c)return q(),void b.b.error("Do not leave empty fields, sorry :(");var r={name:t,description:c,color:L};null===n?(r.location_id=a.id,I.a.createNewArea(l,r).then((function(e){q(),b.b.success("New area created!")})).catch((function(e){q(),b.b.error("Something went wrong, sorry :(")}))):I.a.updateArea(l,n.id,r).then((function(e){q(),b.b.success("Area edited!")})).catch((function(e){q(),b.b.error("Something went wrong, sorry :(")}))},requiredMark:!1,children:[Object(P.jsx)(m.a,{gutter:16,children:Object(P.jsx)(x.a,{span:24,children:Object(P.jsx)(_.a.Item,{name:"name",label:"Name",rules:[{required:!0,message:"Please enter a name"}],children:Object(P.jsx)(N.a,{placeholder:"Please enter a name",value:g,onChange:function(e){C(e.target.value)}})})})}),Object(P.jsx)(m.a,{gutter:16,children:Object(P.jsx)(x.a,{span:24,children:Object(P.jsx)(_.a.Item,{name:"description",label:"Description",rules:[{required:!0,message:"Please enter a description"}],children:Object(P.jsx)(De,{rows:10,placeholder:"Please enter a description",value:E,onChange:function(e){A(e.target.value)}})})})}),Object(P.jsxs)(m.a,{gutter:16,children:[Object(P.jsx)(x.a,{span:18,children:"Color"}),Object(P.jsx)(x.a,{span:6,style:{textAlign:"right",marginBottom:16},children:Object(P.jsx)(ue.a,{animation:"slide-up",placement:"bottomRight",enableAlpha:!1,color:L,onChange:function(e){F(e.color)}})})]})]})})},Re=n(149),Le=(n(369),function(e){var t=e.location,n=void 0===t?null:t,a=e.isDrawerVisible,i=e.onDrawerClose,o=Object(r.useContext)(D.a),s=Object(c.a)(o,2)[1],l=Object(r.useState)(!1),d=Object(c.a)(l,2),u=d[0],j=d[1],h=Object(r.useState)(!0),p=Object(c.a)(h,2),f=p[0],y=p[1],v=Object(r.useState)(null),g=Object(c.a)(v,2),C=g[0],w=g[1],S=Object(r.useState)(null),E=Object(c.a)(S,2),A=E[0],k=E[1],_=Object(r.useState)({}),N=Object(c.a)(_,2),R=N[0],L=N[1],F=Re.a.getLocationMapDimension();Object(r.useEffect)((function(){a&&(y(!0),w(null),L(Re.a.convertJsonMapToEditableObject(n.map)),B(),V())}),[a,n]);var V=function(){j(!0)},q=function(){j(!1),i&&i()},B=function(){me.a.fetchAreasByLocation(n.id).then((function(e){k(e)})).catch((function(e){console.log("||--FAIL",e)}))},z=function(e){var t;if(e.target.dataset.col&&e.target.dataset.row){var n=e.target.dataset.col+"-"+e.target.dataset.row;f?null!==C&&(t=Re.a.setMapTile(Object.assign({},R),n,C.id),L(t)):(t=Re.a.setMapTile(Object.assign({},R),n,null),L(t))}};return Object(P.jsxs)(T.a,{title:"Edit Map: "+(n?n.name:""),width:720,onClose:q,visible:u,bodyStyle:{paddingBottom:20},footer:Object(P.jsxs)("div",{style:{textAlign:"right"},children:[Object(P.jsx)(O.a,{onClick:q,style:{marginRight:8},children:"Cancel"}),Object(P.jsx)(O.a,{type:"primary",onClick:function(){var e={map:Re.a.convertEditableObjectToJsonMap(R)};I.a.updateLocationMap(s,n.id,e).then((function(e){q(),b.b.success("Location map updated!")})).catch((function(e){q(),b.b.error("Something went wrong, sorry :(")}))},children:"Save"})]}),children:[Object(P.jsxs)(m.a,{gutter:[8,16],style:{paddingBottom:16},children:[Object(P.jsx)(x.a,{span:18,children:Object(P.jsx)(fe.a,{checkedChildren:"SET",unCheckedChildren:"ERASE",checked:f,onChange:function(e){y(e)}})}),Object(P.jsx)(x.a,{span:6,style:{textAlign:"right"},children:Object(P.jsx)(O.a,{type:"default",size:"small",onClick:function(){L({})},children:"Clear map"})})]}),Object(P.jsx)(m.a,{gutter:[8,16],style:{display:f?"block":"none",paddingBottom:16},children:Object(P.jsx)(x.a,{span:24,children:Object(P.jsx)(ye,{customFetch:u?"areasByLocation":null,customFetchParams:{locationId:n&&n.id},value:C?C.id:null,onChangeCallback:function(e,t){!function(e){var t=A.find((function(t){return t.id===e}));w(t)}(e)},placeholder:"Area to set"})})}),function(){for(var e,t,n,a=A&&A.reduce((function(e,t){return e[t.id]=t.color,e}),{}),c=["map-view-edit"],r=[],i=0;i<F.y;i++){n=[];for(var o=0;o<F.x;o++)R[e=o+"-"+i]&&null!==a?(t=a[R[e]],n.push(Object(P.jsxs)("div",{className:"map-col map-col-".concat(o),"data-col":o,"data-row":i,style:{backgroundColor:t,color:"#000"},children:[o,"-",i]},"map-col-".concat(o,"-").concat(i)))):n.push(Object(P.jsxs)("div",{className:"map-col map-col-".concat(o),"data-col":o,"data-row":i,children:[o,"-",i]},"map-col-".concat(o,"-").concat(i)));r.push(Object(P.jsx)("div",{className:"map-row map-row-".concat(i),children:n},"map-row-".concat(i)))}return f?null!==C&&c.push("painting"):c.push("erasing"),Object(P.jsx)("div",{className:c.join(" "),onClick:z,children:r})}()]})}),Fe=function(){var e=Object(r.useContext)(D.a),t=Object(c.a)(e,2)[1],n=Object(r.useState)(!1),a=Object(c.a)(n,2),i=a[0],o=a[1],s=Object(r.useState)(!1),l=Object(c.a)(s,2),d=l[0],u=l[1],j=Object(r.useState)(!1),h=Object(c.a)(j,2),p=h[0],f=h[1],m=Object(r.useState)(null),x=Object(c.a)(m,2),y=x[0],v=x[1],g=Object(r.useState)(null),C=Object(c.a)(g,2),w=C[0],S=C[1],E=Object(K.useLiveQuery)((function(){return q.a.locations.toArray()}));return Object(P.jsxs)("div",{children:[void 0!==E&&E.map((function(e){return Object(P.jsx)(_e,{location:e,onRemove:function(){!function(e){I.a.deleteLocation(t,e.id).then((function(e){b.b.success("Location removed!")})).catch((function(e){b.b.error("Something went wrong, sorry :(")}))}(e)},onEdit:function(){!function(e){v(e),o(!0)}(e)},onEditMap:function(){!function(e){v(e),u(!0)}(e)},onAddArea:function(){!function(e){S(null),v(e),f(!0)}(e)},onEditArea:function(t){!function(e,t){v(t),S(e),f(!0)}(t,e)},onRemoveArea:function(e){!function(e){I.a.deleteArea(t,e.id).then((function(e){b.b.success("Area removed!")})).catch((function(e){b.b.error("Something went wrong, sorry :(")}))}(e)}},e.id)})),Object(P.jsx)(O.a,{type:"primary",onClick:function(){v(null),o(!0)},children:"Add Location"}),Object(P.jsx)(Ne,{location:y,isDrawerVisible:i,onDrawerClose:function(){o(!1)}}),Object(P.jsx)(Le,{location:y,isDrawerVisible:d,onDrawerClose:function(){u(!1)}}),Object(P.jsx)(Pe,{area:w,location:y,isDrawerVisible:p,onDrawerClose:function(){f(!1)}})]})},Ve=n(420),qe=o.a.Text,Be=function(e){var t=e.character,n=e.canEdit,a=void 0===n||n,c=e.canRemove,r=void 0===c||c,i=e.onRemove,o=void 0===i?function(){}:i,s=e.onEdit,l=void 0===s?function(){}:s,d=[];a&&d.push(Object(P.jsx)(O.a,{type:"link",size:"small",onClick:l,children:"Edit"},"edit-character")),r&&d.push(Object(P.jsx)(p.a,{title:"Are you sure you want to remove this character?",onConfirm:o,onCancel:function(){},okText:"Yes",cancelText:"No",placement:"bottomRight",children:Object(P.jsx)(O.a,{type:"link",size:"small",children:"Remove"})},"remove-character"));var u=t.name+"  ("+(t.is_pc?"PC":"NPC")+")",j=Object(P.jsxs)(P.Fragment,{children:[" ",Object(P.jsx)(Ve.a,{style:{color:t.color}})," ",u," "]});return Object(P.jsx)(Ee.a,{className:"character-view",size:"small",title:j,extra:d,headStyle:{background:"#f5f5f5"},style:{marginBottom:16},children:Object(P.jsx)(qe,{children:t.description})})},ze=N.a.TextArea,Me="#0000FF",Ge=function(e){var t=e.character,n=void 0===t?null:t,a=e.isDrawerVisible,i=e.onDrawerClose,o=Object(r.useContext)(D.a),s=Object(c.a)(o,2)[1],l=_.a.useForm(),d=Object(c.a)(l,1)[0],u=Object(r.useState)(!1),j=Object(c.a)(u,2),h=j[0],p=j[1],f=Object(r.useState)(""),y=Object(c.a)(f,2),v=y[0],g=y[1],C=Object(r.useState)(""),w=Object(c.a)(C,2),S=w[0],E=w[1],A=Object(r.useState)(!1),k=Object(c.a)(A,2),R=k[0],L=k[1],F=Object(r.useState)(Me),V=Object(c.a)(F,2),q=V[0],B=V[1];Object(r.useEffect)((function(){a&&(d.resetFields(),n?(d.setFieldsValue({name:n.name,description:n.description,isPC:n}),L(n.is_pc),B(n.color)):(d.setFieldsValue({isPC:!1}),B(Me)),z())}),[a,d,n]);var z=function(){p(!0)},M=function(){p(!1),i&&i()};return Object(P.jsx)(T.a,{title:null===n?"New character":"Edit character",width:360,onClose:M,visible:h,bodyStyle:{paddingBottom:20},footer:Object(P.jsxs)("div",{style:{textAlign:"right"},children:[Object(P.jsx)(O.a,{onClick:M,style:{marginRight:8},children:"Cancel"}),Object(P.jsx)(O.a,{type:"primary",htmlType:"submit",form:"add-edit-character-id",children:null===n?"Create":"Update"})]}),children:Object(P.jsxs)(_.a,{layout:"vertical",name:"add-edit-character",id:"add-edit-character-id",form:d,onFinish:function(e){var t=e.name.trim(),a=e.description.trim(),c=e.isPC;if(""===t||""===a)return M(),void b.b.error("Do not leave empty fields, sorry :(");var r={name:t,description:a,isPC:c,color:q};null===n?I.a.createNewCharacter(s,r).then((function(e){M(),b.b.success("New character created!")})).catch((function(e){M(),b.b.error("Something went wrong, sorry :(")})):I.a.updateCharacter(s,n.id,r).then((function(e){M(),b.b.success("Character edited!")})).catch((function(e){M(),b.b.error("Something went wrong, sorry :(")}))},requiredMark:!1,children:[Object(P.jsx)(m.a,{gutter:16,children:Object(P.jsx)(x.a,{span:24,children:Object(P.jsx)(_.a.Item,{name:"name",label:"Name",rules:[{required:!0,message:"Please enter a name"}],children:Object(P.jsx)(N.a,{placeholder:"Please enter a name",value:v,onChange:function(e){g(e.target.value)}})})})}),Object(P.jsx)(m.a,{gutter:16,children:Object(P.jsx)(x.a,{span:24,children:Object(P.jsx)(_.a.Item,{name:"description",label:"Description",rules:[{required:!0,message:"Please enter a description"}],children:Object(P.jsx)(ze,{rows:10,placeholder:"Please enter a description",value:S,onChange:function(e){E(e.target.value)}})})})}),Object(P.jsxs)(m.a,{gutter:16,children:[Object(P.jsx)(x.a,{span:18,children:"Color"}),Object(P.jsx)(x.a,{span:6,style:{textAlign:"right",marginBottom:16},children:Object(P.jsx)(ue.a,{animation:"slide-up",placement:"bottomRight",enableAlpha:!1,color:q,onChange:function(e){B(e.color)}})})]}),Object(P.jsx)(m.a,{gutter:16,children:Object(P.jsx)(x.a,{span:24,children:Object(P.jsx)(_.a.Item,{name:"isPC",label:"PC / NPC",children:Object(P.jsx)(fe.a,{checkedChildren:"PC",unCheckedChildren:"NPC",checked:R,onChange:function(e){L(e)}})})})})]})})},Ue=function(){var e=Object(r.useContext)(D.a),t=Object(c.a)(e,2)[1],n=Object(r.useState)(!1),a=Object(c.a)(n,2),i=a[0],o=a[1],s=Object(r.useState)(null),l=Object(c.a)(s,2),d=l[0],u=l[1],j=Object(K.useLiveQuery)((function(){return q.a.characters.toArray()}));return Object(P.jsxs)("div",{children:[void 0!==j&&j.map((function(e){return Object(P.jsx)(Be,{character:e,onRemove:function(){!function(e){I.a.deleteCharacter(t,e.id).then((function(e){b.b.success("Character removed!")})).catch((function(e){b.b.error("Something went wrong, sorry :(")}))}(e)},onEdit:function(){!function(e){u(e),o(!0)}(e)}},e.id)})),Object(P.jsx)(O.a,{type:"primary",onClick:function(){u(null),o(!0)},children:"Add Character"}),Object(P.jsx)(Ge,{character:d,isDrawerVisible:i,onDrawerClose:function(){o(!1)}})]})},Ye=(n(370),o.a.Text),Qe=function(e){var t=e.entity,n=e.entityName,a=void 0===n?"entity":n,c=e.canEdit,r=void 0===c||c,i=e.canRemove,o=void 0===i||i,s=e.onRemove,l=void 0===s?function(){}:s,d=e.onEdit,u=void 0===d?function(){}:d,j=[];return r&&j.push(Object(P.jsx)(O.a,{type:"link",size:"small",onClick:u,children:"Edit"},"edit-entity")),o&&j.push(Object(P.jsx)(p.a,{title:"Are you sure you want to remove this ".concat(a,"?"),onConfirm:l,onCancel:function(){},okText:"Yes",cancelText:"No",placement:"bottomRight",children:Object(P.jsx)(O.a,{type:"link",size:"small",children:"Remove"})},"remove-entity")),Object(P.jsx)(Ee.a,{className:"simple-entity-view",size:"small",title:t.name,extra:j,headStyle:{background:"#f5f5f5"},children:Object(P.jsx)(Ye,{children:t.description})})},We=N.a.TextArea,Xe=function(e){var t=e.entity,n=void 0===t?null:t,a=e.entityDef,i=e.isDrawerVisible,o=e.onDrawerClose,s=Object(r.useContext)(D.a),l=Object(c.a)(s,2)[1],d=_.a.useForm(),u=Object(c.a)(d,1)[0],j=Object(r.useState)(!1),h=Object(c.a)(j,2),p=h[0],f=h[1],y=Object(r.useState)(""),v=Object(c.a)(y,2),g=v[0],C=v[1],w=Object(r.useState)(""),S=Object(c.a)(w,2),E=S[0],A=S[1],k=a.singular_name.toLowerCase().charAt(0).toUpperCase()+a.singular_name.toLowerCase().slice(1);Object(r.useEffect)((function(){i&&(u.resetFields(),n&&u.setFieldsValue({name:n.name,description:n.description}),R())}),[i,u,n]);var R=function(){f(!0)},L=function(){f(!1),o&&o()};return Object(P.jsx)(T.a,{title:(null===n?"New":"Edit")+" "+a.singular_name.toLowerCase(),width:360,onClose:L,visible:p,bodyStyle:{paddingBottom:20},footer:Object(P.jsxs)("div",{style:{textAlign:"right"},children:[Object(P.jsx)(O.a,{onClick:L,style:{marginRight:8},children:"Cancel"}),Object(P.jsx)(O.a,{type:"primary",htmlType:"submit",form:"add-edit-custom-entity-id-"+a.key,children:null===n?"Create":"Update"})]}),children:Object(P.jsxs)(_.a,{layout:"vertical",name:"add-edit-custom-entity-"+a.key,id:"add-edit-custom-entity-id-"+a.key,form:u,onFinish:function(e){!function(e){var t=e.name.trim(),c=e.description.trim();if(""===t||""===c)return L(),void b.b.error("Do not leave empty fields, sorry :(");var r={name:t,description:c};null===n?(r.custom_entity_def_id=a.id,I.a.createNewCustomEntity(l,r).then((function(e){L(),b.b.success("New "+a.singular_name.toLowerCase()+" created!")})).catch((function(e){L(),b.b.error("Something went wrong, sorry :(")}))):I.a.updateCustomEntity(l,n.id,r).then((function(e){L(),b.b.success(k+" edited!")})).catch((function(e){L(),b.b.error("Something went wrong, sorry :(")}))}(e)},requiredMark:!1,children:[Object(P.jsx)(m.a,{gutter:16,children:Object(P.jsx)(x.a,{span:24,children:Object(P.jsx)(_.a.Item,{name:"name",label:"Name",rules:[{required:!0,message:"Please enter a name"}],children:Object(P.jsx)(N.a,{placeholder:"Please enter a name",value:g,onChange:function(e){C(e.target.value)}})})})}),Object(P.jsx)(m.a,{gutter:16,children:Object(P.jsx)(x.a,{span:24,children:Object(P.jsx)(_.a.Item,{name:"description",label:"Description",rules:[{required:!0,message:"Please enter a description"}],children:Object(P.jsx)(We,{rows:10,placeholder:"Please enter a description",value:E,onChange:function(e){A(e.target.value)}})})})})]})})},Ke=function(e){var t=e.entityDef,n=Object(r.useContext)(D.a),a=Object(c.a)(n,2)[1],i=t.singular_name.toLowerCase().charAt(0).toUpperCase()+t.singular_name.toLowerCase().slice(1),o=Object(r.useState)(!1),s=Object(c.a)(o,2),l=s[0],d=s[1],u=Object(r.useState)(null),j=Object(c.a)(u,2),h=j[0],f=j[1],m=Object(K.useLiveQuery)((function(){return q.a.custom_entities.where("custom_entity_def_id").equals(t.id).toArray()}));return Object(P.jsxs)("div",{children:[Object(P.jsx)("div",{style:{textAlign:"right",marginBottom:"20px"},children:Object(P.jsx)(p.a,{title:"This section and all its content will be removed!! Are you sure you want to remove this entity?",onConfirm:function(){I.a.deleteCustomEntityDef(a,t.id).then((function(e){b.b.success(t.name+" removed!")})).catch((function(e){b.b.error("Something went wrong, sorry :(")}))},onCancel:function(){},okText:"Yes",cancelText:"No",placement:"bottomRight",children:Object(P.jsx)(O.a,{type:"default",danger:!0,children:"Remove entity"})},"remove-entity-def")}),void 0!==m&&m.map((function(e){return Object(P.jsx)(Qe,{entity:e,entityName:t.singular_name.toLowerCase(),onRemove:function(){!function(e){I.a.deleteCustomEntity(a,e.id).then((function(e){b.b.success(i+" removed!")})).catch((function(e){b.b.error("Something went wrong, sorry :(")}))}(e)},onEdit:function(){!function(e){f(e),d(!0)}(e)}},e.id)})),Object(P.jsxs)(O.a,{type:"primary",onClick:function(){f(null),d(!0)},children:["Add ",i]}),Object(P.jsx)(Xe,{entity:h,entityDef:t,isDrawerVisible:l,onDrawerClose:function(){d(!1)}})]})},Ze=l.a.Content,Je=ce.a.TabPane,He=function(){var e=Object(r.useState)(!1),t=Object(c.a)(e,2),n=t[0],a=t[1],i=Object(r.useState)(!1),o=Object(c.a)(i,2),s=o[0],l=o[1],d=Object(K.useLiveQuery)((function(){return q.a.custom_entity_defs.toArray()})),u=Object(P.jsx)(O.a,{size:"small",icon:Object(P.jsx)(re.a,{}),onClick:function(){a(!0)},children:"Add entity"},"add-custom"),j=[Object(P.jsx)(O.a,{size:"small",icon:Object(P.jsx)(ie.a,{}),style:{marginRight:"4px"},onClick:function(){l(!0)},children:"Colors"},"edit-colors"),u];return Object(P.jsxs)(P.Fragment,{children:[Object(P.jsx)(Ze,{className:"config-page",children:Object(P.jsxs)(ce.a,{type:"card",size:"small",tabBarExtraContent:Object(P.jsx)(P.Fragment,{children:j}),children:[Object(P.jsx)(Je,{tab:"Game State",children:Object(P.jsx)(Se,{})},"1"),Object(P.jsx)(Je,{tab:"Locations",children:Object(P.jsx)(Fe,{})},"2"),Object(P.jsx)(Je,{tab:"Characters",children:Object(P.jsx)(Ue,{})},"3"),void 0!==d&&d.map((function(e,t){return Object(P.jsx)(Je,{tab:e.name,children:Object(P.jsx)(Ke,{entityDef:e})},t+4)}))]})}),Object(P.jsx)(oe,{isDrawerVisible:n,onDrawerClose:function(){a(!1)}}),Object(P.jsx)(je,{isDrawerVisible:s,onDrawerClose:function(){l(!1)}})]})},$e=(n(371),n(410)),et=n(432),tt=n(433),nt=(n(372),o.a.Text),at=function(e){var t=e.act,n=e.actIndex,a=void 0===n?null:n,c=e.totalActs,r=void 0===c?0:c,i=e.canEdit,o=void 0===i||i,s=e.canRemove,l=void 0===s||s,d=e.onRemove,u=void 0===d?function(){}:d,j=e.onEdit,b=void 0===j?function(){}:j,h=e.onMoveOrderUp,f=void 0===h?function(){}:h,m=e.onMoveOrderDown,x=void 0===m?function(){}:m,y=[];y.push(Object(P.jsx)(nt,{type:"success",style:{marginRight:"24px"},children:"interactive"===t.type?"Interactive":"Sequence"},"act-type")),y.push(Object(P.jsx)(O.a,{type:"default",icon:Object(P.jsx)(et.a,{}),size:"small",style:{marginRight:"4px"},disabled:0===a,onClick:f},"move-up")),y.push(Object(P.jsx)(O.a,{type:"default",icon:Object(P.jsx)(tt.a,{}),size:"small",style:{marginRight:"24px"},disabled:a===r-1,onClick:x},"move-down")),o&&y.push(Object(P.jsx)(O.a,{type:"link",size:"small",onClick:b,children:"Edit"},"edit-act")),l&&y.push(Object(P.jsx)(p.a,{title:function(){return Object(P.jsxs)("p",{children:["Are you sure you want to remove this act?",Object(P.jsx)("br",{}),"All sequence actions and end conditions associated will be removed."]})},onConfirm:u,onCancel:function(){},okText:"Yes",cancelText:"No",placement:"bottomRight",children:Object(P.jsx)(O.a,{type:"link",size:"small",children:"Remove"})},"remove-act"));var v="Act "+t.order+": "+t.name;return Object(P.jsxs)(Ee.a,{className:"act-view",size:"small",title:v,extra:y,headStyle:{background:"#d9d9d9"},children:[Object(P.jsx)(nt,{children:t.description}),Object(P.jsx)(le.a,{}),"interactive"===t.type?Object(P.jsx)(nt,{strong:!0,children:"This act ends when:"}):Object(P.jsx)(nt,{strong:!0,children:"This act contains ## steps"})]})},ct=(n(373),o.a.Text),rt=$e.a.Panel,it=function(e){var t=e.chapter,n=e.chapterIndex,a=void 0===n?null:n,i=e.totalChapters,o=void 0===i?0:i,s=e.canEdit,l=void 0===s||s,d=e.canRemove,u=void 0===d||d,j=e.onRemove,h=void 0===j?function(){}:j,f=e.onEdit,m=void 0===f?function(){}:f,x=e.onMoveOrderUp,y=void 0===x?function(){}:x,v=e.onMoveOrderDown,g=void 0===v?function(){}:v,C=e.onAddAct,w=void 0===C?function(){}:C,S=e.onEditAct,E=void 0===S?function(){}:S,A=e.onRemoveAct,k=void 0===A?function(){}:A,_=Object(r.useContext)(D.a),T=Object(c.a)(_,2)[1],N=Object(K.useLiveQuery)((function(){return q.a.acts.where("chapter_id").equals(t.id).toArray()})),R=[];R.push(Object(P.jsx)(O.a,{type:"default",icon:Object(P.jsx)(et.a,{}),size:"small",style:{marginRight:"4px"},disabled:0===a,onClick:y},"move-up")),R.push(Object(P.jsx)(O.a,{type:"default",icon:Object(P.jsx)(tt.a,{}),size:"small",style:{marginRight:"24px"},disabled:a===o-1,onClick:g},"move-down")),l&&R.push(Object(P.jsx)(O.a,{type:"link",size:"small",onClick:m,children:"Edit"},"edit-chapter")),u&&R.push(Object(P.jsx)(p.a,{title:function(){return Object(P.jsxs)("p",{children:["Are you sure you want to remove this chapter?",Object(P.jsx)("br",{}),"All acts, sequence actions and end conditions associated will be removed."]})},onConfirm:h,onCancel:function(){},okText:"Yes",cancelText:"No",placement:"bottomRight",children:Object(P.jsx)(O.a,{type:"link",size:"small",children:"Remove"})},"remove-chapter"));var L="Chapter "+t.order+": "+t.name,F=void 0!==N?N.length:0,V=0===F?"No acts":1===F?"1 act":F+" acts";return Object(P.jsxs)(Ee.a,{className:"chapter-view",size:"small",title:L,extra:R,headStyle:{background:"#f5f5f5"},children:[Object(P.jsx)(ct,{children:t.description}),Object(P.jsx)($e.a,{defaultActiveKey:["1"],ghost:!0,children:Object(P.jsxs)(rt,{header:V,children:[void 0!==N&&N.sort((function(e,t){return e.order-t.order})).map((function(e,n){return Object(P.jsx)(at,{act:e,actIndex:n,totalActs:F,onRemove:function(){k(e)},onEdit:function(){E(e)},onMoveOrderUp:function(){!function(e){var n={oldOrder:e.order,order:e.order-1,chapter_id:t.id};I.a.updateActOrder(T,e.id,n).then((function(e){})).catch((function(e){b.b.error("Something went wrong, sorry :(")}))}(e)},onMoveOrderDown:function(){!function(e){var n={oldOrder:e.order,order:e.order+1,chapter_id:t.id};I.a.updateActOrder(T,e.id,n).then((function(e){})).catch((function(e){b.b.error("Something went wrong, sorry :(")}))}(e)}},e.id)})),Object(P.jsx)(O.a,{type:"default",size:"small",onClick:function(){w(F)},children:"Add Act"})]},"1")})]})},ot=N.a.TextArea,st=function(e){var t=e.chapter,n=void 0===t?null:t,a=e.totalChapters,i=void 0===a?0:a,o=e.isDrawerVisible,s=e.onDrawerClose,l=Object(r.useContext)(D.a),d=Object(c.a)(l,2)[1],u=_.a.useForm(),j=Object(c.a)(u,1)[0],h=Object(r.useState)(!1),p=Object(c.a)(h,2),f=p[0],y=p[1],v=Object(r.useState)(0),g=Object(c.a)(v,2),C=g[0],w=g[1],S=Object(r.useState)(""),E=Object(c.a)(S,2),A=E[0],k=E[1],R=Object(r.useState)(""),L=Object(c.a)(R,2),F=L[0],V=L[1];Object(r.useEffect)((function(){if(o){if(j.resetFields(),n)j.setFieldsValue({name:n.name,description:n.description,chapterIndex:n.order}),w(n.order);else{var e=i+1;j.setFieldsValue({chapterIndex:e}),w(e)}q()}}),[o,j,n,i]);var q=function(){y(!0)},B=function(){y(!1),s&&s()};return Object(P.jsx)(T.a,{title:null===n?"New chapter":"Edit chapter",width:360,onClose:B,visible:f,bodyStyle:{paddingBottom:20},footer:Object(P.jsxs)("div",{style:{textAlign:"right"},children:[Object(P.jsx)(O.a,{onClick:B,style:{marginRight:8},children:"Cancel"}),Object(P.jsx)(O.a,{type:"primary",htmlType:"submit",form:"add-edit-chapter-id",children:null===n?"Create":"Update"})]}),children:Object(P.jsxs)(_.a,{layout:"vertical",name:"add-edit-chapter",id:"add-edit-chapter-id",form:j,onFinish:function(e){var t=e.name.trim(),a=e.description.trim();if(""===t||""===a)return B(),void b.b.error("Do not leave empty fields, sorry :(");var c={name:t,description:a,order:C};null===n?I.a.createNewChapter(d,c).then((function(e){B(),b.b.success("New chapter created!")})).catch((function(e){B(),b.b.error("Something went wrong, sorry :(")})):I.a.updateChapter(d,n.id,c).then((function(e){B(),b.b.success("Chapter edited!")})).catch((function(e){B(),b.b.error("Something went wrong, sorry :(")}))},requiredMark:!1,children:[Object(P.jsx)(m.a,{gutter:16,children:Object(P.jsx)(x.a,{span:24,children:Object(P.jsx)(_.a.Item,{name:"chapterIndex",label:"Chapter",children:Object(P.jsx)(N.a,{placeholder:"#",value:C,disabled:!0})})})}),Object(P.jsx)(m.a,{gutter:16,children:Object(P.jsx)(x.a,{span:24,children:Object(P.jsx)(_.a.Item,{name:"name",label:"Name",rules:[{required:!0,message:"Please enter a name"}],children:Object(P.jsx)(N.a,{placeholder:"Please enter a name",value:A,onChange:function(e){k(e.target.value)}})})})}),Object(P.jsx)(m.a,{gutter:16,children:Object(P.jsx)(x.a,{span:24,children:Object(P.jsx)(_.a.Item,{name:"description",label:"Description",rules:[{required:!0,message:"Please enter a description"}],children:Object(P.jsx)(ot,{rows:10,placeholder:"Please enter a description",value:F,onChange:function(e){V(e.target.value)}})})})})]})})},lt=n(411),dt=N.a.TextArea,ut=o.a.Text,jt=function(e){var t=e.act,n=void 0===t?null:t,a=e.chapter,i=void 0===a?null:a,o=e.totalActs,s=void 0===o?0:o,l=e.isDrawerVisible,d=e.onDrawerClose,u=Object(r.useContext)(D.a),j=Object(c.a)(u,2)[1],h=_.a.useForm(),p=Object(c.a)(h,1)[0],f=Object(r.useState)(!1),y=Object(c.a)(f,2),v=y[0],g=y[1],C=Object(r.useState)(0),w=Object(c.a)(C,2),S=w[0],E=w[1],A=Object(r.useState)("interactive"),k=Object(c.a)(A,2),R=k[0],L=k[1],F=Object(r.useState)(""),V=Object(c.a)(F,2),q=V[0],B=V[1],z=Object(r.useState)(""),M=Object(c.a)(z,2),G=M[0],U=M[1];Object(r.useEffect)((function(){if(l){if(p.resetFields(),n)p.setFieldsValue({name:n.name,description:n.description,actIndex:n.order,actType:n.type}),E(n.order);else{var e=s+1;p.setFieldsValue({actIndex:e}),E(e)}L("interactive"),Y()}}),[l,p,n,s]);var Y=function(){g(!0)},Q=function(){g(!1),d&&d()};return Object(P.jsx)(T.a,{title:null===n?"New act":"Edit act",width:360,onClose:Q,visible:v,bodyStyle:{paddingBottom:20},footer:Object(P.jsxs)("div",{style:{textAlign:"right"},children:[Object(P.jsx)(O.a,{onClick:Q,style:{marginRight:8},children:"Cancel"}),Object(P.jsx)(O.a,{type:"primary",htmlType:"submit",form:"add-edit-act-id",children:null===n?"Create":"Update"})]}),children:Object(P.jsxs)(_.a,{layout:"vertical",name:"add-edit-act",id:"add-edit-act-id",form:p,onFinish:function(e){var t=e.name.trim(),a=e.description.trim();if(""===t||""===a)return Q(),void b.b.error("Do not leave empty fields, sorry :(");var c={name:t,description:a,order:S,chapter_id:i.id,type:R};null===n?I.a.createNewAct(j,c).then((function(e){Q(),b.b.success("New act created!")})).catch((function(e){Q(),b.b.error("Something went wrong, sorry :(")})):I.a.updateAct(j,n.id,c).then((function(e){Q(),b.b.success("Act edited!")})).catch((function(e){Q(),b.b.error("Something went wrong, sorry :(")}))},requiredMark:!1,children:[Object(P.jsx)(m.a,{gutter:16,children:Object(P.jsx)(x.a,{span:24,children:Object(P.jsx)(_.a.Item,{name:"actIndex",label:"Act",children:Object(P.jsx)(N.a,{placeholder:"#",value:S,disabled:!0})})})}),Object(P.jsx)(m.a,{gutter:16,children:Object(P.jsx)(x.a,{span:24,children:Object(P.jsx)(_.a.Item,{name:"name",label:"Name",rules:[{required:!0,message:"Please enter a name"}],children:Object(P.jsx)(N.a,{placeholder:"Please enter a name",value:q,onChange:function(e){B(e.target.value)}})})})}),Object(P.jsx)(m.a,{gutter:16,children:Object(P.jsx)(x.a,{span:24,children:Object(P.jsx)(_.a.Item,{name:"description",label:"Description",rules:[{required:!0,message:"Please enter a description"}],children:Object(P.jsx)(dt,{rows:10,placeholder:"Please enter a description",value:G,onChange:function(e){U(e.target.value)}})})})}),Object(P.jsx)(m.a,{gutter:16,style:{display:null===n?"block":"none"},children:Object(P.jsx)(x.a,{span:24,children:Object(P.jsxs)(_.a.Item,{name:"actType",label:"Act type",initialValue:"interactive",children:[Object(P.jsxs)(lt.a.Group,{value:R,onChange:function(e){L(e.target.value)},buttonStyle:"solid",children:[Object(P.jsx)(lt.a.Button,{value:"interactive",children:"Interactive"}),Object(P.jsx)(lt.a.Button,{value:"sequence",children:"Sequence"})]}),Object(P.jsx)(ut,{type:"secondary",style:{display:"block"},children:"interactive"===R?"Interactive act allows player to choose different actions while act's finished condition has not been accomplished":"Sequence act is used for predefined dialogs or fixed sequences (i.e. cinematics)"})]})})})]})})},bt=function(e){var t=e.onAddEditCondition,n=Object(r.useContext)(D.a),a=Object(c.a)(n,2)[1],i=Object(r.useState)(!1),o=Object(c.a)(i,2),s=o[0],l=o[1],d=Object(r.useState)(!1),u=Object(c.a)(d,2),j=u[0],h=u[1],p=Object(r.useState)(null),f=Object(c.a)(p,2),m=f[0],x=f[1],y=Object(r.useState)(null),v=Object(c.a)(y,2),g=v[0],C=v[1],w=Object(r.useState)(0),S=Object(c.a)(w,2),E=S[0],A=S[1],k=Object(K.useLiveQuery)((function(){return q.a.chapters.orderBy("order").toArray()})),_=void 0!==k?k.length:0;return Object(P.jsxs)("div",{children:[void 0!==k&&k.map((function(e,t){return Object(P.jsx)(it,{chapter:e,chapterIndex:t,totalChapters:_,onRemove:function(){!function(e){I.a.deleteChapter(a,e.id).then((function(e){b.b.success("Chapter removed!")})).catch((function(e){b.b.error("Something went wrong, sorry :(")}))}(e)},onEdit:function(){!function(e){x(e),l(!0)}(e)},onMoveOrderUp:function(){!function(e){var t={oldOrder:e.order,order:e.order-1};I.a.updateChapterOrder(a,e.id,t).then((function(e){})).catch((function(e){b.b.error("Something went wrong, sorry :(")}))}(e)},onMoveOrderDown:function(){!function(e){var t={oldOrder:e.order,order:e.order+1};I.a.updateChapterOrder(a,e.id,t).then((function(e){})).catch((function(e){b.b.error("Something went wrong, sorry :(")}))}(e)},onAddAct:function(t){!function(e,t){C(null),x(e),A(t),h(!0)}(e,t)},onEditAct:function(t){!function(e,t){x(t),C(e),h(!0)}(t,e)},onRemoveAct:function(t){!function(e,t){I.a.deleteAct(a,e.id,t.id).then((function(e){b.b.success("Act removed!")})).catch((function(e){b.b.error("Something went wrong, sorry :(")}))}(t,e)}},e.id)})),Object(P.jsx)(O.a,{type:"primary",onClick:function(){x(null),l(!0)},children:"Add Chapter"}),Object(P.jsx)(O.a,{type:"primary",onClick:t,style:{marginLeft:20},children:"dev:ConditionEditor"}),Object(P.jsx)(st,{chapter:m,totalChapters:_,isDrawerVisible:s,onDrawerClose:function(){l(!1)}}),Object(P.jsx)(jt,{act:g,chapter:m,totalActs:E,isDrawerVisible:j,onDrawerClose:function(){h(!1)}})]})},ht=function(e){var t,n=e.sequencedAction,a=e.actionIndex,c=e.totalActions,r=e.characters,i=e.onEditSequencedAction,o=void 0===i?function(){}:i,s=e.onRemoveSequencedAction,l=void 0===s?function(){}:s,d=e.onMoveSequencedActionUp,u=void 0===d?function(){}:d,j=e.onMoveSequencedActionDown,b=void 0===j?function(){}:j;return Object(P.jsx)(se.b.Item,{children:Object(P.jsxs)(m.a,{style:{width:"100%"},children:[Object(P.jsx)(x.a,{span:2,children:n.order}),Object(P.jsx)(x.a,{span:10,children:n.text_value}),Object(P.jsx)(x.a,{span:3,children:n.type}),Object(P.jsx)(x.a,{span:3,children:(t=n.character_id,-1===t?"-":r?r.find((function(e){return e.id===t})).name:t)}),Object(P.jsxs)(x.a,{span:6,style:{textAlign:"right"},children:[Object(P.jsx)(O.a,{type:"default",icon:Object(P.jsx)(et.a,{}),size:"small",style:{marginRight:"4px"},disabled:0===a,onClick:u}),Object(P.jsx)(O.a,{type:"default",icon:Object(P.jsx)(tt.a,{}),size:"small",style:{marginRight:"24px"},disabled:a===c-1,onClick:b}),Object(P.jsx)(O.a,{type:"link",size:"small",onClick:function(){o()},children:"Edit"}),Object(P.jsx)(p.a,{title:"Are you sure you want to remove this action?",onConfirm:function(){l()},onCancel:function(){},okText:"Yes",cancelText:"No",placement:"bottomRight",children:Object(P.jsx)(O.a,{type:"link",size:"small",children:"Remove"})})]})]})})},pt=N.a.TextArea,Ot=o.a.Text,ft=function(e){var t=e.sequencedAction,n=void 0===t?null:t,a=e.act,i=e.totalActions,o=void 0===i?0:i,s=e.isDrawerVisible,l=e.onDrawerClose,d=Object(r.useContext)(D.a),u=Object(c.a)(d,2)[1],j=_.a.useForm(),h=Object(c.a)(j,1)[0],p=Object(r.useState)(!1),f=Object(c.a)(p,2),y=f[0],v=f[1],g=Object(r.useState)(0),C=Object(c.a)(g,2),w=C[0],S=C[1],E=Object(r.useState)(""),A=Object(c.a)(E,2),k=A[0],R=A[1],L=Object(r.useState)("description"),F=Object(c.a)(L,2),V=F[0],q=F[1],B=Object(r.useState)(-1),z=Object(c.a)(B,2),M=z[0],G=z[1];Object(r.useEffect)((function(){if(s){if(h.resetFields(),n)h.setFieldsValue({actionIndex:n.order,textValue:n.text_value,sequencedActionType:n.type}),S(n.order),q(n.type),"dialog"===n.type?G(n.character_id):G(-1);else{var e=o+1;h.setFieldsValue({actionIndex:e}),S(e),q("description"),G(-1)}U()}}),[s,h,n,o]);var U=function(){v(!0)},Y=function(){v(!1),l&&l()};return Object(P.jsx)(T.a,{title:null===n?"New sequenced action":"Edit sequenced action",width:360,onClose:Y,visible:y,bodyStyle:{paddingBottom:20},footer:Object(P.jsxs)("div",{style:{textAlign:"right"},children:[Object(P.jsx)(O.a,{onClick:Y,style:{marginRight:8},children:"Cancel"}),Object(P.jsx)(O.a,{type:"primary",htmlType:"submit",form:"add-edit-sequenced-action-id",children:null===n?"Create":"Update"})]}),children:Object(P.jsxs)(_.a,{layout:"vertical",name:"add-edit-sequenced-action",id:"add-edit-sequenced-action-id",form:h,onFinish:function(e){var t=e.textValue.trim();if(""!==t)if("dialog"!==V||-1!==M){var c={actId:a.id,order:w,textValue:t,type:V};c.characterId="dialog"===V?M:-1,null===n?I.a.createNewSequencedAction(u,c).then((function(e){Y(),b.b.success("New sequenced action created!")})).catch((function(e){Y(),b.b.error("Something went wrong, sorry :(")})):I.a.updateSequencedAction(u,n.id,c).then((function(e){Y(),b.b.success("Sequenced action edited!")})).catch((function(e){Y(),b.b.error("Something went wrong, sorry :(")}))}else b.b.error("Dialog actions must have a character :(");else b.b.error("Please provide some copy :(")},requiredMark:!1,children:[Object(P.jsx)(m.a,{gutter:16,children:Object(P.jsx)(x.a,{span:24,children:Object(P.jsx)(_.a.Item,{label:"Order",children:Object(P.jsx)(N.a,{placeholder:"#",value:w,disabled:!0})})})}),Object(P.jsx)(m.a,{gutter:16,children:Object(P.jsx)(x.a,{span:24,children:Object(P.jsx)(_.a.Item,{name:"textValue",label:"Text",rules:[{required:!0,message:"Please enter some text"}],children:Object(P.jsx)(pt,{rows:10,placeholder:"Please enter some text",value:k,onChange:function(e){R(e.target.value)}})})})}),Object(P.jsx)(m.a,{gutter:16,children:Object(P.jsx)(x.a,{span:24,children:Object(P.jsxs)(_.a.Item,{label:"Type",initialValue:"description",children:[Object(P.jsxs)(lt.a.Group,{value:V,onChange:function(e){q(e.target.value)},buttonStyle:"solid",children:[Object(P.jsx)(lt.a.Button,{value:"description",children:"Description"}),Object(P.jsx)(lt.a.Button,{value:"dialog",children:"Dialog"})]}),Object(P.jsx)(Ot,{type:"secondary",style:{display:"block"},children:"description"===V?"General description of any sequential event":"An PC or NPC dialog"})]})})}),Object(P.jsx)(m.a,{gutter:16,style:{display:"dialog"===V?"block":"none"},children:Object(P.jsx)(x.a,{span:24,children:Object(P.jsx)(_.a.Item,{label:"Character",children:Object(P.jsx)(ye,{entityType:"character",value:M,onChangeCallback:function(e,t){G(e)},placeholder:"Please select a character",emptyOption:!0})})})})]})})},mt=o.a.Text,xt=function(e){var t=e.sectionActive,n=Object(r.useContext)(D.a),a=Object(c.a)(n,2)[1],i=Object(r.useState)(null),o=Object(c.a)(i,2),s=o[0],l=o[1],d=Object(r.useState)(null),u=Object(c.a)(d,2),j=u[0],h=u[1],p=Object(r.useState)(null),f=Object(c.a)(p,2),y=f[0],v=f[1],g=Object(r.useState)(!1),C=Object(c.a)(g,2),w=C[0],S=C[1],E=Object(K.useLiveQuery)(me.a.fetchLiveAct(j),[j]),A=Object(K.useLiveQuery)(me.a.fetchLiveChapter(E&&E.chapter_id),[E]),k=Object(K.useLiveQuery)(me.a.fetchLiveSequencedActionsByAct(j),[j]);Object(r.useEffect)((function(){t&&(_(),h(null))}),[t]);var _=function(){me.a.fetchStoryEntities("character").then((function(e){l(e)})).catch((function(e){l(null),console.log("||--FAIL",e)}))},T=Object(P.jsxs)(m.a,{children:[Object(P.jsx)(x.a,{span:2,children:Object(P.jsx)(mt,{strong:!0,children:"Order"})}),Object(P.jsx)(x.a,{span:10,children:Object(P.jsx)(mt,{strong:!0,children:"Text"})}),Object(P.jsx)(x.a,{span:3,children:Object(P.jsx)(mt,{strong:!0,children:"Type"})}),Object(P.jsx)(x.a,{span:3,children:Object(P.jsx)(mt,{strong:!0,children:"Character"})}),Object(P.jsx)(x.a,{span:6,style:{textAlign:"right"},children:Object(P.jsx)(mt,{strong:!0,children:"Options"})})]});return Object(P.jsxs)("div",{children:[Object(P.jsxs)(m.a,{gutter:16,children:[Object(P.jsx)(x.a,{span:16,children:Object(P.jsx)(ye,{customFetch:t?"allSequencedActs":null,value:j,onChangeCallback:function(e,t){h(e)},placeholder:"Select an Act"})}),Object(P.jsx)(x.a,{span:8,style:{display:"flex",justifyContent:"flex-end"},children:Object(P.jsx)(O.a,{type:"primary",onClick:function(){v(null),S(!0)},disabled:null===j,children:"Add Action"})})]}),E&&Object(P.jsx)(Ee.a,{size:"small",title:function(){var e=E&&E.name;return A&&(e+=" ("+A.name+")"),e}(),headStyle:{background:"#f5f5f5"},style:{marginTop:20},children:void 0!==k&&k.length>0?Object(P.jsx)(se.b,{style:{marginBottom:"20px"},header:T,dataSource:k.sort((function(e,t){return e.order-t.order})),renderItem:function(e,t){return Object(P.jsx)(ht,{sequencedAction:e,actionIndex:t,totalActions:k.length,characters:s,onEditSequencedAction:function(){v(e),S(!0)},onRemoveSequencedAction:function(){var t;t=e,I.a.deleteSequencedAction(a,t.id,t.act_id).then((function(e){b.b.success("Sequenced action removed!")})).catch((function(e){b.b.error("Something went wrong, sorry :(")}))},onMoveSequencedActionUp:function(){!function(e){var t={oldOrder:e.order,order:e.order-1,actId:e.act_id};I.a.updateSequencedActionOrder(a,e.id,t).then((function(e){})).catch((function(e){b.b.error("Something went wrong, sorry :(")}))}(e)},onMoveSequencedActionDown:function(){!function(e){var t={oldOrder:e.order,order:e.order+1,actId:e.act_id};I.a.updateSequencedActionOrder(a,e.id,t).then((function(e){})).catch((function(e){b.b.error("Something went wrong, sorry :(")}))}(e)}})}}):Object(P.jsx)(mt,{children:"This act hasn't actions yet"})}),Object(P.jsx)(ft,{sequencedAction:y,act:E,totalActions:k?k.length:0,isDrawerVisible:w,onDrawerClose:function(){S(!1)}})]})},yt=n(418),vt=function(){function e(){Object(F.a)(this,e)}return Object(V.a)(e,null,[{key:"getComparatorName",value:function(e){switch(e){case"EQUALS":return"Equals";case"NOT_EQUALS":return"Not equals";case"LOWER":return"Lower than";case"GREATER":return"Greater than";case"IS_EMPTY":return"Is empty";case"CONTAINS":return"Contains";case"NOT_CONTAINS":return"Not contains";case"SIZE_EQUALS":return"Size equals";case"SIZE_LOWER":return"Size lower than";case"SIZE_GREATER":return"Size greater than";default:return""}}},{key:"getComparatorsForPropType",value:function(e){if(e.endsWith("arr"))return[{id:"IS_EMPTY",name:"Is empty"},{id:"CONTAINS",name:"Contains"},{id:"NOT_CONTAINS",name:"Not contains"},{id:"SIZE_EQUALS",name:"Size equals"},{id:"SIZE_LOWER",name:"Size lower than"},{id:"SIZE_GREATER",name:"Size greater than"}];switch(e){case"int":return[{id:"EQUALS",name:"Equals"},{id:"NOT_EQUALS",name:"Not equals"},{id:"LOWER",name:"Lower than"},{id:"GREATER",name:"Greater than"}];case"boolean":return[{id:"EQUALS",name:"Equals"},{id:"NOT_EQUALS",name:"Not equals"}];case"string":case"location":case"area":case"character":default:return[{id:"IS_EMPTY",name:"Is empty"},{id:"EQUALS",name:"Equals"},{id:"NOT_EQUALS",name:"Not equals"}]}}},{key:"getInputTypeForExpression",value:function(e,t){if(e.endsWith("arr"))switch(t){case"CONTAINS":case"NOT_CONTAINS":switch(e){case"intarr":return"TEXT_INT";case"booleanarr":return"BOOLEAN";case"stringarr":return"TEXT_STRING";case"locationarr":case"areaarr":case"characterarr":default:return"SELECTOR"}case"SIZE_EQUALS":case"SIZE_LOWER":case"SIZE_GREATER":return"TEXT_INT";case"IS_EMPTY":default:return"NONE"}else switch(e){case"int":return"TEXT_INT";case"boolean":return"BOOLEAN";case"string":return"IS_EMPTY"!==t?"TEXT_STRING":"NONE";case"location":case"area":case"character":default:return"IS_EMPTY"!==t?"SELECTOR":"NONE"}}},{key:"getEmptyExpression",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t={gsProp:null,gsPropType:null,comp:null,compId:null,valueInputType:null,value:null,valueDisplay:null};return e&&(t.name=e),t}}]),e}(),gt=pe.a.Option,Ct=function(){function e(){Object(F.a)(this,e)}return Object(V.a)(e,null,[{key:"renderGameStatePropsSelector",value:function(e,t,n){return Object(P.jsx)(pe.a,{value:e,onChange:function(e){t(e)},style:{width:"100%"},children:void 0!==n&&n.map((function(e,t){return Object(P.jsx)(gt,{value:t,children:e.name},t)}))})}},{key:"renderComparatorSelector",value:function(e,t,n){return Object(P.jsx)(pe.a,{value:t,onChange:function(e){n(e)},style:{width:"100%"},children:e&&vt.getComparatorsForPropType(e).map((function(e){return Object(P.jsx)(gt,{value:e.id,children:e.name},e.id)}))})}},{key:"renderValueSelector",value:function(e,t,n,a){switch(t){case"BOOLEAN":return Object(P.jsx)(fe.a,{checkedChildren:"true",unCheckedChildren:"false",checked:n,onChange:function(e){a(e,null)}});case"TEXT_STRING":return Object(P.jsx)(N.a,{value:n,onChange:function(e){a(e.target.value,null)}});case"TEXT_INT":return Object(P.jsx)(Oe.a,{value:n,onChange:function(e){a(e,null)},style:{width:"100%"}});case"SELECTOR":var c=e.endsWith("arr")?e.substring(0,e.length-3):e;return Object(P.jsx)(ye,{entityType:c,value:n,onChangeCallback:a});case"NONE":default:return null}}},{key:"renderConditionDisplay",value:function(e){if(null!==e&&e.display){var t,n,a=[];return e.display.forEach((function(e,c){if(t="logic"===e.type?"#52c41a":"grouping"===e.type?"#eb2f96":"#1890ff","logic"===e.type||"grouping"===e.type)n=e.name;else{var r=Object(P.jsx)("strong",{style:{color:"#333333"},children:e.comp});n=Object(P.jsxs)(P.Fragment,{children:[e.propName," ",r," ",(i=e.value,"boolean"===typeof i?i?"TRUE":"FALSE":i)]})}var i;a.push(Object(P.jsx)(yt.a,{color:t,children:n},c))})),a}return null}}]),e}(),wt=N.a.TextArea,St=o.a.Title,Et=function(e){var t=e.gameAction,n=void 0===t?null:t,a=e.type,i=void 0===a?"inter":a,o=e.isDrawerVisible,s=e.onDrawerClose,l=e.onAddEditCondition,d=Object(r.useContext)(D.a),u=Object(c.a)(d,2),j=u[0],h=u[1],p=_.a.useForm(),f=Object(c.a)(p,1)[0],y=Object(r.useState)(!1),v=Object(c.a)(y,2),g=v[0],C=v[1],w=Object(r.useState)(null),S=Object(c.a)(w,2),E=S[0],A=S[1],k=Object(r.useState)(""),N=Object(c.a)(k,2),R=N[0],L=N[1],F=Object(r.useState)(!0),V=Object(c.a)(F,2),q=V[0],B=V[1];Object(r.useEffect)((function(){o&&(h({type:"UNSET_ACTIVE_CONDITION"}),f.resetFields(),n?(B(n.allow_repeat),f.setFieldsValue({allowRepeat:n.allow_repeat,description:n.description}),A(JSON.parse(n.required_condition))):(B(!0),f.setFieldsValue({allowRepeat:!0,description:""}),A(null)),z())}),[o,f,n,h]),Object(r.useEffect)((function(){j.activeConditionDone&&(A(j.activeCondition),console.log("||--activeCondition",j.activeCondition))}),[j.activeConditionDone,j.activeCondition]);var z=function(){C(!0)},M=function(){C(!1),s&&s()};return Object(P.jsx)(T.a,{title:function(){var e=null===n?"New ":"Edit ";return e+="nav"===i?"navigation action":"noeff"===i?"no-effect action":"interactive action"}(),width:360,onClose:M,visible:g,bodyStyle:{paddingBottom:20},footer:Object(P.jsxs)("div",{style:{textAlign:"right"},children:[Object(P.jsx)(O.a,{onClick:M,style:{marginRight:8},children:"Cancel"}),Object(P.jsx)(O.a,{type:"primary",htmlType:"submit",form:"add-edit-gameaction-id",children:null===n?"Create":"Update"})]}),children:Object(P.jsxs)(_.a,{layout:"vertical",name:"add-edit-gameaction",id:"add-edit-gameaction-id",form:f,onFinish:function(e){var t=e.description.trim();if(""!==t)if(null!==E){var a={description:t,allowRepeat:e.allowRepeat,requiredCondition:JSON.stringify(E)};null===n?I.a.createNewNoEffectAction(h,a).then((function(e){M(),b.b.success("New action created!")})).catch((function(e){M(),b.b.error("Something went wrong, sorry :(")})):I.a.updateNoEffectAction(h,n.id,a).then((function(e){M(),b.b.success("Action edited!")})).catch((function(e){M(),b.b.error("Something went wrong, sorry :(")}))}else b.b.error("Please set a valid required condition");else b.b.error("Please provide a valid description")},requiredMark:!1,children:[Object(P.jsx)(m.a,{gutter:16,style:{paddingBottom:12},children:Object(P.jsx)(x.a,{span:24,children:Object(P.jsxs)(Ee.a,{size:"small",className:"low-padding border-title",children:[Object(P.jsx)(St,{level:5,type:"secondary",children:"Required condition"}),function(){var e=Ct.renderConditionDisplay(E);return null!==e?Object(P.jsx)("div",{style:{paddingBottom:20},children:e}):null}(),null===E?Object(P.jsx)(O.a,{type:"primary",size:"small",onClick:l,children:"Add condition"}):Object(P.jsx)(O.a,{type:"primary",size:"small",onClick:function(){h({type:"SET_ACTIVE_CONDITION",payload:E}),l()},children:"Change condition"})]})})}),Object(P.jsx)(m.a,{gutter:16,children:Object(P.jsx)(x.a,{span:24,children:Object(P.jsx)(_.a.Item,{name:"description",label:"Description",rules:[{required:!0,message:"Please enter a description"}],children:Object(P.jsx)(wt,{rows:10,placeholder:"Please enter a description",value:R,onChange:function(e){L(e.target.value)}})})})}),Object(P.jsx)(m.a,{gutter:16,children:Object(P.jsx)(x.a,{span:24,children:Object(P.jsx)(_.a.Item,{name:"allowRepeat",label:"Can be repeated:",children:Object(P.jsx)(fe.a,{checkedChildren:"Yes",unCheckedChildren:"No",checked:q,onChange:function(e){B(e)}})})})})]})})},At=function(e){e.sectionActive;var t=Object(r.useState)(!1),n=Object(c.a)(t,2),a=n[0],i=n[1];return Object(P.jsxs)("div",{children:[Object(P.jsxs)(m.a,{gutter:[0,8],style:{paddingBottom:24},children:[Object(P.jsx)(x.a,{span:24,children:Object(P.jsxs)(Ee.a,{size:"small",children:[Object(P.jsx)(O.a,{type:"primary",onClick:function(){i(!0)},style:{marginRight:8},children:"Add Nav Action"}),Object(P.jsx)(O.a,{type:"primary",onClick:function(){},style:{marginRight:8},children:"Add Associated Nav Action"}),Object(P.jsx)(O.a,{type:"primary",onClick:function(){},children:"Add Nav Actions Matrix"})]})}),Object(P.jsx)(x.a,{span:24,children:Object(P.jsx)(Ee.a,{size:"small",children:"Filters"})}),Object(P.jsx)(x.a,{span:24,children:Object(P.jsx)("p",{children:"List of actions"})})]}),Object(P.jsx)(Et,{gameAction:null,type:"nav",isDrawerVisible:a,onDrawerClose:function(){i(!1)}})]})},kt=function(e){e.sectionActive;var t=Object(r.useState)(!1),n=Object(c.a)(t,2),a=n[0],i=n[1];return Object(P.jsxs)("div",{children:[Object(P.jsxs)(m.a,{gutter:[0,8],style:{paddingBottom:24},children:[Object(P.jsx)(x.a,{span:24,children:Object(P.jsxs)(Ee.a,{size:"small",children:[Object(P.jsx)(O.a,{type:"primary",onClick:function(){i(!0)},style:{marginRight:8},children:"Add Interactive Action"}),Object(P.jsx)(O.a,{type:"primary",onClick:function(){},children:"Add Associated Interactive Action"})]})}),Object(P.jsx)(x.a,{span:24,children:Object(P.jsx)(Ee.a,{size:"small",children:"Filters"})}),Object(P.jsx)(x.a,{span:24,children:Object(P.jsx)("p",{children:"List of actions"})})]}),Object(P.jsx)(Et,{gameAction:null,type:"inter",isDrawerVisible:a,onDrawerClose:function(){i(!1)}})]})},_t=o.a.Text,Tt=function(e){e.sectionActive;var t=e.onAddEditCondition,n=Object(r.useContext)(D.a),a=Object(c.a)(n,2)[1],i=Object(r.useState)(!1),o=Object(c.a)(i,2),s=o[0],l=o[1],d=Object(r.useState)(null),u=Object(c.a)(d,2),j=u[0],h=u[1],f=Object(K.useLiveQuery)(me.a.fetchLiveNoEffectActions({})),y=Object(P.jsxs)(m.a,{children:[Object(P.jsx)(x.a,{span:10,children:Object(P.jsx)(_t,{strong:!0,children:"Required"})}),Object(P.jsx)(x.a,{span:10,children:Object(P.jsx)(_t,{strong:!0,children:"Description"})}),Object(P.jsx)(x.a,{span:1,children:Object(P.jsx)(_t,{strong:!0,children:"Repeat?"})}),Object(P.jsx)(x.a,{span:3})]});return Object(P.jsxs)("div",{children:[Object(P.jsxs)(m.a,{gutter:[0,8],style:{paddingBottom:24},children:[Object(P.jsx)(x.a,{span:24,children:Object(P.jsx)(Ee.a,{size:"small",children:Object(P.jsx)(O.a,{type:"primary",onClick:function(){h(null),l(!0)},children:"Add No-effect Action"})})}),Object(P.jsx)(x.a,{span:24,children:Object(P.jsx)(Ee.a,{size:"small",children:"Filters"})}),Object(P.jsx)(x.a,{span:24,children:void 0!==f&&f.length>0&&Object(P.jsx)(se.b,{header:y,dataSource:f,renderItem:function(e){return Object(P.jsx)(se.b.Item,{className:"noeff-action-list-item",children:Object(P.jsxs)(m.a,{style:{width:"100%"},children:[Object(P.jsx)(x.a,{span:10,children:Object(P.jsx)("div",{children:Ct.renderConditionDisplay(JSON.parse(e.required_condition))})}),Object(P.jsx)(x.a,{span:10,children:e.description}),Object(P.jsx)(x.a,{span:1,children:e.allow_repeat?"Yes":"No"}),Object(P.jsxs)(x.a,{span:3,style:{textAlign:"right"},children:[Object(P.jsx)(O.a,{type:"link",size:"small",onClick:function(){!function(e){h(e),l(!0)}(e)},children:"Edit"}),Object(P.jsx)(p.a,{title:"Are you sure you want to remove this action?",onConfirm:function(){!function(e){I.a.deleteNoEffectAction(a,e.id).then((function(e){b.b.success("Action removed!")})).catch((function(e){b.b.error("Something went wrong, sorry :(")}))}(e)},onCancel:function(){},okText:"Yes",cancelText:"No",placement:"bottomRight",children:Object(P.jsx)(O.a,{type:"link",size:"small",children:"Remove"})})]})]})})}})})]}),Object(P.jsx)(Et,{gameAction:j,type:"noeff",isDrawerVisible:s,onDrawerClose:function(){l(!1)},onAddEditCondition:t})]})},Nt=function(e){var t,n=e.dialog,a=e.dialogIndex,c=e.totalDialogs,r=e.characters,i=e.onEditDialog,o=void 0===i?function(){}:i,s=e.onRemoveDialog,l=void 0===s?function(){}:s,d=e.onMoveDialogUp,u=void 0===d?function(){}:d,j=e.onMoveDialogDown,b=void 0===j?function(){}:j;return Object(P.jsx)(se.b.Item,{children:Object(P.jsxs)(m.a,{style:{width:"100%"},children:[Object(P.jsx)(x.a,{span:2,children:n.order}),Object(P.jsx)(x.a,{span:13,children:n.dialog}),Object(P.jsx)(x.a,{span:3,children:(t=n.character_id,-1===t?"-":r?r.find((function(e){return e.id===t})).name:t)}),Object(P.jsxs)(x.a,{span:6,style:{textAlign:"right"},children:[Object(P.jsx)(O.a,{type:"default",icon:Object(P.jsx)(et.a,{}),size:"small",style:{marginRight:"4px"},disabled:0===a,onClick:u}),Object(P.jsx)(O.a,{type:"default",icon:Object(P.jsx)(tt.a,{}),size:"small",style:{marginRight:"24px"},disabled:a===c-1,onClick:b}),Object(P.jsx)(O.a,{type:"link",size:"small",onClick:function(){o()},children:"Edit"}),Object(P.jsx)(p.a,{title:"Are you sure you want to remove this dialog?",onConfirm:function(){l()},onCancel:function(){},okText:"Yes",cancelText:"No",placement:"bottomRight",children:Object(P.jsx)(O.a,{type:"link",size:"small",children:"Remove"})})]})]})})},Dt=o.a.Text,It=$e.a.Panel,Pt=function(e){var t=e.conversation,n=e.characters,a=e.onRemove,c=void 0===a?function(){}:a,r=e.onEdit,i=void 0===r?function(){}:r,o=e.onAddDialog,s=void 0===o?function(){}:o,l=e.onEditDialog,d=void 0===l?function(){}:l,u=e.onRemoveDialog,j=void 0===u?function(){}:u,b=e.onMoveDialogUp,h=void 0===b?function(){}:b,f=e.onMoveDialogDown,y=void 0===f?function(){}:f,v=Object(K.useLiveQuery)(me.a.fetchLiveConversationDialogs(t&&t.id),[t]),g=[];g.push(Object(P.jsx)(O.a,{type:"link",size:"small",onClick:i,children:"Edit"},"edit-conversation")),g.push(Object(P.jsx)(p.a,{title:"Are you sure you want to remove this conversation and all its dialogs?",onConfirm:c,onCancel:function(){},okText:"Yes",cancelText:"No",placement:"bottomRight",children:Object(P.jsx)(O.a,{type:"link",size:"small",children:"Remove"})},"remove-conversation"));var C=Object(P.jsxs)(m.a,{children:[Object(P.jsx)(x.a,{span:2,children:Object(P.jsx)(Dt,{strong:!0,children:"Order"})}),Object(P.jsx)(x.a,{span:13,children:Object(P.jsx)(Dt,{strong:!0,children:"Dialog"})}),Object(P.jsx)(x.a,{span:3,children:Object(P.jsx)(Dt,{strong:!0,children:"Character"})}),Object(P.jsx)(x.a,{span:6,style:{textAlign:"right"},children:Object(P.jsx)(Dt,{strong:!0,children:"Options"})})]}),w=void 0!==v?v.length:0,S=1===w?"1 dialog":w+" dialogs";return Object(P.jsxs)(Ee.a,{className:"conversation-view",size:"small",title:t.name,extra:g,headStyle:{background:"#f5f5f5"},style:{marginBottom:16},children:[void 0!==v&&v.length>0?Object(P.jsx)($e.a,{defaultActiveKey:["1"],ghost:!0,children:Object(P.jsx)(It,{header:S,children:Object(P.jsx)(se.b,{style:{marginBottom:"20px"},header:C,dataSource:v.sort((function(e,t){return e.order-t.order})),renderItem:function(e,t){return Object(P.jsx)(Nt,{dialog:e,dialogIndex:t,totalDialogs:v.length,characters:n,onEditDialog:function(){d(e)},onRemoveDialog:function(){j(e)},onMoveDialogUp:function(){h(e)},onMoveDialogDown:function(){y(e)}})}})},"1")}):Object(P.jsx)("p",{children:Object(P.jsx)(Dt,{children:"This conversation hasn't dialogs yet"})}),Object(P.jsx)(O.a,{type:"default",size:"small",onClick:function(){s(w)},children:"Add Dialog"})]})},Rt=function(e){var t=e.conversation,n=void 0===t?null:t,a=e.isDrawerVisible,i=e.onDrawerClose,o=Object(r.useContext)(D.a),s=Object(c.a)(o,2)[1],l=_.a.useForm(),d=Object(c.a)(l,1)[0],u=Object(r.useState)(!1),j=Object(c.a)(u,2),h=j[0],p=j[1],f=Object(r.useState)(""),y=Object(c.a)(f,2),v=y[0],g=y[1];Object(r.useEffect)((function(){a&&(d.resetFields(),n&&d.setFieldsValue({name:n.name}),C())}),[a,d,n]);var C=function(){p(!0)},w=function(){p(!1),i&&i()};return Object(P.jsx)(T.a,{title:null===n?"New conversation":"Edit conversation",width:360,onClose:w,visible:h,bodyStyle:{paddingBottom:20},footer:Object(P.jsxs)("div",{style:{textAlign:"right"},children:[Object(P.jsx)(O.a,{onClick:w,style:{marginRight:8},children:"Cancel"}),Object(P.jsx)(O.a,{type:"primary",htmlType:"submit",form:"add-edit-conversation-id",children:null===n?"Create":"Update"})]}),children:Object(P.jsx)(_.a,{layout:"vertical",name:"add-edit-conversation",id:"add-edit-conversation-id",form:d,onFinish:function(e){var t=e.name.trim();if(""!==t){var a={name:t};null===n?I.a.createNewConversation(s,a).then((function(e){w(),b.b.success("New conversation created!")})).catch((function(e){w(),b.b.error("Something went wrong, sorry :(")})):I.a.updateConversation(s,n.id,a).then((function(e){w(),b.b.success("Conversation edited!")})).catch((function(e){w(),b.b.error("Something went wrong, sorry :(")}))}else b.b.error("Do not leave empty fields, sorry :(")},requiredMark:!1,children:Object(P.jsx)(m.a,{gutter:16,children:Object(P.jsx)(x.a,{span:24,children:Object(P.jsx)(_.a.Item,{name:"name",label:"Name",rules:[{required:!0,message:"Please enter a name"}],children:Object(P.jsx)(N.a,{placeholder:"Please enter a name",value:v,onChange:function(e){g(e.target.value)}})})})})})})},Lt=N.a.TextArea,Ft=function(e){var t=e.dialog,n=void 0===t?null:t,a=e.conversation,i=e.totalDialogs,o=void 0===i?0:i,s=e.isDrawerVisible,l=e.onDrawerClose,d=Object(r.useContext)(D.a),u=Object(c.a)(d,2)[1],j=_.a.useForm(),h=Object(c.a)(j,1)[0],p=Object(r.useState)(!1),f=Object(c.a)(p,2),y=f[0],v=f[1],g=Object(r.useState)(0),C=Object(c.a)(g,2),w=C[0],S=C[1],E=Object(r.useState)(""),A=Object(c.a)(E,2),k=A[0],R=A[1],L=Object(r.useState)(-1),F=Object(c.a)(L,2),V=F[0],q=F[1];Object(r.useEffect)((function(){if(s){if(h.resetFields(),n)h.setFieldsValue({dialogIndex:n.order,textValue:n.dialog}),S(n.order),q(n.character_id);else{var e=o+1;h.setFieldsValue({dialogIndex:e}),S(e),q(-1)}B()}}),[s,h,n,o]);var B=function(){v(!0)},z=function(){v(!1),l&&l()};return Object(P.jsx)(T.a,{title:null===n?"New dialog":"Edit dialog",width:360,onClose:z,visible:y,bodyStyle:{paddingBottom:20},footer:Object(P.jsxs)("div",{style:{textAlign:"right"},children:[Object(P.jsx)(O.a,{onClick:z,style:{marginRight:8},children:"Cancel"}),Object(P.jsx)(O.a,{type:"primary",htmlType:"submit",form:"add-edit-dialog-id",children:null===n?"Create":"Update"})]}),children:Object(P.jsxs)(_.a,{layout:"vertical",name:"add-edit-dialog",id:"add-edit-dialog-id",form:h,onFinish:function(e){var t=e.textValue.trim();if(""!==t)if(-1!==V){var c={conversationId:a.id,order:w,dialog:t,characterId:V};null===n?I.a.createNewConversationDialog(u,c).then((function(e){z(),b.b.success("New dialog created!")})).catch((function(e){z(),b.b.error("Something went wrong, sorry :(")})):I.a.updateConversationDialog(u,n.id,c).then((function(e){z(),b.b.success("Dialog edited!")})).catch((function(e){z(),b.b.error("Something went wrong, sorry :(")}))}else b.b.error("Dialog must have a character :(");else b.b.error("Please provide some copy for the dialog :(")},requiredMark:!1,children:[Object(P.jsx)(m.a,{gutter:16,children:Object(P.jsx)(x.a,{span:24,children:Object(P.jsx)(_.a.Item,{label:"Order",children:Object(P.jsx)(N.a,{placeholder:"#",value:w,disabled:!0})})})}),Object(P.jsx)(m.a,{gutter:16,children:Object(P.jsx)(x.a,{span:24,children:Object(P.jsx)(_.a.Item,{name:"textValue",label:"Dialog",rules:[{required:!0,message:"Please enter some text"}],children:Object(P.jsx)(Lt,{rows:10,placeholder:"Please enter some text",value:k,onChange:function(e){R(e.target.value)}})})})}),Object(P.jsx)(m.a,{gutter:16,children:Object(P.jsx)(x.a,{span:24,children:Object(P.jsx)(_.a.Item,{label:"Character",children:Object(P.jsx)(ye,{entityType:"character",value:V,onChangeCallback:function(e,t){q(e)},placeholder:"Please select a character",emptyOption:!0})})})})]})})},Vt=o.a.Text,qt=function(e){var t=e.sectionActive,n=Object(r.useContext)(D.a),a=Object(c.a)(n,2)[1],i=Object(r.useState)(null),o=Object(c.a)(i,2),s=o[0],l=o[1],d=Object(r.useState)(!1),u=Object(c.a)(d,2),j=u[0],h=u[1],p=Object(r.useState)(!1),f=Object(c.a)(p,2),y=f[0],v=f[1],g=Object(r.useState)(null),C=Object(c.a)(g,2),w=C[0],S=C[1],E=Object(r.useState)(null),A=Object(c.a)(E,2),k=A[0],_=A[1],T=Object(r.useState)(0),N=Object(c.a)(T,2),R=N[0],L=N[1],F=Object(r.useState)(-1),V=Object(c.a)(F,2),q=V[0],B=V[1],z=Object(K.useLiveQuery)(me.a.fetchLiveConversations({character:q}),[q]);Object(r.useEffect)((function(){t&&(B(-1),M())}),[t]);var M=function(){me.a.fetchStoryEntities("character").then((function(e){l(e)})).catch((function(e){l(null),console.log("||--FAIL",e)}))};return Object(P.jsxs)("div",{children:[Object(P.jsxs)(m.a,{gutter:[0,8],style:{paddingBottom:24},children:[Object(P.jsx)(x.a,{span:24,children:Object(P.jsx)(Ee.a,{size:"small",children:Object(P.jsx)(O.a,{type:"primary",onClick:function(){S(null),h(!0)},children:"Add Conversation"})})}),Object(P.jsx)(x.a,{span:24,children:Object(P.jsx)(Ee.a,{size:"small",children:Object(P.jsxs)(m.a,{gutter:[16,0],justify:"start",align:"middle",children:[Object(P.jsx)(x.a,{span:2,children:Object(P.jsx)(Vt,{type:"secondary",children:"Filters"})}),Object(P.jsx)(x.a,{span:6,children:Object(P.jsx)(ye,{entityType:"character",value:q,onChangeCallback:function(e,t){B(e)},placeholder:"Filter character",emptyOption:!0,emptyOptionLabel:"Filter character"})})]})})}),Object(P.jsx)(x.a,{span:24,children:void 0!==z&&z.map((function(e){return Object(P.jsx)(Pt,{conversation:e,characters:s,onRemove:function(){!function(e){I.a.deleteConversation(a,e.id).then((function(e){b.b.success("Conversation removed!")})).catch((function(e){b.b.error("Something went wrong, sorry :(")}))}(e)},onEdit:function(){!function(e){S(e),h(!0)}(e)},onAddDialog:function(t){!function(e,t){_(null),S(e),L(t),v(!0)}(e,t)},onEditDialog:function(t){!function(e,t){S(t),_(e),v(!0)}(t,e)},onRemoveDialog:function(t){!function(e,t){I.a.deleteConversationDialog(a,e.id,t.id).then((function(e){b.b.success("Dialog removed!")})).catch((function(e){b.b.error("Something went wrong, sorry :(")}))}(t,e)},onMoveDialogUp:function(t){!function(e,t){var n={oldOrder:e.order,order:e.order-1,conversationId:t.id};I.a.updateConversationDialogOrder(a,e.id,n).then((function(e){})).catch((function(e){b.b.error("Something went wrong, sorry :(")}))}(t,e)},onMoveDialogDown:function(t){!function(e,t){var n={oldOrder:e.order,order:e.order+1,conversationId:t.id};I.a.updateConversationDialogOrder(a,e.id,n).then((function(e){})).catch((function(e){b.b.error("Something went wrong, sorry :(")}))}(t,e)}},e.id)}))})]}),Object(P.jsx)(Rt,{conversation:w,isDrawerVisible:j,onDrawerClose:function(){h(!1)}}),Object(P.jsx)(Ft,{dialog:k,conversation:w,totalDialogs:R,isDrawerVisible:y,onDrawerClose:function(){v(!1)}})]})},Bt=n(389),zt=n(419),Mt=n(434),Gt=function(e){var t=e.expression,n=e.gameStates,a=e.onChange;return Object(P.jsx)(se.b.Item,{className:"complex-condition-expression-list-item",children:Object(P.jsxs)(m.a,{gutter:[24,8],style:{width:"100%"},children:[Object(P.jsx)(x.a,{span:4,children:t.name}),Object(P.jsx)(x.a,{span:7,children:Ct.renderGameStatePropsSelector(t.gsProp,(function(e){var c=t,r=n[e];c.gsProp=r.name,c.gsPropType=r.type,c.comp=null,c.compId=null,c.valueInputType=null,c.value=null,c.valueDisplay=null,a(c)}),n)}),Object(P.jsx)(x.a,{span:6,style:{display:null!==t.gsProp?"block":"none"},children:Ct.renderComparatorSelector(t.gsPropType,t.compId,(function(e){var n=t;n.compId=e,n.valueInputType=vt.getInputTypeForExpression(n.gsPropType,n.compId),n.value=null,n.valueDisplay=null,a(n)}))}),Object(P.jsx)(x.a,{span:7,style:{display:null!==t.compId&&"IS_EMPTY"!==t.compId?"block":"none"},children:Ct.renderValueSelector(t.gsPropType,t.valueInputType,t.value,(function(e,n){var c=t;c.value=e,c.valueDisplay=n,a(c)}))})]})})},Ut=(n(374),n(375)),Yt=ce.a.TabPane,Qt=o.a.Text,Wt=Object(P.jsx)(Mt.a,{style:{color:"#fa541c"}},"caret"),Xt=function(e){var t=e.isDrawerVisible,n=e.onDrawerClose,i=Object(r.useContext)(D.a),o=Object(c.a)(i,2),s=o[0],l=o[1],d=_.a.useForm(),u=Object(c.a)(d,1)[0],j=Object(r.useState)(!1),b=Object(c.a)(j,2),h=b[0],p=b[1],f=Object(r.useState)(null),y=Object(c.a)(f,2),v=y[0],g=y[1],C=Object(r.useState)("1"),w=Object(c.a)(C,2),S=w[0],E=w[1],A=Object(r.useState)(!1),k=Object(c.a)(A,2),N=k[0],I=k[1],R=Object(r.useState)(vt.getEmptyExpression()),L=Object(c.a)(R,2),F=L[0],V=L[1],q=Object(r.useState)([]),B=Object(c.a)(q,2),z=B[0],M=B[1],G=Object(r.useState)([]),U=Object(c.a)(G,2),Y=U[0],Q=U[1],W=Object(r.useState)(void 0),X=Object(c.a)(W,2),K=X[0],Z=X[1];Object(r.useEffect)((function(){me.a.fetchGameStateProps().then((function(e){Z(e)})).catch((function(e){console.log("||--FAIL",e)}))}),[]),Object(r.useEffect)((function(){t&&($(),u.resetFields(),g(s.activeCondition),ee(),a=new Ut.a,J())}),[t,u,v]);var J=function(){p(!0)},H=function(){p(!1),n&&n()},$=function(){V(vt.getEmptyExpression()),M([]),Q([]),I(!1)},ee=function(){null!==v?"simple"===v.mode?(E("1"),te()):(E("2"),ne()):E("1")},te=function(){var e=v.expressions[0],t=F,n=K.find((function(t){return t.id===e.gsp_id}));t.gsProp=n.name,t.gsPropType=n.type,t.comp=null,t.compId=e.compId,t.valueInputType=vt.getInputTypeForExpression(t.gsPropType,t.compId),t.value=e.value,t.valueDisplay=e.valueDisplay,V(Object(he.a)({},t)),I(!1)},ne=function(){var e,t,n=[];M(v.logic_func),v.expressions.forEach((function(a){e=K.find((function(e){return e.id===a.gsp_id})),(t=vt.getEmptyExpression(a.name)).gsProp=e.name,t.gsPropType=e.type,t.comp=null,t.compId=a.compId,t.valueInputType=vt.getInputTypeForExpression(t.gsPropType,t.compId),t.value=a.value,t.valueDisplay=a.valueDisplay,n.push(t)})),Q(n)},ae=function(e){var t=Object(Bt.a)(Y),n=t.findIndex((function(t){return t.name===e.name}));t[n]=e,Q(t),I(!1)},re=function(e){var t=Object(Bt.a)(z);switch(e){case"ADD_EXP":var n="EXP"+(Y.length+1),a=vt.getEmptyExpression(n),c=Object(Bt.a)(Y);c.push(a),t.push({type:"exp",name:n,displayName:n}),Q(c);break;case"AND":t.push({type:"logic",name:"AND",displayName:"AND"});break;case"OR":t.push({type:"logic",name:"OR",displayName:"OR"});break;case"NEG":t.push({type:"logic",name:"NEG",displayName:"NEG"});break;case"OPEN_GR":t.push({type:"grouping",name:"OPEN",displayName:"("});break;case"CLOSE_GR":t.push({type:"grouping",name:"CLOSE",displayName:")"});break;case"DELETE":var r=t.pop();if(r&&"exp"===r.type){var i=Object(Bt.a)(Y);i.pop(),Q(i)}break;case"CLEAR":t=[],Q([])}M(t),I(!1)},ie=function(e){if(null===e.gsProp)return!1;if(null===e.compId)return!1;if(null===e.valueInputType)return!1;switch(e.valueInputType){case"SELECTOR":if(null===e.value)return!1;break;case"TEXT_INT":if(null===e.value||isNaN(e.value))return!1;break;case"TEXT_STRING":if(null===e.value||0===e.value.trim().length)return!1}return!0},oe=function(){var e;if("1"===S)return[{gsp_id:(e=K.find((function(e){return e.name===F.gsProp}))).id,compId:F.compId,value:F.value,valueDisplay:F.valueDisplay}];var t=[];return Y.forEach((function(n){e=K.find((function(e){return e.name===n.gsProp})),t.push({gsp_id:e.id,compId:n.compId,value:n.value,valueDisplay:n.valueDisplay,name:n.name})})),t},le=function(){var e,t;if("1"===S)return e=vt.getComparatorName(F.compId),t=null!==F.valueDisplay?F.valueDisplay:F.value,[{type:"exp",propName:F.gsProp,comp:e,value:t}];var n,a,c=[];return z.forEach((function(r){"exp"===r.type?(n=Y.find((function(e){return e.name===r.name})),e=vt.getComparatorName(n.compId),t=null!==n.valueDisplay?n.valueDisplay:n.value,a={type:"exp",propName:n.gsProp,comp:e,value:t}):a="logic"===r.type?{type:"logic",name:r.displayName}:{type:"grouping",name:r.displayName},c.push(a)})),c},de=Object(P.jsxs)(m.a,{children:[Object(P.jsx)(x.a,{span:4,children:Object(P.jsx)(Qt,{strong:!0,children:"Expression"})}),Object(P.jsx)(x.a,{span:7,children:Object(P.jsx)(Qt,{strong:!0,children:"Game State Prop"})}),Object(P.jsx)(x.a,{span:6,children:Object(P.jsx)(Qt,{strong:!0,children:"Comparator"})}),Object(P.jsx)(x.a,{span:7,children:Object(P.jsx)(Qt,{strong:!0,children:"Value"})})]});return Object(P.jsx)(T.a,{title:null===v?"New condition":"Edit condition",className:"condition-editor",placement:"bottom",height:360,onClose:H,visible:h,bodyStyle:{paddingBottom:20},footer:Object(P.jsxs)("div",{style:{textAlign:"right"},children:[Object(P.jsx)(O.a,{onClick:H,style:{marginRight:8},children:"Cancel"}),Object(P.jsx)(O.a,{type:"primary",style:{marginRight:8},onClick:function(){if("1"===S)I(ie(F));else{var e=Y.length>0,t=0;Y.forEach((function(e){ie(e)&&(t+=1)}));var n=Y.length===t,c=a.validateComplexCondition(z,Y);I(e&&n&&c)}},children:"Validate"}),Object(P.jsx)(O.a,{type:"primary",htmlType:"submit",form:"add-edit-condition-id",disabled:!N,children:null===v?"Set":"Update"})]}),children:Object(P.jsx)(_.a,{layout:"vertical",name:"add-edit-condition",id:"add-edit-condition-id",form:u,onFinish:function(e){var t={mode:"1"===S?"simple":"complex",expressions:oe(),display:le()};"2"===S&&(t.logic_func=z),l({type:"SET_ACTIVE_CONDITION_COMPLETED",payload:t}),H()},requiredMark:!1,children:Object(P.jsxs)(ce.a,{tabPosition:"left",activeKey:S,onChange:function(e){E(e),I(!1)},children:[Object(P.jsx)(Yt,{tab:"Single",children:Object(P.jsxs)(m.a,{gutter:[24,16],children:[Object(P.jsx)(x.a,{span:8,children:Object(P.jsx)(_.a.Item,{label:"Game State Prop",children:Ct.renderGameStatePropsSelector(F.gsProp,(function(e){var t=F,n=K[e];t.gsProp=n.name,t.gsPropType=n.type,t.comp=null,t.compId=null,t.valueInputType=null,t.value=null,t.valueDisplay=null,V(Object(he.a)({},t)),I(!1)}),K)})}),Object(P.jsx)(x.a,{span:8,style:{display:null!==F.gsProp?"block":"none"},children:Object(P.jsx)(_.a.Item,{label:"Comparator",children:Ct.renderComparatorSelector(F.gsPropType,F.compId,(function(e){var t=F;t.compId=e,t.valueInputType=vt.getInputTypeForExpression(t.gsPropType,t.compId),t.value=null,t.valueDisplay=null,V(Object(he.a)({},t)),I(!1)}))})}),Object(P.jsx)(x.a,{span:8,style:{display:null!==F.compId&&"IS_EMPTY"!==F.compId?"block":"none"},children:Object(P.jsx)(_.a.Item,{label:"Value",children:Ct.renderValueSelector(F.gsPropType,F.valueInputType,F.value,(function(e,t){var n=F;n.value=e,n.valueDisplay=t,V(Object(he.a)({},n)),I(!1)}))})})]})},"1"),Object(P.jsxs)(Yt,{tab:"Complex",children:[Object(P.jsx)(m.a,{style:{marginBottom:8},children:Object(P.jsx)(x.a,{span:24,children:Object(P.jsxs)(zt.b,{children:[Object(P.jsx)(O.a,{type:"default",size:"small",onClick:function(){re("ADD_EXP")},children:"Expression"}),Object(P.jsx)(O.a,{type:"default",size:"small",onClick:function(){re("AND")},children:"AND"}),Object(P.jsx)(O.a,{type:"default",size:"small",onClick:function(){re("OR")},children:"OR"}),Object(P.jsx)(O.a,{type:"default",size:"small",onClick:function(){re("NEG")},children:"NEG"}),Object(P.jsx)(O.a,{type:"default",size:"small",onClick:function(){re("OPEN_GR")},children:"("}),Object(P.jsx)(O.a,{type:"default",size:"small",onClick:function(){re("CLOSE_GR")},children:")"}),Object(P.jsx)(O.a,{type:"default",size:"small",onClick:function(){re("DELETE")},children:"Delete"}),Object(P.jsx)(O.a,{type:"default",size:"small",onClick:function(){re("CLEAR")},children:"Clear"})]})})}),Object(P.jsx)(m.a,{style:{marginBottom:16},children:Object(P.jsx)(x.a,{span:24,children:Object(P.jsx)("div",{className:"condition-viewer",children:function(){var e=z&&z.map((function(e,t){var n="logic"===e.type?"#52c41a":"grouping"===e.type?"#eb2f96":"#1890ff";return Object(P.jsx)(yt.a,{color:n,children:e.displayName||e.name},t)}));return e.push(Wt),e}()})})}),Object(P.jsx)(m.a,{children:Object(P.jsx)(x.a,{span:24,children:Y.length>0&&Object(P.jsx)(se.b,{style:{marginBottom:16,maxWidth:"94%"},header:de,dataSource:Y,renderItem:function(e){return Object(P.jsx)(Gt,{expression:e,gameStates:K,onChange:ae})}})})})]},"2")]})})})},Kt=l.a.Content,Zt=ce.a.TabPane,Jt=function(){var e=Object(r.useState)(!1),t=Object(c.a)(e,2),n=t[0],a=t[1],i=Object(r.useState)("1"),o=Object(c.a)(i,2),s=o[0],l=o[1],d=function(){a(!0)};return Object(P.jsxs)(P.Fragment,{children:[Object(P.jsx)(Kt,{className:"story-page",children:Object(P.jsxs)(ce.a,{type:"card",size:"small",onChange:function(e){l(e)},children:[Object(P.jsx)(Zt,{tab:"Storyline (Plot)",children:Object(P.jsx)(bt,{onAddEditCondition:function(){d()}})},"1"),Object(P.jsx)(Zt,{tab:"Sequenced Actions",children:Object(P.jsx)(xt,{sectionActive:"2"===s})},"2"),Object(P.jsx)(Zt,{tab:"Navigation Actions",children:Object(P.jsx)(At,{sectionActive:"3"===s})},"3"),Object(P.jsx)(Zt,{tab:"Interactive Actions",children:Object(P.jsx)(kt,{sectionActive:"4"===s})},"4"),Object(P.jsx)(Zt,{tab:"No-Effect Actions",children:Object(P.jsx)(Tt,{sectionActive:"5"===s,onAddEditCondition:function(){d()}})},"5"),Object(P.jsx)(Zt,{tab:"Conversations",children:Object(P.jsx)(qt,{sectionActive:"6"===s})},"6")]})}),Object(P.jsx)(Xt,{isDrawerVisible:n,onDrawerClose:function(){a(!1)}})]})},Ht=n(84),$t=n(393),en=n(394),tn=n(416),nn=(n(376),function(){var e=Object(r.useContext)(D.a),t=Object(c.a)(e,2),n=t[0],a=t[1],i=Object(r.useState)(!0),o=Object(c.a)(i,2),s=o[0],l=o[1];Object(r.useEffect)((function(){l(!1),setTimeout((function(){l(!0)}),5)}),[n.storyVerifyingRunnable]);return Object(P.jsx)(tn.a,{children:Object(P.jsxs)("div",{className:"play-actions",children:[s&&function(){var e;return e=n.storyVerifyingRunnable?Object(P.jsx)(Ht.a,{}):n.storyRunnable?Object(P.jsx)("span",{children:"You're all set!! Play your story."}):Object(P.jsx)("span",{children:'Please check "Story validation" tab.'}),Object(P.jsx)("p",{style:{marginBottom:0,marginRight:8},children:e})}(),Object(P.jsx)(O.a,{type:"primary",disabled:!n.storyRunnable,onClick:function(){I.a.startNewPlayTestRun(a).then((function(){var e=new URLSearchParams;e.set("play","true");var t=window.location.href+"?"+e.toString(),n=window.open(t,"_blank","noopener,noreferrer");n&&(n.opener=null)})).catch((function(e){b.b.error("Something went wrong, sorry :(")}))},children:"RUN PLAYTEST"})]})})}),an=(n(377),o.a.Title),cn=o.a.Paragraph,rn=o.a.Text,on=function(){var e=Object(r.useState)(!1),t=Object(c.a)(e,2),n=t[0],a=t[1],i=Object(r.useState)(!1),o=Object(c.a)(i,2),s=o[0],l=o[1];return Object(P.jsx)("div",{className:"playtest-configuration-section",children:Object(P.jsxs)(m.a,{gutter:[24,24],style:{paddingBottom:24},children:[Object(P.jsx)(x.a,{span:24,children:Object(P.jsxs)(Ee.a,{className:"run-configuration ".concat(n?"enabled-state":""),children:[Object(P.jsxs)("div",{style:{flex:1},children:[Object(P.jsx)(an,{level:5,children:"Group player inventory"}),Object(P.jsx)(cn,{children:Object(P.jsx)(rn,{type:"secondary",children:"Show inventory props in separate group"})})]}),Object(P.jsx)(fe.a,{onChange:function(e){a(e)}})]})}),Object(P.jsx)(x.a,{span:24,children:Object(P.jsxs)(Ee.a,{className:"run-configuration ".concat(s?"enabled-state":""),children:[Object(P.jsxs)("div",{style:{flex:1},children:[Object(P.jsx)(an,{level:5,children:"Show player achievements"}),Object(P.jsx)(cn,{children:Object(P.jsx)(rn,{type:"secondary",children:"Display notifications when player accomplish objectives, obtain items, etc"})})]}),Object(P.jsx)(fe.a,{onChange:function(e){l(e)}})]})}),Object(P.jsx)(x.a,{span:24,children:Object(P.jsxs)(Ee.a,{className:"run-configuration",children:[Object(P.jsxs)("div",{style:{flex:1},children:[Object(P.jsx)(an,{level:5,children:"Focus Game state props"}),Object(P.jsx)(cn,{children:Object(P.jsx)(rn,{type:"secondary",children:"Analyze specific properties in play mode"})})]}),Object(P.jsx)(rn,{children:"TBD"})]})})]})})},sn=function(){return Object(P.jsx)("div",{className:"story-validation-section",style:{width:"80%",margin:"0 auto"},children:Object(P.jsxs)(m.a,{gutter:[4,4],style:{paddingBottom:24},children:[Object(P.jsx)(x.a,{span:24,children:Object(P.jsxs)(Ee.a,{children:[Object(P.jsx)("p",{children:"Card content"}),Object(P.jsx)("p",{children:"Card content"}),Object(P.jsx)("p",{children:"Card content"})]})}),Object(P.jsx)(x.a,{span:24,children:Object(P.jsxs)(Ee.a,{children:[Object(P.jsx)("p",{children:"Card content"}),Object(P.jsx)("p",{children:"Card content"}),Object(P.jsx)("p",{children:"Card content"})]})}),Object(P.jsx)(x.a,{span:24,children:Object(P.jsxs)(Ee.a,{children:[Object(P.jsx)("p",{children:"Card content"}),Object(P.jsx)("p",{children:"Card content"}),Object(P.jsx)("p",{children:"Card content"})]})})]})})},ln=(n(378),l.a.Content),dn=ce.a.TabPane,un=function(){var e=Object(r.useContext)(D.a),t=Object(c.a)(e,1)[0],n=Object(r.useState)(!0),a=Object(c.a)(n,2),i=a[0],o=a[1];Object(r.useEffect)((function(){o(!1),setTimeout((function(){o(!0)}),5)}),[t.storyVerifyingRunnable]);return Object(P.jsxs)(P.Fragment,{children:[Object(P.jsx)(nn,{}),Object(P.jsx)(ln,{className:"play-mode-page",children:Object(P.jsxs)(ce.a,{type:"card",size:"small",children:[Object(P.jsx)(dn,{tab:"Playtest configuration",children:Object(P.jsx)(on,{})},"1"),Object(P.jsx)(dn,{tab:i&&function(){var e;return e=t.storyVerifyingRunnable?Object(P.jsx)(Ht.a,{style:{marginLeft:8}}):t.storyRunnable?Object(P.jsx)($t.a,{style:{color:"#389e0d",marginLeft:8}}):Object(P.jsx)(en.a,{style:{color:"#cf1322",marginLeft:8}}),Object(P.jsxs)("span",{children:["Story validation ",e]})}(),children:Object(P.jsx)(sn,{})},"2")]})})]})},jn=o.a.Text,bn=function(){var e=Object(r.useContext)(D.a),t=Object(c.a)(e,2),n=t[0],a=t[1];if(Object(r.useEffect)((function(){I.a.checkDatabaseOk(a),I.a.checkStoryLoaded(a)}),[]),!n.initialCheckDone||n.globalLoading)return Object(P.jsxs)("div",{className:"app loading",children:[Object(P.jsx)("img",{src:Q.a,alt:"RPG Story Playtesting"}),Object(P.jsx)(s.a,{size:"large"})]});if(n.databaseLoadError)return Object(P.jsx)(jn,{style:{display:"block",textAlign:"center",paddingTop:50},children:"This application requires IndexedDB. Please use a browser that supports this feature."});if(n.storyLoadError)return Object(P.jsxs)(jn,{style:{display:"block",textAlign:"center",paddingTop:50},children:["We were unable to load your story, please reload and make sure your file/url contains a RPG-SP story.",Object(P.jsx)("br",{}),null!==n.storyErrorMessage&&"Error info: "+n.storyErrorMessage]});var o=null;if(n.storyLoaded)switch(n.page){case"PLAYMODE":o=un;break;case"STORY":o=Jt;break;case"CONFIG":default:o=He}return Object(P.jsx)("div",{className:"app",children:Object(P.jsxs)(l.a,{children:[Object(P.jsx)(X,{}),Object(P.jsx)(l.a,{className:"app-layout",children:n.storyLoaded?Object(P.jsxs)(P.Fragment,{children:[Object(P.jsx)($,{}),i.a.createElement(o)]}):Object(P.jsx)(ae,{})})]})})};n(379),n(380),t.default=function(){return Object(P.jsx)(D.b,{children:Object(P.jsx)(bn,{})})}}}]);
//# sourceMappingURL=5.ec6c18f7.chunk.js.map