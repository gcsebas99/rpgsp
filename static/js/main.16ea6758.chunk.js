(this.webpackJsonprpgsp=this.webpackJsonprpgsp||[]).push([[0],{220:function(e,t,n){},291:function(e,t,n){},292:function(e,t,n){},294:function(e,t,n){},295:function(e,t,n){},356:function(e,t,n){},357:function(e,t,n){},358:function(e,t,n){},359:function(e,t,n){},360:function(e,t,n){},361:function(e,t,n){},362:function(e,t,n){},363:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(20),i=n.n(c),o=(n(220),n(8)),s=n(369),l=n(207),u=n(366),d=n(374),j=n(376),b=n(111),h=n(99),f=n(52),m=n(378),O=n(379),p=n(380),x=n(381),y=n(215),v=n(382),g=n(383),w=n(384),A=n(368),C=n(211),S=n(373),k=n(372),D=n(59),B=function(e,t){switch(t.type){case"SET_APP_INITIAL_CHECK_DONE":return Object(D.a)(Object(D.a)({},e),{},{initialCheckDone:!0});case"SET_APP_DATABASE_LOAD_ERROR":return Object(D.a)(Object(D.a)({},e),{},{databaseLoadError:!0,initialCheckDone:!0});case"SET_APP_PAGE":return Object(D.a)(Object(D.a)({},e),{},{page:t.payload});case"SET_STORY_LOADED":return Object(D.a)(Object(D.a)({},e),{},{storyLoaded:t.payload,page:t.payload?"CONFIG":"EMPTY"});default:return e}},P=n(1),T={initialCheckDone:!1,databaseLoadError:!1,storyLoaded:!1,page:"EMPTY"},E=Object(a.createContext)(T),R=function(e){var t=e.children,n=Object(a.useReducer)(B,T),r=Object(o.a)(n,2),c=r[0],i=r[1];return Object(P.jsx)(E.Provider,{value:[c,i],children:t})},I=n(28),N=n.n(I),L=n(43),Q=n(84),V=n(85),F=new(n(164).default)("RpgspDatabase");F.version(1).stores({stories:"++id",game_state_props:"++id, name",locations:"++id, name",areas:"++id, location_id, name",characters:"++id, name",custom_entity_defs:"++id",custom_entities:"++id, custom_entity_def_id, name",default_entity_colors:"++id",chapters:"++id, order",acts:"++id, order, type"});var _=F,q=function(){function e(){Object(Q.a)(this,e)}return Object(V.a)(e,null,[{key:"getNewStoryDefaultGameStateProps",value:function(){return[{name:"currentChapter",type:"integer",default:0,edit_mode:"none",removable:!1},{name:"currentAct",type:"integer",default:0,edit_mode:"none",removable:!1},{name:"currentActSequence",type:"integer",default:0,edit_mode:"none",removable:!1},{name:"currentLocation",type:"location",default:null,edit_mode:"default",removable:!1},{name:"currentArea",type:"area",default:null,edit_mode:"default",removable:!1}]}},{key:"getNewStoryDefaultCharacters",value:function(){return[{name:"[Playable character]",description:"[Add description]"}]}},{key:"getNewStoryDefaultEntityColors",value:function(){return[{name:"locations",color:e.getEntitiesDefaultColors("locations")},{name:"areas",color:e.getEntitiesDefaultColors("areas")},{name:"characters",color:e.getEntitiesDefaultColors("characters")}]}},{key:"getEntitiesDefaultColors",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"locations";switch(e){case"characters":return"#1890ff";case"areas":return"#a0d911";case"locations":default:return"#3f6600"}}},{key:"getCustomEntityRandomColor",value:function(){return["#ffa940","#73d13d","#10239e","#36cfc9","#9e1068","#9254de","#85a5ff","#fadb14","#ffa940","#391085"][Math.floor(10*Math.random())]}}]),e}(),z=function(){function e(){Object(Q.a)(this,e)}return Object(V.a)(e,null,[{key:"checkDatabaseOk",value:function(e){F.open().catch((function(t){console.error("Failed to open db: "+(t.stack||t)),e({type:"SET_APP_DATABASE_LOAD_ERROR"})}))}},{key:"checkStoryLoaded",value:function(){var e=Object(L.a)(N.a.mark((function e(t){return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_.stories.where("id").equals(1).first();case 2:void 0!==e.sent&&t({type:"SET_STORY_LOADED",payload:!0}),t({type:"SET_APP_INITIAL_CHECK_DONE"});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"createNewStory",value:function(e,t){return _.transaction("rw",_.stories,_.game_state_props,_.characters,_.default_entity_colors,Object(L.a)(N.a.mark((function e(){return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_.stories.add({title:t.title,version:t.version});case 2:return e.next=4,_.game_state_props.bulkAdd(q.getNewStoryDefaultGameStateProps());case 4:return e.next=6,_.characters.bulkAdd(q.getNewStoryDefaultCharacters());case 6:return e.next=8,_.default_entity_colors.bulkAdd(q.getNewStoryDefaultEntityColors());case 8:case"end":return e.stop()}}),e)})))).then((function(t){e({type:"SET_STORY_LOADED",payload:!0})})).catch((function(e){return console.log("||--FAIL",e),Promise.reject(e)}))}},{key:"createNewGameStateProp",value:function(e,t){return _.game_state_props.add({name:t.name,type:t.type,default:t.defaultValue,edit_mode:t.editMode,removable:t.removable}).then((function(){})).catch((function(e){return console.log("||--FAIL",e),Promise.reject(e)}))}},{key:"updateGameStateProp",value:function(e,t,n){return _.game_state_props.update(t,{name:n.name,type:n.type,default:n.defaultValue,edit_mode:n.editMode,removable:n.removable}).then((function(){})).catch((function(e){return console.log("||--FAIL",e),Promise.reject(e)}))}},{key:"deleteGameStateProp",value:function(e,t){return _.game_state_props.delete(t).then((function(){})).catch((function(e){return console.log("||--FAIL",e),Promise.reject(e)}))}},{key:"createNewLocation",value:function(e,t){return _.locations.add({name:t.name,description:t.description}).then((function(){})).catch((function(e){return console.log("||--FAIL",e),Promise.reject(e)}))}},{key:"updateLocation",value:function(e,t,n){return _.locations.update(t,{name:n.name,description:n.description}).then((function(){})).catch((function(e){return console.log("||--FAIL",e),Promise.reject(e)}))}},{key:"deleteLocation",value:function(e,t){return _.transaction("rw",_.locations,_.areas,Object(L.a)(N.a.mark((function e(){return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_.areas.where("location_id").equals(t).delete();case 2:return e.next=4,_.locations.delete(t);case 4:case"end":return e.stop()}}),e)})))).then((function(e){})).catch((function(e){return console.log("||--FAIL",e),Promise.reject(e)}))}},{key:"createNewArea",value:function(e,t){return _.areas.add({location_id:t.location_id,name:t.name,description:t.description}).then((function(){})).catch((function(e){return console.log("||--FAIL",e),Promise.reject(e)}))}},{key:"updateArea",value:function(e,t,n){return _.areas.update(t,{name:n.name,description:n.description}).then((function(){})).catch((function(e){return console.log("||--FAIL",e),Promise.reject(e)}))}},{key:"deleteArea",value:function(e,t){return _.areas.delete(t).then((function(){})).catch((function(e){return console.log("||--FAIL",e),Promise.reject(e)}))}},{key:"createNewCharacter",value:function(e,t){return _.characters.add({name:t.name,description:t.description}).then((function(){})).catch((function(e){return console.log("||--FAIL",e),Promise.reject(e)}))}},{key:"updateCharacter",value:function(e,t,n){return _.characters.update(t,{name:n.name,description:n.description}).then((function(){})).catch((function(e){return console.log("||--FAIL",e),Promise.reject(e)}))}},{key:"deleteCharacter",value:function(e,t){return _.characters.delete(t).then((function(){})).catch((function(e){return console.log("||--FAIL",e),Promise.reject(e)}))}},{key:"createNewCustomEntityDef",value:function(e,t){return _.custom_entity_defs.add({name:t.name,key:t.key,singular_name:t.singular,color:q.getCustomEntityRandomColor()}).then((function(){})).catch((function(e){return console.log("||--FAIL",e),Promise.reject(e)}))}},{key:"deleteCustomEntityDef",value:function(e,t){return _.transaction("rw",_.custom_entity_defs,_.custom_entities,Object(L.a)(N.a.mark((function e(){return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_.custom_entities.where("custom_entity_def_id").equals(t).delete();case 2:return e.next=4,_.custom_entity_defs.delete(t);case 4:case"end":return e.stop()}}),e)})))).then((function(e){})).catch((function(e){return console.log("||--FAIL",e),Promise.reject(e)}))}},{key:"createNewCustomEntity",value:function(e,t){return _.custom_entities.add({custom_entity_def_id:t.custom_entity_def_id,name:t.name,description:t.description}).then((function(){})).catch((function(e){return console.log("||--FAIL",e),Promise.reject(e)}))}},{key:"updateCustomEntity",value:function(e,t,n){return _.custom_entities.update(t,{name:n.name,description:n.description}).then((function(){})).catch((function(e){return console.log("||--FAIL",e),Promise.reject(e)}))}},{key:"deleteCustomEntity",value:function(e,t){return _.custom_entities.delete(t).then((function(){})).catch((function(e){return console.log("||--FAIL",e),Promise.reject(e)}))}},{key:"updateDefaultEntityColor",value:function(e,t,n){return _.default_entity_colors.update(t,{color:n.color}).then((function(){})).catch((function(e){return console.log("||--FAIL",e),Promise.reject(e)}))}},{key:"updateCustomEntityDefColor",value:function(e,t,n){return _.custom_entity_defs.update(t,{color:n.color}).then((function(){})).catch((function(e){return console.log("||--FAIL",e),Promise.reject(e)}))}},{key:"createNewChapter",value:function(e,t){return _.chapters.add({name:t.name,description:t.description,order:t.order}).then((function(){})).catch((function(e){return console.log("||--FAIL",e),Promise.reject(e)}))}},{key:"updateChapter",value:function(e,t,n){return _.chapters.update(t,{name:n.name,description:n.description}).then((function(){})).catch((function(e){return console.log("||--FAIL",e),Promise.reject(e)}))}},{key:"updateChapterOrder",value:function(e,t,n){return _.transaction("rw",_.chapters,Object(L.a)(N.a.mark((function e(){var a;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_.chapters.where("order").equals(n.order).first();case 2:return a=e.sent,e.next=5,_.chapters.update(t,{order:n.order});case 5:return e.next=7,_.chapters.update(a.id,{order:n.oldOrder});case 7:case"end":return e.stop()}}),e)})))).then((function(e){})).catch((function(e){return console.log("||--FAIL",e),Promise.reject(e)}))}},{key:"deleteChapter",value:function(e,t){return _.transaction("rw",_.chapters,Object(L.a)(N.a.mark((function e(){var n,a,r;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=null,a=[],r=_.chapters.orderBy("order"),e.next=5,r.each((function(e){null!==n&&a.push({key:e.id,order:n+a.length}),e.id===t&&(n=e.order)}));case 5:return e.next=7,_.chapters.delete(t);case 7:a.forEach(function(){var e=Object(L.a)(N.a.mark((function e(t){return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_.chapters.update(t.key,{order:t.order});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 8:case"end":return e.stop()}}),e)})))).then((function(e){})).catch((function(e){return console.log("||--FAIL",e),Promise.reject(e)}))}},{key:"devStartOver",value:function(e){return _.delete().then((function(){return window.location.reload()}))}}]),e}(),U=function(e){var t=e.isDrawerVisible,n=e.onDrawerClose,r=Object(a.useContext)(E),c=Object(o.a)(r,2)[1],i=A.a.useForm(),s=Object(o.a)(i,1)[0],l=Object(a.useState)(!1),u=Object(o.a)(l,2),d=u[0],j=u[1],m=Object(a.useState)(""),O=Object(o.a)(m,2),p=O[0],x=O[1],y=Object(a.useState)(""),v=Object(o.a)(y,2),g=v[0],w=v[1];Object(a.useEffect)((function(){t&&(s.resetFields(),D())}),[t,s]);var D=function(){j(!0)},B=function(){j(!1),n&&n()};return Object(P.jsx)(S.a,{title:"New story",width:360,onClose:B,visible:d,bodyStyle:{paddingBottom:20},footer:Object(P.jsxs)("div",{style:{textAlign:"right"},children:[Object(P.jsx)(b.a,{onClick:B,style:{marginRight:8},children:"Cancel"}),Object(P.jsx)(b.a,{type:"primary",htmlType:"submit",form:"create-story-id",children:"Create"})]}),children:Object(P.jsxs)(A.a,{layout:"vertical",name:"create-story",id:"create-story-id",form:s,onFinish:function(e){var t=e.title.trim(),n=e.version.trim();if(""===t||""===n)return B(),void C.b.error("Something went wrong, sorry :(");var a={title:t,version:n};z.createNewStory(c,a).then((function(e){B(),C.b.success("Story created!")})).catch((function(e){B(),C.b.error("Something went wrong, sorry :(")}))},requiredMark:!1,children:[Object(P.jsx)(h.a,{gutter:16,children:Object(P.jsx)(f.a,{span:24,children:Object(P.jsx)(A.a.Item,{name:"title",label:"Title",rules:[{required:!0,message:"Please enter a title"}],children:Object(P.jsx)(k.a,{placeholder:"Please enter a title",value:p,onChange:function(e){x(e.target.value)}})})})}),Object(P.jsx)(h.a,{gutter:16,children:Object(P.jsx)(f.a,{span:24,children:Object(P.jsx)(A.a.Item,{name:"version",label:"Version",rules:[{required:!0,message:"Please enter a version"}],children:Object(P.jsx)(k.a,{placeholder:"Please enter a version",value:g,onChange:function(e){w(e.target.value)}})})})})]})})},K="data:image/png;base64,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",G=(n(291),u.a.Sider),M=function(){var e=Object(a.useContext)(E),t=Object(o.a)(e,2),n=t[0],r=t[1],c=Object(a.useState)(!1),i=Object(o.a)(c,2),s=i[0],l=i[1],u=Object(a.useState)(!0),A=Object(o.a)(u,2),C=A[0],S=A[1],k=Object(a.useState)(!1),D=Object(o.a)(k,2),B=D[0],T=D[1];Object(a.useEffect)((function(){S(!1),setTimeout((function(){S(!0)}),5)}),[n.storyLoaded]);var R=function(){z.devStartOver(r)},I=function(){l(!s)},N=function(e){switch(e.key){case"1":r({type:"SET_APP_PAGE",payload:"CONFIG"});break;case"2":r({type:"SET_APP_PAGE",payload:"STORY"})}};return Object(P.jsxs)(P.Fragment,{children:[Object(P.jsxs)(G,{className:"app-nav",collapsible:!0,collapsed:s,onCollapse:I,children:[Object(P.jsx)("div",{className:"logo ".concat(s?"collapsed":""),children:Object(P.jsx)("img",{src:K,alt:"RPG Story Playtesting",onClick:I})}),Object(P.jsx)("div",{className:"menu-wrapper",children:C&&Object(P.jsxs)(d.a,{theme:"dark",mode:"inline",defaultSelectedKeys:n.storyLoaded?["1"]:[],onClick:N,children:[Object(P.jsx)(d.a.Item,{disabled:!n.storyLoaded,icon:Object(P.jsx)(m.a,{}),children:"Configuration"},"1"),Object(P.jsx)(d.a.Item,{disabled:!n.storyLoaded,icon:Object(P.jsx)(O.a,{}),children:"Story"},"2"),Object(P.jsx)(d.a.Item,{disabled:!n.storyLoaded,icon:Object(P.jsx)(p.a,{}),children:"Play"},"3")]})}),!s&&Object(P.jsx)(h.a,{gutter:16,style:{marginLeft:8,marginRight:8,marginTop:32},children:Object(P.jsxs)(f.a,{span:24,children:[!n.storyLoaded&&Object(P.jsx)(b.a,{type:"default",onClick:function(){T(!0)},block:!0,icon:Object(P.jsx)(y.a,{}),style:{marginBottom:12},children:"New story"}),Object(P.jsx)(b.a,{type:"default",block:!0,icon:Object(P.jsx)(v.a,{}),style:{marginBottom:12},onClick:function(){r({type:"SET_STORY_LOADED",payload:!0})},children:"Load story"}),n.storyLoaded&&Object(P.jsxs)(P.Fragment,{children:[Object(P.jsx)(b.a,{type:"default",block:!0,icon:Object(P.jsx)(g.a,{}),style:{marginBottom:12},children:"Download story"}),Object(P.jsx)(j.a,{title:"All data will be lost. Are you sure to delete this story?",onConfirm:R,onCancel:function(){},okText:"Yes",cancelText:"No",placement:"right",children:Object(P.jsx)(b.a,{type:"default",block:!0,icon:Object(P.jsx)(x.a,{}),style:{marginBottom:12},children:"Clear story"})})]}),Object(P.jsx)(b.a,{type:"default",block:!0,icon:Object(P.jsx)(w.a,{}),style:{marginBottom:12},onClick:function(){z.devStartOver(r)},children:"dev:startover"})]})})]}),Object(P.jsx)(U,{isDrawerVisible:B,onDrawerClose:function(){T(!1)}})]})},J=n(31),X=(n(292),u.a.Header),Y=s.a.Title,H=s.a.Text,Z=function(){var e=Object(J.useLiveQuery)((function(){return _.stories.where("id").equals(1).first()}));return void 0===e?null:Object(P.jsxs)(X,{className:"story-title",children:[Object(P.jsxs)(Y,{level:5,children:["RPG-SP: ",e.title]}),Object(P.jsxs)(H,{type:"secondary",children:["Version: ",e.version]})]})},W=n.p+"static/media/jake-reading.fddcdec6.png",$=(n(294),u.a.Content),ee=s.a.Text,te=function(){return Object(P.jsxs)($,{className:"empty-project-page",children:[Object(P.jsx)("img",{src:W,alt:"Start a new story"}),Object(P.jsx)(ee,{children:"Create a new story or load an existing one"})]})},ne=n(168),ae=(n(295),n(385)),re=n(386),ce=function(e){var t=e.isDrawerVisible,n=e.onDrawerClose,r=Object(a.useContext)(E),c=Object(o.a)(r,2)[1],i=A.a.useForm(),s=Object(o.a)(i,1)[0],l=Object(a.useState)(!1),u=Object(o.a)(l,2),d=u[0],j=u[1];Object(a.useEffect)((function(){t&&(s.resetFields(),m())}),[t,s]);var m=function(){j(!0)},O=function(){j(!1),n&&n()};return Object(P.jsx)(S.a,{title:"Add Custom Entity",width:360,onClose:O,visible:d,bodyStyle:{paddingBottom:20},footer:Object(P.jsxs)("div",{style:{textAlign:"right"},children:[Object(P.jsx)(b.a,{onClick:O,style:{marginRight:8},children:"Cancel"}),Object(P.jsx)(b.a,{type:"primary",htmlType:"submit",form:"create-custom-entity-id",children:"Add"})]}),children:Object(P.jsxs)(A.a,{layout:"vertical",name:"create-custom-entity",id:"create-custom-entity-id",form:s,onFinish:function(e){var t=e.name.trim(),n=e.key.trim(),a=e.singular.trim();if(""===t||""===a)return O(),void C.b.error("Do not leave empty fields, sorry :(");var r={name:t,key:n,singular:a};z.createNewCustomEntityDef(c,r).then((function(e){O(),C.b.success("New entity created!")})).catch((function(e){O(),C.b.error("Something went wrong, sorry :(")}))},requiredMark:!1,children:[Object(P.jsx)(h.a,{gutter:16,children:Object(P.jsx)(f.a,{span:24,children:Object(P.jsx)(A.a.Item,{name:"name",label:"Name (use plural)",rules:[{required:!0,message:"Please enter a name"}],children:Object(P.jsx)(k.a,{placeholder:"Please enter a name",onChange:function(e){var t=e.target.value.toLowerCase().replace(/\s/g,"");s.setFieldsValue({key:t})}})})})}),Object(P.jsx)(h.a,{gutter:16,children:Object(P.jsx)(f.a,{span:24,children:Object(P.jsx)(A.a.Item,{name:"key",label:"Key",children:Object(P.jsx)(k.a,{readOnly:!0,placeholder:""})})})}),Object(P.jsx)(h.a,{gutter:16,children:Object(P.jsx)(f.a,{span:24,children:Object(P.jsx)(A.a.Item,{name:"singular",label:"Singular",rules:[{required:!0,message:"Please enter singular entity name"}],children:Object(P.jsx)(k.a,{placeholder:"Please enter singular entity name"})})})})]})})},ie=n(370),oe=n(367),se=n(167),le=n.n(se),ue=(n(350),function(e){var t=e.isDrawerVisible,n=e.onDrawerClose,r=Object(a.useContext)(E),c=Object(o.a)(r,2)[1],i=Object(a.useState)(!1),s=Object(o.a)(i,2),l=s[0],u=s[1],d=Object(a.useState)({}),j=Object(o.a)(d,2),m=j[0],O=j[1],p=Object(a.useState)({}),x=Object(o.a)(p,2),y=x[0],v=x[1],g=Object(a.useState)(!0),w=Object(o.a)(g,2),A=w[0],k=w[1],D=Object(J.useLiveQuery)((function(){return _.custom_entity_defs.toArray()})),B=Object(J.useLiveQuery)((function(){return _.default_entity_colors.toArray()}));Object(a.useEffect)((function(){t&&T()}),[t]);var T=function(){O({}),v({}),u(!0)},R=function(){u(!1),n&&n()};return Object(P.jsxs)(S.a,{title:"Edit Colors",width:360,onClose:R,visible:l,bodyStyle:{paddingBottom:20},footer:Object(P.jsxs)("div",{style:{textAlign:"right"},children:[Object(P.jsx)(b.a,{onClick:R,style:{marginRight:8},children:"Cancel"}),Object(P.jsx)(b.a,{type:"primary",onClick:function(){if(k(!0),0!==Object.keys(m).length||0!==Object.keys(y).length){for(var e in m)z.updateDefaultEntityColor(c,parseInt(e),{color:m[e]}).then((function(e){})).catch((function(e){k(!1)}));for(var t in y)z.updateCustomEntityDefColor(c,parseInt(t),{color:y[t]}).then((function(e){})).catch((function(e){k(!1)}));A?(R(),C.b.success("Colors updated!")):(R(),C.b.error("Something went wrong, sorry :("))}else R()},children:"Update"})]}),children:[void 0!==B&&B.length>0&&Object(P.jsx)(ie.b,{dataSource:B,renderItem:function(e){return Object(P.jsx)(ie.b.Item,{className:"default-ent-color-list-item",children:Object(P.jsxs)(h.a,{style:{width:"100%"},children:[Object(P.jsx)(f.a,{span:18,style:{textTransform:"capitalize"},children:e.name}),Object(P.jsx)(f.a,{span:6,style:{textAlign:"right"},children:Object(P.jsx)(le.a,{animation:"slide-up",placement:"bottomRight",enableAlpha:!1,color:e.color,onChange:function(t){!function(e,t){var n=m;n[e]=t,O(n)}(e.id,t.color)}})})]})})}}),void 0!==D&&D.length>0&&Object(P.jsxs)(P.Fragment,{children:[Object(P.jsx)(oe.a,{style:{margin:"0"}}),Object(P.jsx)(ie.b,{dataSource:D,renderItem:function(e){return Object(P.jsx)(ie.b.Item,{className:"custom-ent-color-list-item",children:Object(P.jsxs)(h.a,{style:{width:"100%"},children:[Object(P.jsx)(f.a,{span:18,children:e.name}),Object(P.jsx)(f.a,{span:6,style:{textAlign:"right"},children:Object(P.jsx)(le.a,{animation:"slide-up",placement:"bottomRight",enableAlpha:!1,color:e.color,onChange:function(t){!function(e,t){var n=y;n[e]=t,v(n)}(e.id,t.color)}})})]})})}})]})]})}),de=(n(356),function(e){var t,n=e.gameState,a=e.onEditGameStateProp,r=void 0===a?function(){}:a,c=e.onRemoveGameStateProp,i=void 0===c?function(){}:c;return t=n.type.endsWith("arr")?"[ "+n.default+" ]":n.default,Object(P.jsx)(ie.b.Item,{className:"game-state-list-item",children:Object(P.jsxs)(h.a,{children:[Object(P.jsx)(f.a,{span:6,children:n.name}),Object(P.jsx)(f.a,{span:6,children:n.type}),Object(P.jsx)(f.a,{span:8,children:t}),Object(P.jsxs)(f.a,{span:4,style:{textAlign:"right"},children:["none"!==n.edit_mode&&Object(P.jsx)(b.a,{type:"link",size:"small",onClick:function(){r()},children:"Edit"}),n.removable&&Object(P.jsx)(j.a,{title:"Are you sure you want to remove this game state prop?",onConfirm:function(){i()},onCancel:function(){},okText:"Yes",cancelText:"No",placement:"bottomRight",children:Object(P.jsx)(b.a,{type:"link",size:"small",children:"Remove"})})]})]})})}),je=n(58),be=n(113),he=n(371),fe=n(377),me=function(){function e(){Object(Q.a)(this,e)}return Object(V.a)(e,null,[{key:"validateEntityNames",value:function(){var e=Object(L.a)(N.a.mark((function e(t,n){var a;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=[],e.abrupt("return",_.transaction("r",n,Object(L.a)(N.a.mark((function e(){var r,c,i;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=Object(je.a)(t),e.prev=1,r.s();case 3:if((c=r.n()).done){e.next=11;break}return i=c.value,e.next=7,n.where({name:i}).first();case 7:void 0===e.sent&&a.push(i);case 9:e.next=3;break;case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(1),r.e(e.t0);case 16:return e.prev=16,r.f(),e.finish(16);case 19:if(0!==a.length){e.next=23;break}return e.abrupt("return",Promise.resolve());case 23:return e.abrupt("return",Promise.reject(a));case 24:case"end":return e.stop()}}),e,null,[[1,13,16,19]])})))));case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"validateCustomEntityNames",value:function(){var e=Object(L.a)(N.a.mark((function e(t,n){var a;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=[],e.abrupt("return",_.transaction("r",_.custom_entities,Object(L.a)(N.a.mark((function e(){var r,c,i;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=Object(je.a)(t),e.prev=1,r.s();case 3:if((c=r.n()).done){e.next=11;break}return i=c.value,e.next=7,_.custom_entities.where({name:i,custom_entity_def_id:n}).first();case 7:void 0===e.sent&&a.push(i);case 9:e.next=3;break;case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(1),r.e(e.t0);case 16:return e.prev=16,r.f(),e.finish(16);case 19:if(0!==a.length){e.next=23;break}return e.abrupt("return",Promise.resolve());case 23:return e.abrupt("return",Promise.reject(a));case 24:case"end":return e.stop()}}),e,null,[[1,13,16,19]])})))));case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),Oe=k.a.TextArea,pe=be.a.Option,xe=function(e){var t=e.gameStateProp,n=void 0===t?null:t,r=e.isDrawerVisible,c=e.onDrawerClose,i=Object(a.useContext)(E),s=Object(o.a)(i,2)[1],l=A.a.useForm(),u=Object(o.a)(l,1)[0],d=Object(a.useState)(!1),j=Object(o.a)(d,2),m=j[0],O=j[1],p=Object(a.useState)(""),x=Object(o.a)(p,2),y=x[0],v=x[1],g=Object(a.useState)(""),w=Object(o.a)(g,2),D=w[0],B=w[1],T=Object(a.useState)(0),R=Object(o.a)(T,2),I=R[0],N=R[1],L=Object(a.useState)(!0),Q=Object(o.a)(L,2),V=Q[0],F=Q[1],q=Object(a.useState)(""),U=Object(o.a)(q,2),K=U[0],G=U[1],M=Object(a.useState)(!0),X=Object(o.a)(M,2),Y=X[0],H=X[1],Z=Object(J.useLiveQuery)((function(){return _.custom_entity_defs.toArray()}));Object(a.useEffect)((function(){r&&(u.resetFields(),B(""),n&&(u.setFieldsValue({name:n.name,type:n.type}),B(n.type),function(e){if(D.endsWith("arr")){if(0===e.length)return;var t=e.split(",");switch(D){case"intarr":case"booleanarr":u.setFieldsValue({defaultValueArray:t.join("\n")});break;case"stringarr":case"locationarr":case"areaarr":case"characterarr":default:var n,a=[],r=Object(je.a)(t);try{for(r.s();!(n=r.n()).done;){var c=n.value;a.push(c.slice(1,-1))}}catch(i){r.e(i)}finally{r.f()}u.setFieldsValue({defaultValueArray:a.join("\n")})}}else switch(D){case"int":u.setFieldsValue({defaultValueInt:e});break;case"boolean":u.setFieldsValue({defaultValueBool:e}),F(e);break;case"string":case"location":case"area":case"character":default:u.setFieldsValue({defaultValueString:e})}}(n.default)),W())}),[r,u,n]);var W=function(){O(!0)},$=function(){O(!1),c&&c()},ee=function(){return""!==D&&"int"!==D&&"boolean"!==D&&!D.endsWith("arr")},te=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];switch(D){case"intarr":return e?"int[]":"Place one integer per line";case"booleanarr":return e?"boolean[]":"Place one boolean per line";case"stringarr":return e?"string[]":"Place one string per line";case"locationarr":return e?"location[]":"Place one location per line";case"areaarr":return e?"area[]":"Place one area per line";case"characterarr":return e?"character[]":"Place one character per line";default:if(D.endsWith("arr")){var t=D.slice(0,-3);return e?t+"[]":"Place one "+t+" per line"}return e?"[]":"Place one item per line"}},ne=function(e){var t=e.defaultValueArray;if(0===t.length)ae(e);else{var n=t.split("\n");switch(D){case"intarr":var a,r=Object(je.a)(n);try{for(r.s();!(a=r.n()).done;){var c=a.value;if(!Number.isInteger(parseInt(c)))return void C.b.error("All values in array must be integers")}}catch(b){r.e(b)}finally{r.f()}ae(e);break;case"booleanarr":var i,o=Object(je.a)(n);try{for(o.s();!(i=o.n()).done;){var s=i.value;if("true"!==s&&"false"!==s)return void C.b.error('All values in array must be "true" or "false"')}}catch(b){o.e(b)}finally{o.f()}ae(e);break;case"stringarr":var l,u=Object(je.a)(n);try{for(u.s();!(l=u.n()).done;){if(""===l.value.trim())return void C.b.error("Do not leave empty strings (just spaces are considered empty)")}}catch(b){u.e(b)}finally{u.f()}ae(e);break;case"locationarr":me.validateEntityNames(n,_.locations).then((function(){ae(e)})).catch((function(e){C.b.error("Invalid values: "+e.join(", "))}));break;case"areaarr":me.validateEntityNames(n,_.areas).then((function(){ae(e)})).catch((function(e){C.b.error("Invalid values: "+e.join(", "))}));break;case"characterarr":me.validateEntityNames(n,_.characters).then((function(){ae(e)})).catch((function(e){C.b.error("Invalid values: "+e.join(", "))}));break;default:var d=D.slice(0,-3),j=Z.find((function(e){return e.singular_name===d}));j&&me.validateCustomEntityNames(n,j.id).then((function(){ae(e)})).catch((function(e){C.b.error("Invalid values: "+e.join(", "))}))}}},ae=function(e){if(null===n){var t=e.name.trim(),a=re(e),r={name:t,type:D,defaultValue:a,editMode:"name|default",removable:!0};z.createNewGameStateProp(s,r).then((function(e){$(),C.b.success("New game state prop created!")})).catch((function(e){$(),C.b.error("Something went wrong, sorry :(")}))}else{var c=e.name.trim(),i=re(e),o=n.edit_mode,l=n.removable,u={name:c,type:D,defaultValue:i,editMode:o,removable:l};z.updateGameStateProp(s,n.id,u).then((function(e){$(),C.b.success("Game state prop edited!")})).catch((function(e){$(),C.b.error("Something went wrong, sorry :(")}))}},re=function(e){if(D.endsWith("arr")){var t=e.defaultValueArray;if(0===t.length)return"";var n=t.split("\n");switch(D){case"intarr":case"booleanarr":return n.join(",");case"stringarr":case"locationarr":case"areaarr":case"characterarr":default:var a,r=[],c=Object(je.a)(n);try{for(c.s();!(a=c.n()).done;){var i=a.value;r.push('"'+i+'"')}}catch(o){c.e(o)}finally{c.f()}return r.join(",")}}else switch(D){case"int":return parseInt(e.defaultValueInt);case"boolean":return e.defaultValueBool;case"string":case"location":case"area":case"character":default:return e.defaultValueString}},ce=function(){if(null===n)return!1;var e=n.edit_mode.split("|");return e.indexOf("all")<0&&e.indexOf("default")<0};return Object(P.jsx)(S.a,{title:null===n?"New prop":"Edit prop",width:360,onClose:$,visible:m,bodyStyle:{paddingBottom:20},footer:Object(P.jsxs)("div",{style:{textAlign:"right"},children:[Object(P.jsx)(b.a,{onClick:$,style:{marginRight:8},children:"Cancel"}),Object(P.jsx)(b.a,{type:"primary",htmlType:"submit",form:"add-edit-game-state-prop-id",children:null===n?"Create":"Update"})]}),children:Object(P.jsxs)(A.a,{layout:"vertical",name:"add-edit-game-state-prop",id:"add-edit-game-state-prop-id",form:u,onFinish:function(e){if(""!==e.name.trim())switch(D){case"int":Number.isInteger(parseInt(e.defaultValueInt))?ae(e):C.b.error("Default is not an integer");break;case"boolean":case"string":ae(e);break;case"location":var t=e.defaultValueString.trim();me.validateEntityNames([t],_.locations).then((function(){ae(e)})).catch((function(e){C.b.error("Invalid values: "+e.join(", "))}));break;case"area":var n=e.defaultValueString.trim();me.validateEntityNames([n],_.areas).then((function(){ae(e)})).catch((function(e){C.b.error("Invalid values: "+e.join(", "))}));break;case"character":var a=e.defaultValueString.trim();me.validateEntityNames([a],_.characters).then((function(){ae(e)})).catch((function(e){C.b.error("Invalid values: "+e.join(", "))}));break;default:if(D.endsWith("arr"))ne(e);else if("boolean"!==D&&"string"!==D){var r=Z.find((function(e){return e.singular_name===D}));if(r){var c=e.defaultValueString.trim();me.validateCustomEntityNames([c],r.id).then((function(){ae(e)})).catch((function(e){C.b.error("Invalid values: "+e.join(", "))}))}}}else C.b.error("Do not leave name empty")},requiredMark:!1,children:[Object(P.jsx)(h.a,{gutter:16,children:Object(P.jsx)(f.a,{span:24,children:Object(P.jsx)(A.a.Item,{name:"name",label:"Name",rules:[{required:!0,message:"Please enter a name"}],children:Object(P.jsx)(k.a,{placeholder:"Please enter a name",value:y,onChange:function(e){v(e.target.value)},disabled:function(){if(null===n)return!1;var e=n.edit_mode.split("|");return e.indexOf("all")<0&&e.indexOf("name")<0}()})})})}),Object(P.jsx)(h.a,{gutter:16,children:Object(P.jsx)(f.a,{span:24,children:Object(P.jsx)(A.a.Item,{name:"type",label:"Type",rules:[{required:!0,message:"Please select a type"}],children:Object(P.jsxs)(be.a,{value:D,onChange:function(e){var t;"int"===(t=e)&&u.setFieldsValue({defaultValueInt:""}),"boolean"===t&&u.setFieldsValue({defaultValueBool:V}),t.endsWith("arr")&&u.setFieldsValue({defaultValueArray:""}),""===t||"int"===t||"boolean"===t||t.endsWith("arr")||u.setFieldsValue({defaultValueString:""}),B(t)},disabled:function(){if(null===n)return!1;var e=n.edit_mode.split("|");return e.indexOf("all")<0&&e.indexOf("type")<0}(),children:[Object(P.jsx)(pe,{value:"int",children:"int"}),Object(P.jsx)(pe,{value:"intarr",children:"int[]"}),Object(P.jsx)(pe,{value:"boolean",children:"boolean"}),Object(P.jsx)(pe,{value:"booleanarr",children:"boolean[]"}),Object(P.jsx)(pe,{value:"string",children:"string"}),Object(P.jsx)(pe,{value:"stringarr",children:"string[]"}),Object(P.jsx)(pe,{value:"location",children:"location"}),Object(P.jsx)(pe,{value:"locationarr",children:"location[]"}),Object(P.jsx)(pe,{value:"area",children:"area"}),Object(P.jsx)(pe,{value:"areaarr",children:"area[]"}),Object(P.jsx)(pe,{value:"character",children:"character"}),Object(P.jsx)(pe,{value:"characterarr",children:"character[]"}),void 0!==Z&&Z.map((function(e){return Object(P.jsxs)(P.Fragment,{children:[Object(P.jsx)(pe,{value:e.singular_name,children:e.singular_name}),Object(P.jsxs)(pe,{value:e.singular_name+"arr",children:[e.singular_name,"[]"]})]})}))]})})})}),Object(P.jsx)(h.a,{gutter:16,style:{display:"int"===D?"block":"none"},children:Object(P.jsx)(f.a,{span:24,children:Object(P.jsx)(A.a.Item,{name:"defaultValueInt",label:"Default value (int)",rules:[{required:"int"===D,message:"Please enter an integer"}],children:Object(P.jsx)(he.a,{disabled:ce(),placeholder:"Please enter an integer",value:I,onChange:function(e){N(e)},style:{width:"100%"}})})})}),Object(P.jsx)(h.a,{gutter:16,style:{display:"boolean"===D?"block":"none"},children:Object(P.jsx)(f.a,{span:24,children:Object(P.jsx)(A.a.Item,{name:"defaultValueBool",label:"Default value (boolean)",children:Object(P.jsx)(fe.a,{disabled:ce(),checkedChildren:"true",unCheckedChildren:"false",checked:V,defaultChecked:!0,onChange:function(e){F(e)}})})})}),Object(P.jsx)(h.a,{gutter:16,style:{display:ee()?"block":"none"},children:Object(P.jsx)(f.a,{span:24,children:Object(P.jsx)(A.a.Item,{name:"defaultValueString",label:"Default value (string)",rules:[{required:ee()&&"string"!==D,message:"Please enter a default value"}],children:Object(P.jsx)(k.a,{disabled:ce(),placeholder:"Please enter a default value",value:K,onChange:function(e){G(e.target.value)}})})})}),Object(P.jsx)(h.a,{gutter:16,style:{display:D.endsWith("arr")?"block":"none"},children:Object(P.jsx)(f.a,{span:24,children:Object(P.jsx)(A.a.Item,{name:"defaultValueArray",label:"Default value ("+te()+")",children:Object(P.jsx)(Oe,{disabled:ce(),rows:10,placeholder:te(!1)+" Leave empty for empty array.",value:Y,onChange:function(e){H(e.target.value)}})})})})]})})},ye=s.a.Text,ve=function(){var e=Object(a.useContext)(E),t=Object(o.a)(e,2)[1],n=Object(a.useState)(!1),r=Object(o.a)(n,2),c=r[0],i=r[1],s=Object(a.useState)(null),l=Object(o.a)(s,2),u=l[0],d=l[1],j=Object(J.useLiveQuery)((function(){return _.game_state_props.toArray()})),m=Object(P.jsxs)(h.a,{children:[Object(P.jsx)(f.a,{span:6,children:Object(P.jsx)(ye,{strong:!0,children:"Name"})}),Object(P.jsx)(f.a,{span:6,children:Object(P.jsx)(ye,{strong:!0,children:"Type"})}),Object(P.jsx)(f.a,{span:8,children:Object(P.jsx)(ye,{strong:!0,children:"Default"})}),Object(P.jsx)(f.a,{span:4})]});return Object(P.jsxs)("div",{children:[void 0!==j&&j.length>0&&Object(P.jsx)(ie.b,{style:{marginBottom:"20px",maxWidth:"94%"},header:m,dataSource:j,renderItem:function(e){return Object(P.jsx)(de,{gameState:e,onEditGameStateProp:function(){d(e),i(!0)},onRemoveGameStateProp:function(){var n;n=e,z.deleteGameStateProp(t,n.id).then((function(e){C.b.success("Game state prop removed!")})).catch((function(e){C.b.error("Something went wrong, sorry :(")}))}})}}),Object(P.jsx)(b.a,{type:"primary",onClick:function(){d(null),i(!0)},children:"Add Game State Prop"}),Object(P.jsx)(xe,{gameStateProp:u,isDrawerVisible:c,onDrawerClose:function(){i(!1)}})]})},ge=n(375),we=(n(357),s.a.Text),Ae=function(e){var t=e.location,n=e.canEdit,a=void 0===n||n,r=e.canRemove,c=void 0===r||r,i=e.onRemove,o=void 0===i?function(){}:i,s=e.onEdit,l=void 0===s?function(){}:s,u=e.onAddArea,d=void 0===u?function(){}:u,m=e.onEditArea,O=void 0===m?function(){}:m,p=e.onRemoveArea,x=void 0===p?function(){}:p,y=Object(J.useLiveQuery)((function(){return _.areas.where("location_id").equals(t.id).toArray()})),v=[];a&&v.push(Object(P.jsx)(b.a,{type:"link",size:"small",onClick:l,children:"Edit"},"edit-location")),c&&v.push(Object(P.jsx)(j.a,{title:"Are you sure you want to remove this location and all its areas?",onConfirm:o,onCancel:function(){},okText:"Yes",cancelText:"No",placement:"bottomRight",children:Object(P.jsx)(b.a,{type:"link",size:"small",children:"Remove"})},"remove-location"));var g=Object(P.jsxs)(h.a,{children:[Object(P.jsx)(f.a,{span:6,children:Object(P.jsx)(we,{strong:!0,children:"Area Name"})}),Object(P.jsx)(f.a,{span:12,children:Object(P.jsx)(we,{strong:!0,children:"Description"})}),Object(P.jsx)(f.a,{span:6})]});return Object(P.jsxs)(ge.a,{className:"location-view",size:"small",title:t.name,extra:v,headStyle:{background:"#f5f5f5"},children:[Object(P.jsx)(we,{children:t.description}),Object(P.jsx)(oe.a,{}),void 0!==y&&y.length>0&&Object(P.jsx)(ie.b,{header:g,dataSource:y,renderItem:function(e){return Object(P.jsx)(ie.b.Item,{className:"area-list-item",children:Object(P.jsxs)(h.a,{children:[Object(P.jsx)(f.a,{span:6,children:e.name}),Object(P.jsx)(f.a,{span:12,children:e.description}),Object(P.jsxs)(f.a,{span:6,style:{textAlign:"right"},children:[Object(P.jsx)(b.a,{type:"link",size:"small",onClick:function(){O(e)},children:"Edit"}),Object(P.jsx)(j.a,{title:"Are you sure you want to remove this area?",onConfirm:function(){x(e)},onCancel:function(){},okText:"Yes",cancelText:"No",placement:"bottomRight",children:Object(P.jsx)(b.a,{type:"link",size:"small",children:"Remove"})})]})]})})}}),Object(P.jsx)(b.a,{type:"default",size:"small",onClick:d,children:"Add Area"})]})},Ce=k.a.TextArea,Se=function(e){var t=e.location,n=void 0===t?null:t,r=e.isDrawerVisible,c=e.onDrawerClose,i=Object(a.useContext)(E),s=Object(o.a)(i,2)[1],l=A.a.useForm(),u=Object(o.a)(l,1)[0],d=Object(a.useState)(!1),j=Object(o.a)(d,2),m=j[0],O=j[1],p=Object(a.useState)(""),x=Object(o.a)(p,2),y=x[0],v=x[1],g=Object(a.useState)(""),w=Object(o.a)(g,2),D=w[0],B=w[1];Object(a.useEffect)((function(){r&&(u.resetFields(),n&&u.setFieldsValue({name:n.name,description:n.description}),T())}),[r,u,n]);var T=function(){O(!0)},R=function(){O(!1),c&&c()};return Object(P.jsx)(S.a,{title:null===n?"New location":"Edit location",width:360,onClose:R,visible:m,bodyStyle:{paddingBottom:20},footer:Object(P.jsxs)("div",{style:{textAlign:"right"},children:[Object(P.jsx)(b.a,{onClick:R,style:{marginRight:8},children:"Cancel"}),Object(P.jsx)(b.a,{type:"primary",htmlType:"submit",form:"add-edit-location-id",children:null===n?"Create":"Update"})]}),children:Object(P.jsxs)(A.a,{layout:"vertical",name:"add-edit-location",id:"add-edit-location-id",form:u,onFinish:function(e){var t=e.name.trim(),a=e.description.trim();if(""===t||""===a)return R(),void C.b.error("Do not leave empty fields, sorry :(");var r={name:t,description:a};null===n?z.createNewLocation(s,r).then((function(e){R(),C.b.success("New location created!")})).catch((function(e){R(),C.b.error("Something went wrong, sorry :(")})):z.updateLocation(s,n.id,r).then((function(e){R(),C.b.success("Location edited!")})).catch((function(e){R(),C.b.error("Something went wrong, sorry :(")}))},requiredMark:!1,children:[Object(P.jsx)(h.a,{gutter:16,children:Object(P.jsx)(f.a,{span:24,children:Object(P.jsx)(A.a.Item,{name:"name",label:"Name",rules:[{required:!0,message:"Please enter a name"}],children:Object(P.jsx)(k.a,{placeholder:"Please enter a name",value:y,onChange:function(e){v(e.target.value)}})})})}),Object(P.jsx)(h.a,{gutter:16,children:Object(P.jsx)(f.a,{span:24,children:Object(P.jsx)(A.a.Item,{name:"description",label:"Description",rules:[{required:!0,message:"Please enter a description"}],children:Object(P.jsx)(Ce,{rows:10,placeholder:"Please enter a description",value:D,onChange:function(e){B(e.target.value)}})})})})]})})},ke=k.a.TextArea,De=function(e){var t=e.area,n=void 0===t?null:t,r=e.location,c=e.isDrawerVisible,i=e.onDrawerClose,s=Object(a.useContext)(E),l=Object(o.a)(s,2)[1],u=A.a.useForm(),d=Object(o.a)(u,1)[0],j=Object(a.useState)(!1),m=Object(o.a)(j,2),O=m[0],p=m[1],x=Object(a.useState)(""),y=Object(o.a)(x,2),v=y[0],g=y[1],w=Object(a.useState)(""),D=Object(o.a)(w,2),B=D[0],T=D[1];Object(a.useEffect)((function(){c&&(d.resetFields(),n&&d.setFieldsValue({name:n.name,description:n.description}),R())}),[c,d,n]);var R=function(){p(!0)},I=function(){p(!1),i&&i()};return Object(P.jsx)(S.a,{title:(null===n?"New area":"Edit area")+" in "+(r&&r.name),width:360,onClose:I,visible:O,bodyStyle:{paddingBottom:20},footer:Object(P.jsxs)("div",{style:{textAlign:"right"},children:[Object(P.jsx)(b.a,{onClick:I,style:{marginRight:8},children:"Cancel"}),Object(P.jsx)(b.a,{type:"primary",htmlType:"submit",form:"add-edit-area-id",children:null===n?"Create":"Update"})]}),children:Object(P.jsxs)(A.a,{layout:"vertical",name:"add-edit-area",id:"add-edit-area-id",form:d,onFinish:function(e){var t=e.name.trim(),a=e.description.trim();if(""===t||""===a)return I(),void C.b.error("Do not leave empty fields, sorry :(");var c={name:t,description:a};null===n?(c.location_id=r.id,z.createNewArea(l,c).then((function(e){I(),C.b.success("New area created!")})).catch((function(e){I(),C.b.error("Something went wrong, sorry :(")}))):z.updateArea(l,n.id,c).then((function(e){I(),C.b.success("Area edited!")})).catch((function(e){I(),C.b.error("Something went wrong, sorry :(")}))},requiredMark:!1,children:[Object(P.jsx)(h.a,{gutter:16,children:Object(P.jsx)(f.a,{span:24,children:Object(P.jsx)(A.a.Item,{name:"name",label:"Name",rules:[{required:!0,message:"Please enter a name"}],children:Object(P.jsx)(k.a,{placeholder:"Please enter a name",value:v,onChange:function(e){g(e.target.value)}})})})}),Object(P.jsx)(h.a,{gutter:16,children:Object(P.jsx)(f.a,{span:24,children:Object(P.jsx)(A.a.Item,{name:"description",label:"Description",rules:[{required:!0,message:"Please enter a description"}],children:Object(P.jsx)(ke,{rows:10,placeholder:"Please enter a description",value:B,onChange:function(e){T(e.target.value)}})})})})]})})},Be=function(){var e=Object(a.useContext)(E),t=Object(o.a)(e,2)[1],n=Object(a.useState)(!1),r=Object(o.a)(n,2),c=r[0],i=r[1],s=Object(a.useState)(!1),l=Object(o.a)(s,2),u=l[0],d=l[1],j=Object(a.useState)(null),h=Object(o.a)(j,2),f=h[0],m=h[1],O=Object(a.useState)(null),p=Object(o.a)(O,2),x=p[0],y=p[1],v=Object(J.useLiveQuery)((function(){return _.locations.toArray()}));return Object(P.jsxs)("div",{children:[void 0!==v&&v.map((function(e){return Object(P.jsx)(Ae,{location:e,onRemove:function(){!function(e){z.deleteLocation(t,e.id).then((function(e){C.b.success("Location removed!")})).catch((function(e){C.b.error("Something went wrong, sorry :(")}))}(e)},onEdit:function(){!function(e){m(e),i(!0)}(e)},onAddArea:function(){!function(e){y(null),m(e),d(!0)}(e)},onEditArea:function(t){!function(e,t){m(t),y(e),d(!0)}(t,e)},onRemoveArea:function(e){!function(e){z.deleteArea(t,e.id).then((function(e){C.b.success("Area removed!")})).catch((function(e){C.b.error("Something went wrong, sorry :(")}))}(e)}},e.id)})),Object(P.jsx)(b.a,{type:"primary",onClick:function(){m(null),i(!0)},children:"Add Location"}),Object(P.jsx)(Se,{location:f,isDrawerVisible:c,onDrawerClose:function(){i(!1)}}),Object(P.jsx)(De,{area:x,location:f,isDrawerVisible:u,onDrawerClose:function(){d(!1)}})]})},Pe=(n(358),s.a.Text),Te=function(e){var t=e.entity,n=e.entityName,a=void 0===n?"entity":n,r=e.canEdit,c=void 0===r||r,i=e.canRemove,o=void 0===i||i,s=e.onRemove,l=void 0===s?function(){}:s,u=e.onEdit,d=void 0===u?function(){}:u,h=[];return c&&h.push(Object(P.jsx)(b.a,{type:"link",size:"small",onClick:d,children:"Edit"},"edit-entity")),o&&h.push(Object(P.jsx)(j.a,{title:"Are you sure you want to remove this ".concat(a,"?"),onConfirm:l,onCancel:function(){},okText:"Yes",cancelText:"No",placement:"bottomRight",children:Object(P.jsx)(b.a,{type:"link",size:"small",children:"Remove"})},"remove-entity")),Object(P.jsx)(ge.a,{className:"simple-entity-view",size:"small",title:t.name,extra:h,headStyle:{background:"#f5f5f5"},children:Object(P.jsx)(Pe,{children:t.description})})},Ee=k.a.TextArea,Re=function(e){var t=e.character,n=void 0===t?null:t,r=e.isDrawerVisible,c=e.onDrawerClose,i=Object(a.useContext)(E),s=Object(o.a)(i,2)[1],l=A.a.useForm(),u=Object(o.a)(l,1)[0],d=Object(a.useState)(!1),j=Object(o.a)(d,2),m=j[0],O=j[1],p=Object(a.useState)(""),x=Object(o.a)(p,2),y=x[0],v=x[1],g=Object(a.useState)(""),w=Object(o.a)(g,2),D=w[0],B=w[1];Object(a.useEffect)((function(){r&&(u.resetFields(),n&&u.setFieldsValue({name:n.name,description:n.description}),T())}),[r,u,n]);var T=function(){O(!0)},R=function(){O(!1),c&&c()};return Object(P.jsx)(S.a,{title:null===n?"New character":"Edit character",width:360,onClose:R,visible:m,bodyStyle:{paddingBottom:20},footer:Object(P.jsxs)("div",{style:{textAlign:"right"},children:[Object(P.jsx)(b.a,{onClick:R,style:{marginRight:8},children:"Cancel"}),Object(P.jsx)(b.a,{type:"primary",htmlType:"submit",form:"add-edit-character-id",children:null===n?"Create":"Update"})]}),children:Object(P.jsxs)(A.a,{layout:"vertical",name:"add-edit-character",id:"add-edit-character-id",form:u,onFinish:function(e){var t=e.name.trim(),a=e.description.trim();if(""===t||""===a)return R(),void C.b.error("Do not leave empty fields, sorry :(");var r={name:t,description:a};null===n?z.createNewCharacter(s,r).then((function(e){R(),C.b.success("New character created!")})).catch((function(e){R(),C.b.error("Something went wrong, sorry :(")})):z.updateCharacter(s,n.id,r).then((function(e){R(),C.b.success("Character edited!")})).catch((function(e){R(),C.b.error("Something went wrong, sorry :(")}))},requiredMark:!1,children:[Object(P.jsx)(h.a,{gutter:16,children:Object(P.jsx)(f.a,{span:24,children:Object(P.jsx)(A.a.Item,{name:"name",label:"Name",rules:[{required:!0,message:"Please enter a name"}],children:Object(P.jsx)(k.a,{placeholder:"Please enter a name",value:y,onChange:function(e){v(e.target.value)}})})})}),Object(P.jsx)(h.a,{gutter:16,children:Object(P.jsx)(f.a,{span:24,children:Object(P.jsx)(A.a.Item,{name:"description",label:"Description",rules:[{required:!0,message:"Please enter a description"}],children:Object(P.jsx)(Ee,{rows:10,placeholder:"Please enter a description",value:D,onChange:function(e){B(e.target.value)}})})})})]})})},Ie=function(){var e=Object(a.useContext)(E),t=Object(o.a)(e,2)[1],n=Object(a.useState)(!1),r=Object(o.a)(n,2),c=r[0],i=r[1],s=Object(a.useState)(null),l=Object(o.a)(s,2),u=l[0],d=l[1],j=Object(J.useLiveQuery)((function(){return _.characters.toArray()}));return Object(P.jsxs)("div",{children:[void 0!==j&&j.map((function(e){return Object(P.jsx)(Te,{entity:e,entityName:"character",onRemove:function(){!function(e){z.deleteCharacter(t,e.id).then((function(e){C.b.success("Character removed!")})).catch((function(e){C.b.error("Something went wrong, sorry :(")}))}(e)},onEdit:function(){!function(e){d(e),i(!0)}(e)}},e.id)})),Object(P.jsx)(b.a,{type:"primary",onClick:function(){d(null),i(!0)},children:"Add Character"}),Object(P.jsx)(Re,{character:u,isDrawerVisible:c,onDrawerClose:function(){i(!1)}})]})},Ne=k.a.TextArea,Le=function(e){var t=e.entity,n=void 0===t?null:t,r=e.entityDef,c=e.isDrawerVisible,i=e.onDrawerClose,s=Object(a.useContext)(E),l=Object(o.a)(s,2)[1],u=A.a.useForm(),d=Object(o.a)(u,1)[0],j=Object(a.useState)(!1),m=Object(o.a)(j,2),O=m[0],p=m[1],x=Object(a.useState)(""),y=Object(o.a)(x,2),v=y[0],g=y[1],w=Object(a.useState)(""),D=Object(o.a)(w,2),B=D[0],T=D[1],R=r.singular_name.toLowerCase().charAt(0).toUpperCase()+r.singular_name.toLowerCase().slice(1);Object(a.useEffect)((function(){c&&(d.resetFields(),n&&d.setFieldsValue({name:n.name,description:n.description}),I())}),[c,d,n]);var I=function(){p(!0)},N=function(){p(!1),i&&i()};return Object(P.jsx)(S.a,{title:(null===n?"New":"Edit")+" "+r.singular_name.toLowerCase(),width:360,onClose:N,visible:O,bodyStyle:{paddingBottom:20},footer:Object(P.jsxs)("div",{style:{textAlign:"right"},children:[Object(P.jsx)(b.a,{onClick:N,style:{marginRight:8},children:"Cancel"}),Object(P.jsx)(b.a,{type:"primary",htmlType:"submit",form:"add-edit-custom-entity-id-"+r.key,children:null===n?"Create":"Update"})]}),children:Object(P.jsxs)(A.a,{layout:"vertical",name:"add-edit-custom-entity-"+r.key,id:"add-edit-custom-entity-id-"+r.key,form:d,onFinish:function(e){!function(e){var t=e.name.trim(),a=e.description.trim();if(""===t||""===a)return N(),void C.b.error("Do not leave empty fields, sorry :(");var c={name:t,description:a};null===n?(c.custom_entity_def_id=r.id,z.createNewCustomEntity(l,c).then((function(e){N(),C.b.success("New "+r.singular_name.toLowerCase()+" created!")})).catch((function(e){N(),C.b.error("Something went wrong, sorry :(")}))):z.updateCustomEntity(l,n.id,c).then((function(e){N(),C.b.success(R+" edited!")})).catch((function(e){N(),C.b.error("Something went wrong, sorry :(")}))}(e)},requiredMark:!1,children:[Object(P.jsx)(h.a,{gutter:16,children:Object(P.jsx)(f.a,{span:24,children:Object(P.jsx)(A.a.Item,{name:"name",label:"Name",rules:[{required:!0,message:"Please enter a name"}],children:Object(P.jsx)(k.a,{placeholder:"Please enter a name",value:v,onChange:function(e){g(e.target.value)}})})})}),Object(P.jsx)(h.a,{gutter:16,children:Object(P.jsx)(f.a,{span:24,children:Object(P.jsx)(A.a.Item,{name:"description",label:"Description",rules:[{required:!0,message:"Please enter a description"}],children:Object(P.jsx)(Ne,{rows:10,placeholder:"Please enter a description",value:B,onChange:function(e){T(e.target.value)}})})})})]})})},Qe=function(e){var t=e.entityDef,n=Object(a.useContext)(E),r=Object(o.a)(n,2)[1],c=t.singular_name.toLowerCase().charAt(0).toUpperCase()+t.singular_name.toLowerCase().slice(1),i=Object(a.useState)(!1),s=Object(o.a)(i,2),l=s[0],u=s[1],d=Object(a.useState)(null),h=Object(o.a)(d,2),f=h[0],m=h[1],O=Object(J.useLiveQuery)((function(){return _.custom_entities.where("custom_entity_def_id").equals(t.id).toArray()}));return Object(P.jsxs)("div",{children:[Object(P.jsx)("div",{style:{textAlign:"right",marginBottom:"20px"},children:Object(P.jsx)(j.a,{title:"This section and all its content will be removed!! Are you sure you want to remove this entity?",onConfirm:function(){z.deleteCustomEntityDef(r,t.id).then((function(e){C.b.success(t.name+" removed!")})).catch((function(e){C.b.error("Something went wrong, sorry :(")}))},onCancel:function(){},okText:"Yes",cancelText:"No",placement:"bottomRight",children:Object(P.jsx)(b.a,{type:"default",danger:!0,children:"Remove entity"})},"remove-entity-def")}),void 0!==O&&O.map((function(e){return Object(P.jsx)(Te,{entity:e,entityName:t.singular_name.toLowerCase(),onRemove:function(){!function(e){z.deleteCustomEntity(r,e.id).then((function(e){C.b.success(c+" removed!")})).catch((function(e){C.b.error("Something went wrong, sorry :(")}))}(e)},onEdit:function(){!function(e){m(e),u(!0)}(e)}},e.id)})),Object(P.jsxs)(b.a,{type:"primary",onClick:function(){m(null),u(!0)},children:["Add ",c]}),Object(P.jsx)(Le,{entity:f,entityDef:t,isDrawerVisible:l,onDrawerClose:function(){u(!1)}})]})},Ve=u.a.Content,Fe=ne.a.TabPane,_e=function(){var e=Object(a.useState)(!1),t=Object(o.a)(e,2),n=t[0],r=t[1],c=Object(a.useState)(!1),i=Object(o.a)(c,2),s=i[0],l=i[1],u=Object(J.useLiveQuery)((function(){return _.custom_entity_defs.toArray()})),d=Object(P.jsx)(b.a,{size:"small",icon:Object(P.jsx)(ae.a,{}),onClick:function(){r(!0)},children:"Add entity"},"add-custom"),j=[Object(P.jsx)(b.a,{size:"small",icon:Object(P.jsx)(re.a,{}),style:{marginRight:"4px"},onClick:function(){l(!0)},children:"Colors"},"edit-colors"),d];return Object(P.jsxs)(P.Fragment,{children:[Object(P.jsx)(Ve,{className:"config-page",children:Object(P.jsxs)(ne.a,{type:"card",size:"small",tabBarExtraContent:j,children:[Object(P.jsx)(Fe,{tab:"Game State",children:Object(P.jsx)(ve,{})},"1"),Object(P.jsx)(Fe,{tab:"Locations",children:Object(P.jsx)(Be,{})},"2"),Object(P.jsx)(Fe,{tab:"Characters",children:Object(P.jsx)(Ie,{})},"3"),void 0!==u&&u.map((function(e,t){return Object(P.jsx)(Fe,{tab:e.name,children:Object(P.jsx)(Qe,{entityDef:e})},t+4)}))]})}),Object(P.jsx)(ce,{isDrawerVisible:n,onDrawerClose:function(){r(!1)}}),Object(P.jsx)(ue,{isDrawerVisible:s,onDrawerClose:function(){l(!1)}})]})},qe=(n(359),n(387)),ze=n(388),Ue=(n(360),s.a.Text),Ke=function(e){var t=e.chapter,n=e.chapterIndex,a=void 0===n?null:n,r=e.totalChapters,c=void 0===r?0:r,i=e.canEdit,o=void 0===i||i,s=e.canRemove,l=void 0===s||s,u=e.onRemove,d=void 0===u?function(){}:u,h=e.onEdit,f=void 0===h?function(){}:h,m=e.onMoveOrderUp,O=void 0===m?function(){}:m,p=e.onMoveOrderDown,x=void 0===p?function(){}:p,y=[];y.push(Object(P.jsx)(b.a,{type:"default",icon:Object(P.jsx)(qe.a,{}),size:"small",style:{marginRight:"4px"},disabled:0===a,onClick:O},"move-up")),y.push(Object(P.jsx)(b.a,{type:"default",icon:Object(P.jsx)(ze.a,{}),size:"small",style:{marginRight:"24px"},disabled:a===c-1,onClick:x},"move-down")),o&&y.push(Object(P.jsx)(b.a,{type:"link",size:"small",onClick:f,children:"Edit"},"edit-chapter")),l&&y.push(Object(P.jsx)(j.a,{title:"Are you sure you want to remove this chapter?",onConfirm:d,onCancel:function(){},okText:"Yes",cancelText:"No",placement:"bottomRight",children:Object(P.jsx)(b.a,{type:"link",size:"small",children:"Remove"})},"remove-chapter"));var v="Chapter "+t.order+": "+t.name;return Object(P.jsx)(ge.a,{className:"chapter-view",size:"small",title:v,extra:y,headStyle:{background:"#f5f5f5"},children:Object(P.jsx)(Ue,{children:t.description})})},Ge=k.a.TextArea,Me=function(e){var t=e.chapter,n=void 0===t?null:t,r=e.totalChapters,c=void 0===r?0:r,i=e.isDrawerVisible,s=e.onDrawerClose,l=Object(a.useContext)(E),u=Object(o.a)(l,2)[1],d=A.a.useForm(),j=Object(o.a)(d,1)[0],m=Object(a.useState)(!1),O=Object(o.a)(m,2),p=O[0],x=O[1],y=Object(a.useState)(0),v=Object(o.a)(y,2),g=v[0],w=v[1],D=Object(a.useState)(""),B=Object(o.a)(D,2),T=B[0],R=B[1],I=Object(a.useState)(""),N=Object(o.a)(I,2),L=N[0],Q=N[1];Object(a.useEffect)((function(){if(i){if(j.resetFields(),n)j.setFieldsValue({name:n.name,description:n.description,chapterIndex:n.order}),w(n.order);else{var e=c+1;j.setFieldsValue({chapterIndex:e}),w(e)}V()}}),[i,j,n,c]);var V=function(){x(!0)},F=function(){x(!1),s&&s()};return Object(P.jsx)(S.a,{title:null===n?"New chapter":"Edit chapter",width:360,onClose:F,visible:p,bodyStyle:{paddingBottom:20},footer:Object(P.jsxs)("div",{style:{textAlign:"right"},children:[Object(P.jsx)(b.a,{onClick:F,style:{marginRight:8},children:"Cancel"}),Object(P.jsx)(b.a,{type:"primary",htmlType:"submit",form:"add-edit-chapter-id",children:null===n?"Create":"Update"})]}),children:Object(P.jsxs)(A.a,{layout:"vertical",name:"add-edit-chapter",id:"add-edit-chapter-id",form:j,onFinish:function(e){var t=e.name.trim(),a=e.description.trim();if(""===t||""===a)return F(),void C.b.error("Do not leave empty fields, sorry :(");var r={name:t,description:a,order:g};null===n?z.createNewChapter(u,r).then((function(e){F(),C.b.success("New chapter created!")})).catch((function(e){F(),C.b.error("Something went wrong, sorry :(")})):z.updateChapter(u,n.id,r).then((function(e){F(),C.b.success("Chapter edited!")})).catch((function(e){F(),C.b.error("Something went wrong, sorry :(")}))},requiredMark:!1,children:[Object(P.jsx)(h.a,{gutter:16,children:Object(P.jsx)(f.a,{span:24,children:Object(P.jsx)(A.a.Item,{name:"chapterIndex",label:"Chapter",children:Object(P.jsx)(k.a,{placeholder:"#",value:g,disabled:!0})})})}),Object(P.jsx)(h.a,{gutter:16,children:Object(P.jsx)(f.a,{span:24,children:Object(P.jsx)(A.a.Item,{name:"name",label:"Name",rules:[{required:!0,message:"Please enter a name"}],children:Object(P.jsx)(k.a,{placeholder:"Please enter a name",value:T,onChange:function(e){R(e.target.value)}})})})}),Object(P.jsx)(h.a,{gutter:16,children:Object(P.jsx)(f.a,{span:24,children:Object(P.jsx)(A.a.Item,{name:"description",label:"Description",rules:[{required:!0,message:"Please enter a description"}],children:Object(P.jsx)(Ge,{rows:10,placeholder:"Please enter a description",value:L,onChange:function(e){Q(e.target.value)}})})})})]})})},Je=function(){var e=Object(a.useContext)(E),t=Object(o.a)(e,2)[1],n=Object(a.useState)(!1),r=Object(o.a)(n,2),c=r[0],i=r[1],s=Object(a.useState)(null),l=Object(o.a)(s,2),u=l[0],d=l[1],j=Object(J.useLiveQuery)((function(){return _.chapters.orderBy("order").toArray()})),h=void 0!==j?j.length:0;return Object(P.jsxs)("div",{children:[void 0!==j&&j.map((function(e,n){return Object(P.jsx)(Ke,{chapter:e,chapterIndex:n,totalChapters:h,onRemove:function(){!function(e){z.deleteChapter(t,e.id).then((function(e){C.b.success("Chapter removed!")})).catch((function(e){C.b.error("Something went wrong, sorry :(")}))}(e)},onEdit:function(){!function(e){d(e),i(!0)}(e)},onMoveOrderUp:function(){!function(e){var n={oldOrder:e.order,order:e.order-1};z.updateChapterOrder(t,e.id,n).then((function(e){})).catch((function(e){C.b.error("Something went wrong, sorry :(")}))}(e)},onMoveOrderDown:function(){!function(e){var n={oldOrder:e.order,order:e.order+1};z.updateChapterOrder(t,e.id,n).then((function(e){})).catch((function(e){C.b.error("Something went wrong, sorry :(")}))}(e)}},e.id)})),Object(P.jsx)(b.a,{type:"primary",onClick:function(){d(null),i(!0)},children:"Add Chapter"}),Object(P.jsx)(Me,{chapter:u,totalChapters:h,isDrawerVisible:c,onDrawerClose:function(){i(!1)}})]})},Xe=u.a.Content,Ye=ne.a.TabPane,He=function(){return Object(P.jsx)(Xe,{className:"story-page",children:Object(P.jsxs)(ne.a,{type:"card",size:"small",children:[Object(P.jsx)(Ye,{tab:"Storyline",children:Object(P.jsx)(Je,{})},"1"),Object(P.jsx)(Ye,{tab:"Sequence Actions",children:Object(P.jsx)("p",{children:"Sequence Actions"})},"2")]})})},Ze=s.a.Text,We=function(){var e=Object(a.useContext)(E),t=Object(o.a)(e,2),n=t[0],c=t[1];return Object(a.useEffect)((function(){z.checkDatabaseOk(c),z.checkStoryLoaded(c)}),[]),n.initialCheckDone?n.databaseLoadError?Object(P.jsx)(Ze,{children:"This application requires IndexedDB. Please use a browser that supports this feature."}):Object(P.jsx)("div",{className:"app",children:Object(P.jsxs)(u.a,{children:[Object(P.jsx)(M,{}),Object(P.jsx)(u.a,{className:"app-layout",children:n.storyLoaded?Object(P.jsxs)(P.Fragment,{children:[Object(P.jsx)(Z,{}),r.a.createElement("CONFIG"===n.page?_e:He)]}):Object(P.jsx)(te,{})})]})}):Object(P.jsxs)("div",{className:"app loading",children:[Object(P.jsx)("img",{src:K,alt:"RPG Story Playtesting"}),Object(P.jsx)(l.a,{size:"large"})]})},$e=(n(361),n(362),function(){return Object(P.jsx)(R,{children:Object(P.jsx)(We,{})})}),et=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,389)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,c=t.getLCP,i=t.getTTFB;n(e),a(e),r(e),c(e),i(e)}))};i.a.render(Object(P.jsx)(r.a.StrictMode,{children:Object(P.jsx)($e,{})}),document.getElementById("root")),et()}},[[363,1,2]]]);
//# sourceMappingURL=main.16ea6758.chunk.js.map